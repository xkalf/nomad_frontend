generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  cube      String
  userId    Int?
  main      Boolean   @default(false)
  User      User?     @relation(fields: [userId], references: [id])
  solves    Solve[]
  deleted   DateTime?

  @@index([userId, cube, main])
}

model Solve {
  id          Int       @id @default(autoincrement())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  scramble    String
  time        Int
  status      String    @default("ok")
  description String?   @db.VarChar
  sessionId   Int
  deleted     DateTime?
  Session     Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model User {
  id          Int           @id @default(autoincrement())
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  email       String        @unique
  firstname   String
  lastname    String
  birthdate   DateTime
  password    String
  role        String        @default("user")
  sessions    Session[]
  userSession UserSession[]
  settings    Settings?
  settingsId  Int?
}

model UserSession {
  id     Int    @id @default(autoincrement())
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  token  String @unique @default(uuid())
  userId Int

  @@index([userId])
}

model Settings {
  id                Int               @id @default(autoincrement())
  displaySettings   DisplaySettings?
  timerSettings     TimerSettings?
  scrambleSettings   ScrambleSettings?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  userId            Int               @unique
  user              User              @relation(fields: [userId], references: [id])

  @@index([userId])
}

model DisplaySettings {
  id                     Int      @id @default(autoincrement())
  zoom                   Int      @default(100)
  font                   Font     @default(Mono)
  backgroundImageOpacity Int      @default(25)
  timerSize              Int      @default(25)
  backgroundImage        String?
  settings               Settings @relation(fields: [settingsId], references: [id])
  settingsId             Int      @unique
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

enum Font {
  Mono
}

model TimerSettings {
  id                      Int                     @id @default(autoincrement())
  useMouseTimer           Boolean                 @default(false)
  useWcaInspection        UseWcaInspection        @default(Never)
  voiceAlert              VoiceAlert              @default(None)
  voiceVolume             Int                     @default(100)
  enteringTimes           EnteringTimes           @default(Timer)
  unitWhenEnteringInteger UnitWhenEnteringInteger @default(Full)
  multiPhase              Int                     @default(1)
  timerUpdate             TimerUpdate             @default(Point)
  spaceDown               SpaceDown               @default(Three)
  settings                Settings                @relation(fields: [settingsId], references: [id])
  settingsId              Int                     @unique
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
}

enum UnitWhenEnteringInteger {
  Full
}

enum UseWcaInspection {
  Always
  ExceptBLD
  Never
}

enum VoiceAlert {
  None
}

enum EnteringTimes {
  Timer
  Typing
}

enum TimerUpdate {
  Update
  Inspection
  Seconds
  Point // 0.1s
  None
}

enum SpaceDown {
  Zero // 0
  Three // 0.3
  Five // 0.55
  One // 1
}

model ScrambleSettings {
  id           Int       @id @default(autoincrement())
  limitHeight  Boolean   @default(false)
  scrambleSize Int       @default(25)
  monospaced   Boolean   @default(false)
  alignArea    AlignArea @default(Center)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  settings     Settings  @relation(fields: [settingsId], references: [id])
  settingsId   Int @unique
}

enum AlignArea {
  Center
  Left
  Right
}
