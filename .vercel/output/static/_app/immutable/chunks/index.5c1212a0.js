import{_ as I}from"./_commonjsHelpers.852922b8.js";var rr=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},a=(e,t,n)=>(rr(e,t,"read from private field"),n?n.call(e):t.get(e)),c=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},m=(e,t,n,r)=>(rr(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),xn=(e,t,n,r)=>({set _(i){m(e,t,i,n)},get _(){return a(e,t,r)}}),M=(e,t,n)=>(rr(e,t,"access private method"),n),Kr=class{is(e){return this instanceof e}as(e){return this instanceof e?this:null}},me=class extends Kr{constructor(){super()}get log(){return console.log.bind(console,this,this.toString())}};function na(e,t=!0){if(!t)return e;switch(e){case 1:return-1;case-1:return 1}}function Jr(e,t){return t===-1?Array.from(e).reverse():e}function ra(e){return Array.from(e).reverse()}function*ia(e,t){t===-1?yield*aa(e):yield*e}function*aa(e){for(const t of Array.from(e).reverse())yield t}var Mn=2147483647,rn="2^31 - 1",sa=-2147483648,Ee,zn=class{constructor(){c(this,Ee,[])}push(e){a(this,Ee).push(e)}experimentalPushAlg(e){for(const t of e.units())this.push(t)}experimentalNumUnits(){return a(this,Ee).length}toAlg(){return new p(a(this,Ee))}reset(){m(this,Ee,[])}};Ee=new WeakMap;var De,Ae,Sn=class extends me{constructor(e,t){super(),c(this,De,void 0),c(this,Ae,void 0),m(this,De,gt(e)),m(this,Ae,gt(t))}get A(){return a(this,De)}get B(){return a(this,Ae)}isIdentical(e){const t=e.as(Sn);return!!(t!=null&&t.A.isIdentical(this.A)&&(t!=null&&t.B.isIdentical(this.B)))}invert(){return new Sn(a(this,Ae),a(this,De))}*experimentalExpand(e=1,t){t??(t=1/0),t===0?yield e===1?this:this.invert():e===1?(yield*this.A.experimentalExpand(1,t-1),yield*this.B.experimentalExpand(1,t-1),yield*this.A.experimentalExpand(-1,t-1),yield*this.B.experimentalExpand(-1,t-1)):(yield*this.B.experimentalExpand(1,t-1),yield*this.A.experimentalExpand(1,t-1),yield*this.B.experimentalExpand(-1,t-1),yield*this.A.experimentalExpand(-1,t-1))}toString(){return`[${a(this,De).toString()}, ${a(this,Ae).toString()}]`}},Y=Sn;De=new WeakMap;Ae=new WeakMap;var Je,et,Tn=class extends me{constructor(e,t){super(),c(this,Je,void 0),c(this,et,void 0),m(this,Je,gt(e)),m(this,et,gt(t))}get A(){return a(this,Je)}get B(){return a(this,et)}isIdentical(e){const t=e.as(Tn);return!!(t!=null&&t.A.isIdentical(this.A)&&(t!=null&&t.B.isIdentical(this.B)))}invert(){return new Tn(a(this,Je),a(this,et).invert())}*experimentalExpand(e,t){t??(t=1/0),t===0?yield e===1?this:this.invert():(yield*this.A.experimentalExpand(1,t-1),yield*this.B.experimentalExpand(e,t-1),yield*this.A.experimentalExpand(-1,t-1))}toString(){return`[${this.A}: ${this.B}]`}},V=Tn;Je=new WeakMap;et=new WeakMap;var ge,ei=class extends me{constructor(e){if(super(),c(this,ge,void 0),e.includes(`
`)||e.includes("\r"))throw new Error("LineComment cannot contain newline");m(this,ge,e)}get text(){return a(this,ge)}isIdentical(e){const t=e;return e.is(ei)&&a(this,ge)===a(t,ge)}invert(){return this}*experimentalExpand(e=1,t=1/0){yield this}toString(){return`//${a(this,ge)}`}},xt=ei;ge=new WeakMap;var de=class extends me{toString(){return`
`}isIdentical(e){return e.is(de)}invert(){return this}*experimentalExpand(e=1,t=1/0){yield this}},he=class extends me{toString(){return"."}isIdentical(e){return e.is(he)}invert(){return this}*experimentalExpand(e=1,t=1/0){yield this}};function Lt(e,t){return e?parseInt(e):t}var mr=/^(\d+)?('?)/,oa=/^[_\dA-Za-z]/,la=/^((([1-9]\d*)-)?([1-9]\d*))?([_A-Za-z]+)?/,ua=/^[^\n]*/,ca=/^(-?\d+), ?/,da=/^(-?\d+)\)/;function ti(e){return new ir().parseAlg(e)}function ha(e){return new ir().parseMove(e)}function ma(e){return new ir().parseQuantumMove(e)}function R(e,t,n){const r=e;return r.startCharIndex=t,r.endCharIndex=n,r}function pa(e,t){return"startCharIndex"in e&&(t.startCharIndex=e.startCharIndex),"endCharIndex"in e&&(t.endCharIndex=e.endCharIndex),t}var W,w,ir=class{constructor(){c(this,W,""),c(this,w,0)}parseAlg(e){m(this,W,e),m(this,w,0);const t=this.parseAlgWithStopping([]);return this.mustBeAtEndOfInput(),t}parseMove(e){m(this,W,e),m(this,w,0);const t=this.parseMoveImpl();return this.mustBeAtEndOfInput(),t}parseQuantumMove(e){m(this,W,e),m(this,w,0);const t=this.parseQuantumMoveImpl();return this.mustBeAtEndOfInput(),t}mustBeAtEndOfInput(){if(a(this,w)!==a(this,W).length)throw new Error("parsing unexpectedly ended early")}parseAlgWithStopping(e){let t=a(this,w),n=a(this,w);const r=new zn;let i=!1;const s=o=>{if(i)throw new Error(`Unexpected character at index ${o}. Are you missing a space?`)};e:for(;a(this,w)<a(this,W).length;){const o=a(this,w);if(e.includes(a(this,W)[a(this,w)]))return R(r.toAlg(),t,n);if(this.tryConsumeNext(" ")){i=!1,r.experimentalNumUnits()===0&&(t=a(this,w));continue e}else if(oa.test(a(this,W)[a(this,w)])){s(o);const u=this.parseMoveImpl();r.push(u),i=!0,n=a(this,w);continue e}else if(this.tryConsumeNext("(")){s(o);const u=this.tryRegex(ca);if(u){const d=u[1],h=a(this,w),f=this.parseRegex(da),g=R(new l(new Be("U_SQ_"),parseInt(d)),o+1,o+1+d.length),v=R(new l(new Be("D_SQ_"),parseInt(f[1])),h,a(this,w)-1),b=R(new p([g,v]),o+1,a(this,w)-1);r.push(R(new X(b),o,a(this,w))),i=!0,n=a(this,w);continue e}else{const d=this.parseAlgWithStopping([")"]);this.mustConsumeNext(")");const h=this.parseAmount();r.push(R(new X(d,h),o,a(this,w))),i=!0,n=a(this,w);continue e}}else if(this.tryConsumeNext("[")){s(o);const u=this.parseAlgWithStopping([",",":"]),d=this.popNext(),h=this.parseAlgWithStopping(["]"]);switch(this.mustConsumeNext("]"),d){case":":r.push(R(new V(u,h),o,a(this,w))),i=!0,n=a(this,w);continue e;case",":r.push(R(new Y(u,h),o,a(this,w))),i=!0,n=a(this,w);continue e;default:throw"unexpected parsing error"}}else if(this.tryConsumeNext(`
`)){r.push(R(new de,o,a(this,w))),i=!1,n=a(this,w);continue e}else if(this.tryConsumeNext("/"))if(this.tryConsumeNext("/")){s(o);const[u]=this.parseRegex(ua);r.push(R(new xt(u),o,a(this,w))),i=!1,n=a(this,w);continue e}else{r.push(R(new l("_SLASH_"),o,a(this,w))),i=!0,n=a(this,w);continue e}else if(this.tryConsumeNext(".")){s(o),r.push(R(new he,o,a(this,w))),i=!0,n=a(this,w);continue e}else throw new Error(`Unexpected character: ${this.popNext()}`)}if(a(this,w)!==a(this,W).length)throw new Error("did not finish parsing?");if(e.length>0)throw new Error("expected stopping");return R(r.toAlg(),t,n)}parseQuantumMoveImpl(){const[,,,e,t,n]=this.parseRegex(la);return new Be(n,Lt(t,void 0),Lt(e,void 0))}parseMoveImpl(){const e=a(this,w);if(this.tryConsumeNext("/"))return R(new l("_SLASH_"),e,a(this,w));let t=this.parseQuantumMoveImpl(),[n,r]=this.parseAmountAndTrackEmptyAbsAmount();const i=this.parseMoveSuffix();if(i){if(n<0)throw new Error("uh-oh");if((i==="++"||i==="--")&&n!==1)throw new Error("Pochmann ++ or -- moves cannot have an amount other than 1.");if((i==="++"||i==="--")&&!r)throw new Error("Pochmann ++ or -- moves cannot have an amount written as a number.");if((i==="+"||i==="-")&&r)throw new Error("Clock dial moves must have an amount written as a natural number followed by + or -.");i.startsWith("+")&&(t=t.modified({family:`${t.family}_${i==="+"?"PLUS":"PLUSPLUS"}_`})),i.startsWith("-")&&(t=t.modified({family:`${t.family}_${i==="-"?"PLUS":"PLUSPLUS"}_`}),n*=-1)}return R(new l(t,n),e,a(this,w))}parseMoveSuffix(){return this.tryConsumeNext("+")?this.tryConsumeNext("+")?"++":"+":this.tryConsumeNext("-")?this.tryConsumeNext("-")?"--":"-":null}parseAmountAndTrackEmptyAbsAmount(){const e=a(this,w),[,t,n]=this.parseRegex(mr);if(t!=null&&t.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount can only start with 0 if it's exactly the digit 0.`);return[Lt(t,1)*(n==="'"?-1:1),!t]}parseAmount(){const e=a(this,w),[,t,n]=this.parseRegex(mr);if(t!=null&&t.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount number can only start with 0 if it's exactly the digit 0.`);return Lt(t,1)*(n==="'"?-1:1)}parseRegex(e){const t=e.exec(this.remaining());if(t===null)throw new Error("internal parsing error");return m(this,w,a(this,w)+t[0].length),t}tryRegex(e){const t=e.exec(this.remaining());return t===null?null:(m(this,w,a(this,w)+t[0].length),t)}remaining(){return a(this,W).slice(a(this,w))}popNext(){const e=a(this,W)[a(this,w)];return xn(this,w)._++,e}tryConsumeNext(e){return a(this,W)[a(this,w)]===e?(xn(this,w)._++,!0):!1}mustConsumeNext(e){const t=this.popNext();if(t!==e)throw new Error(`expected \`${e}\` while parsing, encountered ${t}`);return t}};W=new WeakMap;w=new WeakMap;var pr=new Set;function ni(e){pr.has(e)||(console.warn(e),pr.add(e))}var In=class{constructor(e,t=1){if(this.quantum=e,this.amount=t,!Number.isInteger(this.amount)||this.amount<sa||this.amount>Mn)throw new Error(`Unit amount absolute value must be a non-negative integer from ${rn} to ${rn}.`)}suffix(){let e="";const t=Math.abs(this.amount);return t!==1&&(e+=t),this.amount<0&&(e+="'"),e}isIdentical(e){return this.quantum.isIdentical(e.quantum)&&this.amount===e.amount}*experimentalExpand(e,t){const n=Math.abs(this.amount),r=na(e,this.amount<0);for(let i=0;i<n;i++)yield*this.quantum.experimentalExpand(r,t)}},ae,C,P,Ln=class extends Kr{constructor(e,t,n){if(super(),c(this,ae,void 0),c(this,C,void 0),c(this,P,void 0),m(this,ae,e),m(this,C,t??null),m(this,P,n??null),Object.freeze(this),a(this,C)!==null&&(!Number.isInteger(a(this,C))||a(this,C)<1||a(this,C)>Mn))throw new Error(`QuantumMove inner layer must be a positive integer below ${rn}.`);if(a(this,P)!==null&&(!Number.isInteger(a(this,P))||a(this,P)<1||a(this,P)>Mn))throw new Error(`QuantumMove outer layer must be a positive integer below ${rn}.`);if(a(this,P)!==null&&a(this,C)!==null&&a(this,C)<=a(this,P))throw new Error("QuantumMove outer layer must be smaller than inner layer.");if(a(this,P)!==null&&a(this,C)===null)throw new Error("QuantumMove with an outer layer must have an inner layer")}static fromString(e){return ma(e)}modified(e){return new Ln(e.family??a(this,ae),e.innerLayer??a(this,C),e.outerLayer??a(this,P))}isIdentical(e){const t=e;return e.is(Ln)&&a(this,ae)===a(t,ae)&&a(this,C)===a(t,C)&&a(this,P)===a(t,P)}get family(){return a(this,ae)}get outerLayer(){return a(this,P)}get innerLayer(){return a(this,C)}experimentalExpand(){throw new Error("experimentalExpand() cannot be called on a `QuantumMove` directly.")}toString(){let e=a(this,ae);return a(this,C)!==null&&(e=String(a(this,C))+e,a(this,P)!==null&&(e=String(a(this,P))+"-"+e)),e}},Be=Ln;ae=new WeakMap;C=new WeakMap;P=new WeakMap;var D,tt=class extends me{constructor(...e){if(super(),c(this,D,void 0),typeof e[0]=="string")if(e[1]??null){m(this,D,new In(Be.fromString(e[0]),e[1]));return}else return tt.fromString(e[0]);m(this,D,new In(e[0],e[1]))}isIdentical(e){const t=e.as(tt);return!!t&&a(this,D).isIdentical(a(t,D))}invert(){return pa(this,new tt(a(this,D).quantum,-this.amount))}*experimentalExpand(e=1){e===1?yield this:yield this.modified({amount:-this.amount})}get quantum(){return a(this,D).quantum}modified(e){return new tt(a(this,D).quantum.modified(e),e.amount??this.amount)}static fromString(e){return ha(e)}get amount(){return a(this,D).amount}get type(){return ni("deprecated: type"),"blockMove"}get family(){return a(this,D).quantum.family??void 0}get outerLayer(){return a(this,D).quantum.outerLayer??void 0}get innerLayer(){return a(this,D).quantum.innerLayer??void 0}toString(){if(this.family==="_SLASH_")return"/";if(this.family.endsWith("_PLUS_"))return a(this,D).quantum.toString().slice(0,-6)+Math.abs(this.amount)+(this.amount<0?"-":"+");if(this.family.endsWith("_PLUSPLUS_")){const e=Math.abs(this.amount);return a(this,D).quantum.toString().slice(0,-10)+(e===1?"":e)+(this.amount<0?"--":"++")}return a(this,D).quantum.toString()+a(this,D).suffix()}},l=tt;D=new WeakMap;var fa=class{constructor(){this.quantumU_SQ_=null,this.quantumD_SQ_=null}format(e){const t=this.tuple(e);return t?`(${t.map(n=>n.amount).join(", ")})`:null}tuple(e){var n,r;this.quantumU_SQ_||(this.quantumU_SQ_=new Be("U_SQ_")),this.quantumD_SQ_||(this.quantumD_SQ_=new Be("D_SQ_"));const t=e.alg;if(t.experimentalNumUnits()===2){const[i,s]=t.units();if((n=i.as(l))!=null&&n.quantum.isIdentical(this.quantumU_SQ_)&&((r=s.as(l))!=null&&r.quantum.isIdentical(this.quantumD_SQ_))){if(e.amount!==1)throw new Error("Square-1 tuples cannot have an amount other than 1.");return[i,s]}}return null}},fr=new fa,j,bn=class extends me{constructor(e,t){super(),c(this,j,void 0);const n=gt(e);m(this,j,new In(n,t))}isIdentical(e){const t=e;return e.is(bn)&&a(this,j).isIdentical(a(t,j))}get alg(){return a(this,j).quantum}get amount(){return a(this,j).amount}get experimentalRepetitionSuffix(){return a(this,j).suffix()}invert(){return new bn(a(this,j).quantum,-a(this,j).amount)}*experimentalExpand(e=1,t){t??(t=1/0),t===0?yield e===1?this:this.invert():yield*a(this,j).experimentalExpand(e,t-1)}static fromString(){throw new Error("unimplemented")}toString(){return fr.format(this)??`(${a(this,j).quantum.toString()})${a(this,j).suffix()}`}experimentalAsSquare1Tuple(){return fr.tuple(this)}},X=bn;j=new WeakMap;function te(e,t){return e instanceof t}function ga(e){return te(e,X)||te(e,xt)||te(e,Y)||te(e,V)||te(e,l)||te(e,de)||te(e,he)}function ri(e,t,n){if(t.is(X))return e.traverseGrouping(t,n);if(t.is(l))return e.traverseMove(t,n);if(t.is(Y))return e.traverseCommutator(t,n);if(t.is(V))return e.traverseConjugate(t,n);if(t.is(he))return e.traversePause(t,n);if(t.is(de))return e.traverseNewline(t,n);if(t.is(xt))return e.traverseLineComment(t,n);throw new Error("unknown unit")}function ii(e){if(e.is(X)||e.is(l)||e.is(Y)||e.is(V)||e.is(he)||e.is(de)||e.is(xt))return e;throw"internal error: expected unit"}var Xe=class{traverseUnit(e,t){return ri(this,e,t)}traverseIntoUnit(e,t){return ii(this.traverseUnit(e,t))}},Ze=class extends Xe{traverseUnit(e){return ri(this,e,void 0)}traverseIntoUnit(e){return ii(this.traverseUnit(e))}},ar,ai,si=class extends Xe{*traverseAlg(e,t){if(t.depth===0){yield*e.units();return}const n=[];let r=null;const i=(t==null?void 0:t.collapseMoves)??!0;function s(d,h){var f;const g=M(f=si,ar,ai).call(f,d,h,t);if(g===0)return!1;const v=new l(d.quantum,g);return n.push(v),r=v,!0}function o(d){i&&(r!=null&&r.is(l))&&d.is(l)&&r.quantum.isIdentical(d.quantum)?(n.pop(),s(r,d.amount)||(r=n.slice(-1)[0])):d.is(l)?s(d,0):(n.push(d),r=d)}const u={depth:t.depth?t.depth-1:null};for(const d of e.units())for(const h of this.traverseUnit(d,u))o(h);for(const d of n)yield d}*traverseGrouping(e,t){if(t.depth===0){yield e;return}const n={depth:t.depth?t.depth-1:null};yield new X(this.traverseAlg(e.alg,n))}*traverseMove(e,t){yield e}*traverseCommutator(e,t){if(t.depth===0){yield e;return}const n={depth:t.depth?t.depth-1:null};yield new Y(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n))}*traverseConjugate(e,t){if(t.depth===0){yield e;return}const n={depth:t.depth?t.depth-1:null};yield new V(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n))}*traversePause(e,t){yield e}*traverseNewline(e,t){yield e}*traverseLineComment(e,t){yield e}},oi=si;ar=new WeakSet;ai=function(e,t,n){let r=e.amount+t;if(n!=null&&n.quantumMoveOrder){const i=n.quantumMoveOrder(e.quantum),s=Math.floor(i/2)+1-i;r=(r%i+i-s)%i+s}return r};c(oi,ar);var gr=new oi,wa=gr.traverseAlg.bind(gr);function wr(e){if(!e)return[];if(te(e,p))return e.units();if(typeof e=="string")return ti(e).units();const t=e;if(typeof t[Symbol.iterator]=="function")return t;throw"Invalid unit"}function gt(e){return te(e,p)?e:new p(e)}var F,Ce=class extends me{constructor(e){super(),c(this,F,void 0),m(this,F,Array.from(wr(e)));for(const t of a(this,F))if(!ga(t))throw new Error("An alg can only contain units.")}isIdentical(e){const t=e;if(!e.is(Ce))return!1;const n=Array.from(a(this,F)),r=Array.from(a(t,F));if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(!n[i].isIdentical(r[i]))return!1;return!0}invert(){return new Ce(ra(Array.from(a(this,F)).map(e=>e.invert())))}*experimentalExpand(e=1,t){t??(t=1/0);for(const n of Jr(a(this,F),e))yield*n.experimentalExpand(e,t)}expand(e){return new Ce(this.experimentalExpand(1,(e==null?void 0:e.depth)??1/0))}*experimentalLeafMoves(){for(const e of this.experimentalExpand())e.is(l)&&(yield e)}concat(e){return new Ce(Array.from(a(this,F)).concat(Array.from(wr(e))))}experimentalIsEmpty(){for(const e of a(this,F))return!1;return!0}static fromString(e){return ti(e)}*units(){for(const e of a(this,F))yield e}experimentalNumUnits(){return Array.from(a(this,F)).length}get type(){return ni("deprecated: type"),"sequence"}toString(){let e="",t=null;for(const n of a(this,F))t&&(e+=va(t,n)),e+=n.toString(),t=n;return e}simplify(e){return new Ce(wa(this,e??{}))}},p=Ce;F=new WeakMap;function va(e,t){return e.is(de)||t.is(de)?"":e.is(xt)&&!t.is(de)?`
`:" "}new p([new l("R",1),new l("U",1),new l("R",-1),new l("U",1),new l("R",1),new l("U",-2),new l("R",-1)]),new p([new l("R",1),new l("U",2),new l("R",-1),new l("U",-1),new l("R",1),new l("U",-1),new l("R",-1)]),new p([new Y(new p([new l("R",1),new l("U",1),new l("R",-2)]),new p([new V(new p([new l("R",1)]),new p([new l("U",1)]))]))]),new p([new l("R",1),new l("U",-1),new l("L",-1),new l("U",1),new l("R",-1),new l("U",-1),new l("L",1),new l("U",1)]),new p([new l("x",-1),new Y(new p([new V(new p([new l("R",1)]),new p([new l("U",-1)]))]),new p([new l("D",1)])),new Y(new p([new V(new p([new l("R",1)]),new p([new l("U",1)]))]),new p([new l("D",1)])),new l("x",1)]),new p([new V(new p([new l("F",1)]),new p([new Y(new p([new l("U",1)]),new p([new l("R",1)]))]))]),new p([new V(new p([new l("R",2)]),new p([new Y(new p([new l("F",2)]),new p([new l("R",-1),new l("B",-1),new l("R",1)]))]))]),new p([new l("F",1),new l("U",1),new l("R",1),new l("U",-1),new l("R",-1),new l("F",-1)]),new p([new l("R",1),new l("U",1),new l("R",-1),new l("U",-1),new l("R",-1),new l("F",1),new l("R",2),new l("U",-1),new l("R",-1),new l("U",-1),new l("R",1),new l("U",1),new l("R",-1),new l("F",-1)]),new p([new V(new p([new l("F",1)]),new p([new X(new p([new Y(new p([new l("R",1)]),new p([new l("U",1)]))]),3)]))]),new p([new he,new he,new he]);new l("R"),new l("R'"),new l("B"),new l("B'"),new l("D"),new l("D'"),new l("L"),new l("L'"),new l("U"),new l("U'"),new l("F"),new l("F'"),new l("x'"),new l("l"),new l("l'"),new l("r"),new l("r'"),new l("d"),new l("d'"),new l("x"),new l("x"),new l("x'"),new l("y"),new l("y"),new l("y'"),new l("z"),new l("z'"),new l("M'"),new l("M'");function ya(e,t,n){const r=Array.from(e.units()),i=r[r.length-1];if(n!=null&&n.coalesce&&i&&i.quantum&&i.quantum.isIdentical(t.quantum)){const s=r.slice(0,r.length-1);let o=i.amount+t.amount;const u=n==null?void 0:n.mod;return u&&(o=(o%u+u)%u,o*2>u&&(o-=u)),o!==0&&s.push(i.modified({amount:o})),new p(s)}else return new p([...r,t])}function kn(e,t,n){const r={};for(const i in e.orbits){const s=e.orbits[i],o=t[i],u=n[i];if(an(s.numOrientations,u))r[i]=o;else if(an(s.numOrientations,o))r[i]=u;else{const d=new Array(s.numPieces);if(s.numOrientations===1){for(let h=0;h<s.numPieces;h++)d[h]=o.permutation[u.permutation[h]];r[i]={permutation:d,orientation:o.orientation}}else{const h=new Array(s.numPieces);for(let f=0;f<s.numPieces;f++)h[f]=(o.orientation[u.permutation[f]]+u.orientation[f])%s.numOrientations,d[f]=o.permutation[u.permutation[f]];r[i]={permutation:d,orientation:h}}}}return r}function vr(e,t,n){const r={};for(const i in e.orbits){const s=e.orbits[i],o=t[i],u=n[i];if(an(s.numOrientations,u))r[i]=o;else{const d=new Array(s.numPieces);if(s.numOrientations===1){for(let h=0;h<s.numPieces;h++)d[h]=o.pieces[u.permutation[h]];r[i]={pieces:d,orientation:o.orientation}}else{const h=new Array(s.numPieces);for(let f=0;f<s.numPieces;f++)h[f]=(o.orientation[u.permutation[f]]+u.orientation[f])%s.numOrientations,d[f]=o.pieces[u.permutation[f]];r[i]={pieces:d,orientation:h}}}}return r}var yr=new Map;function xa(e){const t=yr.get(e);if(t)return t;const n=new Array(e),r=new Array(e);for(let s=0;s<e;s++)n[s]=s,r[s]=0;const i={permutation:n,orientation:r};return yr.set(e,i),i}function Ma(e){const t={};for(const[n,r]of Object.entries(e.orbits))t[n]=xa(r.numPieces);return t}function za(e,t){var o;const n=t.quantum.toString();let r=e.definition.moves[n];if(!r){const u=(o=e.definition.experimentalDerivedMoves)==null?void 0:o[n];u&&(r=e.algToTransformation(u).transformationData)}if(r)return Qe(e,r,t.amount);const i=e.definition.moves[t.toString()];if(i)return i;const s=e.definition.moves[t.invert().toString()];if(s)return Qe(e,s,-1);throw new Error(`Invalid move for KPuzzle (${e.name()}): ${t}`)}function Sa(e,t){var n;return t.ignorePuzzleOrientation&&(e=Da(e)),t.ignoreCenterOrientation&&(e=new qe(e.kpuzzle,{EDGES:e.stateData.EDGES,CORNERS:e.stateData.CORNERS,CENTERS:{pieces:e.stateData.CENTERS.pieces,orientation:new Array(6).fill(0)}})),!!((n=e.experimentalToTransformation())!=null&&n.isIdentityTransformation())}var qe=class{constructor(e,t){this.kpuzzle=e,this.stateData=t}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),stateData:this.stateData}}static fromTransformation(e){const t=vr(e.kpuzzle.definition,e.kpuzzle.definition.startStateData,e.transformationData);return new qe(e.kpuzzle,t)}apply(e){return this.applyTransformation(this.kpuzzle.toTransformation(e))}applyTransformation(e){if(e.isIdentityTransformation())return new qe(this.kpuzzle,this.stateData);const t=vr(this.kpuzzle.definition,this.stateData,e.transformationData);return new qe(this.kpuzzle,t)}applyMove(e){return this.applyTransformation(this.kpuzzle.moveToTransformation(e))}applyAlg(e){return this.applyTransformation(this.kpuzzle.algToTransformation(e))}experimentalToTransformation(){if(!this.kpuzzle.canConvertStateToUniqueTransformation())return null;const e={};for(const[t,n]of Object.entries(this.stateData)){const r={permutation:n.pieces,orientation:n.orientation};e[t]=r}return new Ve(this.kpuzzle,e)}experimentalIs3x3x3Solved(e){if(this.kpuzzle.name()!=="3x3x3")throw new Error("`KState.experimentalIs3x3x3Solved()` only supports 3x3x3 states.");return Sa(this,e)}},we,ve=class{constructor(e,t){this.kpuzzle=e,this.transformationData=t,c(this,we,void 0)}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),transformationData:this.transformationData}}invert(){return new ve(this.kpuzzle,li(this.kpuzzle,this.transformationData))}isIdentityTransformation(){return a(this,we)??m(this,we,this.isIdentical(this.kpuzzle.identityTransformation()))}static experimentalConstructIdentity(e){const t=new ve(e,Ma(e.definition));return m(t,we,!0),t}isIdentical(e){return Ia(this.kpuzzle,this.transformationData,e.transformationData)}apply(e){return this.applyTransformation(this.kpuzzle.toTransformation(e))}applyTransformation(e){if(this.kpuzzle!==e.kpuzzle)throw new Error(`Tried to apply a transformation for a KPuzzle (${e.kpuzzle.name()}) to a different KPuzzle (${this.kpuzzle.name()}).`);return a(this,we)?new ve(this.kpuzzle,e.transformationData):a(e,we)?new ve(this.kpuzzle,this.transformationData):new ve(this.kpuzzle,kn(this.kpuzzle.definition,this.transformationData,e.transformationData))}applyMove(e){return this.applyTransformation(this.kpuzzle.moveToTransformation(e))}applyAlg(e){return this.applyTransformation(this.kpuzzle.algToTransformation(e))}toKState(){return qe.fromTransformation(this)}repetitionOrder(){return ka(this.kpuzzle.definition,this)}selfMultiply(e){return new ve(this.kpuzzle,Qe(this.kpuzzle,this.transformationData,e))}},Ve=ve;we=new WeakMap;function an(e,t){const{permutation:n}=t,r=n.length;for(let i=0;i<r;i++)if(n[i]!==i)return!1;if(e>1){const{orientation:i}=t;for(let s=0;s<r;s++)if(i[s]!==0)return!1}return!0}function Ta(e,t,n,r={}){for(let i=0;i<e.numPieces;i++)if(!(r!=null&&r.ignoreOrientation)&&t.orientation[i]!==n.orientation[i]||!(r!=null&&r.ignorePermutation)&&t.permutation[i]!==n.permutation[i])return!1;return!0}function Ia(e,t,n){for(const[r,i]of Object.entries(e.definition.orbits))if(!Ta(i,t[r],n[r]))return!1;return!0}function li(e,t){const n={};for(const r in e.definition.orbits){const i=e.definition.orbits[r],s=t[r];if(an(i.numOrientations,s))n[r]=s;else if(i.numOrientations===1){const o=new Array(i.numPieces);for(let u=0;u<i.numPieces;u++)o[s.permutation[u]]=u;n[r]={permutation:o,orientation:s.orientation}}else{const o=new Array(i.numPieces),u=new Array(i.numPieces);for(let d=0;d<i.numPieces;d++){const h=s.permutation[d];o[h]=d,u[h]=(i.numOrientations-s.orientation[d]+i.numOrientations)%i.numOrientations}n[r]={permutation:o,orientation:u}}}return n}function Qe(e,t,n){if(n===1)return t;if(n<0)return Qe(e,li(e,t),-n);if(n===0){const{transformationData:s}=e.identityTransformation();return s}let r=t;n!==2&&(r=Qe(e,t,Math.floor(n/2)));const i=kn(e.definition,r,r);return n%2===0?i:kn(e.definition,t,i)}var La=class extends Xe{traverseAlg(e,t){let n=null;for(const r of e.units())n?n=n.applyTransformation(this.traverseUnit(r,t)):n=this.traverseUnit(r,t);return n??t.identityTransformation()}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return new Ve(t,Qe(t,n.transformationData,e.amount))}traverseMove(e,t){return t.moveToTransformation(e)}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert()).applyTransformation(r.invert())}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert())}traversePause(e,t){return t.identityTransformation()}traverseNewline(e,t){return t.identityTransformation()}traverseLineComment(e,t){return t.identityTransformation()}},xr=new La,ba=xr.traverseAlg.bind(xr);function En(e,t){return t?En(t,e%t):e}function ka(e,t){let n=1;for(const r in e.orbits){const i=e.orbits[r],s=t.transformationData[r],o=new Array(i.numPieces);for(let u=0;u<i.numPieces;u++)if(!o[u]){let d=u,h=0,f=0;for(;o[d]=!0,h=h+s.orientation[d],f=f+1,d=s.permutation[d],d!==u;);h!==0&&(f=f*i.numOrientations/En(i.numOrientations,h)),n=n*f/En(n,f)}}return n}var nt,At,pe=class{constructor(e,t){this.definition=e,c(this,nt,new Map),c(this,At,void 0),this.experimentalPGNotation=t==null?void 0:t.experimentalPGNotation}name(){return this.definition.name}identityTransformation(){return Ve.experimentalConstructIdentity(this)}moveToTransformation(e){typeof e=="string"&&(e=new l(e));const t=e.toString(),n=a(this,nt).get(t);if(n)return new Ve(this,n);if(this.experimentalPGNotation){const i=this.experimentalPGNotation.lookupMove(e);if(!i)throw new Error(`could not map to internal move: ${e}`);return a(this,nt).set(t,i),new Ve(this,i)}const r=za(this,e);return a(this,nt).set(t,r),new Ve(this,r)}algToTransformation(e){return typeof e=="string"&&(e=new p(e)),ba(e,this)}toTransformation(e){var t,n;return typeof e=="string"?this.algToTransformation(e):(t=e==null?void 0:e.is)!=null&&t.call(e,p)?this.algToTransformation(e):(n=e==null?void 0:e.is)!=null&&n.call(e,l)?this.moveToTransformation(e):e}startState(){return new qe(this,this.definition.startStateData)}canConvertStateToUniqueTransformation(){return a(this,At)??m(this,At,(()=>{for(const[e,t]of Object.entries(this.definition.orbits)){const n=new Array(t.numPieces).fill(!1);for(const r of this.definition.startStateData[e].pieces)n[r]=!0;for(const r of n)if(!r)return!1}return!0})())}get state(){throw new Error("KPuzzle is now a different (stateless) class.")}reset(){throw new Error("KPuzzle is now a different (stateless) class.")}applyMove(e){throw new Error("KPuzzle is now a different class. Try `.moveToTransformation()` to get the transformation for a move.")}applyAlg(e){throw new Error("KPuzzle is now a different class. Try `.algToTransformation()` to get the transformation for an alg.")}};nt=new WeakMap;At=new WeakMap;var z={name:"3x3x3",orbits:{EDGES:{numPieces:12,numOrientations:2},CORNERS:{numPieces:8,numOrientations:3},CENTERS:{numPieces:6,numOrientations:4}},startStateData:{EDGES:{pieces:[0,1,2,3,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{pieces:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{pieces:[0,1,2,3,4,5],orientation:[0,0,0,0,0,0]}},moves:{U:{EDGES:{permutation:[1,2,3,0,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[1,0,0,0,0,0]}},y:{EDGES:{permutation:[1,2,3,0,5,6,7,4,10,8,11,9],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,7,4,5,6],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientation:[1,0,0,0,0,3]}},x:{EDGES:{permutation:[4,8,0,9,6,10,2,11,5,7,1,3],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,3,5,7,6,2,1],orientation:[2,1,2,1,1,2,1,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientation:[0,3,0,1,2,2]}},L:{EDGES:{permutation:[0,1,2,11,4,5,6,9,8,3,10,7],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientation:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,1,0,0,0,0]}},F:{EDGES:{permutation:[9,1,2,3,8,5,6,7,0,4,10,11],orientation:[1,0,0,0,1,0,0,0,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientation:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,1,0,0,0]}},R:{EDGES:{permutation:[0,8,2,3,4,10,6,7,5,9,1,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientation:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,1,0,0]}},B:{EDGES:{permutation:[0,1,10,3,4,5,11,7,8,9,6,2],orientation:[0,0,1,0,0,0,1,0,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientation:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,0,1,0]}},D:{EDGES:{permutation:[0,1,2,3,7,4,5,6,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,0,0,1]}},z:{EDGES:{permutation:[9,3,11,7,8,1,10,5,0,4,2,6],orientation:[1,1,1,1,1,1,1,1,1,1,1,1]},CORNERS:{permutation:[3,2,6,5,0,4,7,1],orientation:[1,2,1,2,2,1,2,1]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,1,1,3,1]}},M:{EDGES:{permutation:[2,1,6,3,0,5,4,7,8,9,10,11],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientation:[2,0,0,0,2,0]}},E:{EDGES:{permutation:[0,1,2,3,4,5,6,7,9,11,8,10],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientation:[0,0,0,0,0,0]}},S:{EDGES:{permutation:[0,3,2,7,4,1,6,5,8,9,10,11],orientation:[0,1,0,1,0,1,0,1,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,0,1,0,1]}},u:{EDGES:{permutation:[1,2,3,0,4,5,6,7,10,8,11,9],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientation:[1,0,0,0,0,0]}},l:{EDGES:{permutation:[2,1,6,11,0,5,4,9,8,3,10,7],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientation:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientation:[2,1,0,0,2,0]}},f:{EDGES:{permutation:[9,3,2,7,8,1,6,5,0,4,10,11],orientation:[1,1,0,1,1,1,0,1,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientation:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,1,1,0,1]}},r:{EDGES:{permutation:[4,8,0,3,6,10,2,7,5,9,1,11],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientation:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientation:[0,0,0,1,2,2]}},b:{EDGES:{permutation:[0,5,10,1,4,7,11,3,8,9,6,2],orientation:[0,1,1,1,0,1,1,1,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientation:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[3,0,2,5,4,1],orientation:[3,3,0,3,1,3]}},d:{EDGES:{permutation:[0,1,2,3,7,4,5,6,9,11,8,10],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientation:[0,0,0,0,0,1]}}}};z.moves.Uw=z.moves.u;z.moves.Lw=z.moves.l;z.moves.Fw=z.moves.f;z.moves.Rw=z.moves.r;z.moves.Bw=z.moves.b;z.moves.Dw=z.moves.d;z.moves.Rv=z.moves.x;z.moves.Uv=z.moves.y;z.moves.Fv=z.moves.z;z.moves.Lv={EDGES:{permutation:[2,10,6,11,0,8,4,9,1,3,5,7],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[1,7,6,2,0,3,5,4],orientation:[2,1,2,1,1,2,1,2]},CENTERS:{permutation:[4,1,0,3,5,2],orientation:[2,1,0,3,2,0]}};z.moves.Dv={EDGES:{permutation:[3,0,1,2,7,4,5,6,9,11,8,10],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[3,0,1,2,5,6,7,4],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientation:[3,0,0,0,0,1]}};z.moves.Bv={EDGES:{permutation:[8,5,10,1,9,7,11,3,4,0,6,2],orientation:[1,1,1,1,1,1,1,1,1,1,1,1]},CORNERS:{permutation:[4,7,1,0,5,3,2,6],orientation:[1,2,1,2,2,1,2,1]},CENTERS:{permutation:[3,0,2,5,4,1],orientation:[3,3,3,3,1,3]}};var ui=new pe(z);function ci(e){const t=e.stateData.CENTERS.pieces[0],n=e.stateData.CENTERS.pieces[5],r=e.stateData.CENTERS.pieces[1];let i=r;return t<r&&i--,n<r&&i--,[t,i]}var Mr=new Array(6).fill(0).map(()=>new Array(6));function Ea(){{const e=["","z","x","z'","x'","x2"].map(n=>p.fromString(n)),t=new p("y");for(const n of e){let r=ui.algToTransformation(n);for(let i=0;i<4;i++){r=r.applyAlg(t);const[s,o]=ci(r.toKState());Mr[s][o]=r.invert()}}}return Mr}function Da(e){const[t,n]=ci(e),r=Ea()[t][n];return e.applyTransformation(r)}async function Dn(e){return(await I(()=>import("./index.38d946f2.js"),[],import.meta.url)).getPuzzleGeometryByDesc(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function Aa(e){const t=await Dn(e),n=t.getKPuzzleDefinition(!0);n.name=`description: ${e}`;const r=await I(()=>import("./index.38d946f2.js"),[],import.meta.url),i=new r.ExperimentalPGNotation(t,t.getOrbitsDef(!0));return new pe(n,{experimentalPGNotation:i})}var Ca=1;function Pa(e,t){const n=Ca++;let r=null;const i={id:`custom-${n}`,fullName:(t==null?void 0:t.fullName)??`Custom Puzzle (instance #${n})`,kpuzzle:async()=>r??(r=Aa(e)),svg:async()=>(await Dn(e)).generatesvg(),pg:async()=>Dn(e)};return t!=null&&t.inventedBy&&(i.inventedBy=t.inventedBy),t!=null&&t.inventionYear&&(i.inventionYear=t.inventionYear),i}var Na={333:{puzzleID:"3x3x3",eventName:"3x3x3 Cube"},222:{puzzleID:"2x2x2",eventName:"2x2x2 Cube"},444:{puzzleID:"4x4x4",eventName:"4x4x4 Cube"},555:{puzzleID:"5x5x5",eventName:"5x5x5 Cube"},666:{puzzleID:"6x6x6",eventName:"6x6x6 Cube"},777:{puzzleID:"7x7x7",eventName:"7x7x7 Cube"},"333bf":{puzzleID:"3x3x3",eventName:"3x3x3 Blindfolded"},"333fm":{puzzleID:"3x3x3",eventName:"3x3x3 Fewest Moves"},"333oh":{puzzleID:"3x3x3",eventName:"3x3x3 One-Handed"},clock:{puzzleID:"clock",eventName:"Clock"},minx:{puzzleID:"megaminx",eventName:"Megaminx"},pyram:{puzzleID:"pyraminx",eventName:"Pyraminx"},skewb:{puzzleID:"skewb",eventName:"Skewb"},sq1:{puzzleID:"square1",eventName:"Square-1"},"444bf":{puzzleID:"4x4x4",eventName:"4x4x4 Blindfolded"},"555bf":{puzzleID:"5x5x5",eventName:"5x5x5 Blindfolded"},"333mb":{puzzleID:"3x3x3",eventName:"3x3x3 Multi-Blind"}},Ra={...Na,fto:{puzzleID:"fto",eventName:"Face-Turning Octahedron"},master_tetraminx:{puzzleID:"master_tetraminx",eventName:"Master Tetraminx"},kilominx:{puzzleID:"kilominx",eventName:"Kilominx"},redi_cube:{puzzleID:"redi_cube",eventName:"Redi Cube"}};function _a(e){return Ra[e]??null}function Dl(e,t,n,r,i){const o=e.orbits[t].pieces[n];if(o===null)return B;const u=o.facelets[r];return u===null?B:typeof u=="string"?u:i?u.hintAppearance??u.appearance:u.appearance}var di=(e=>(e.Regular="Regular",e.Dim="Dim",e.Ignored="Ignored",e.OrientationStickers="OrientationStickers",e.Invisible="Invisible",e.Ignoriented="Ignoriented",e.IgnoreNonPrimary="IgnoreNonPrimary",e.PermuteNonPrimary="PermuteNonPrimary",e.OrientationWithoutPermutation="OrientationWithoutPermutation",e))(di||{}),rt=class{constructor(e,t){this.stickerings=new Map;for(const[n,r]of Object.entries(e.definition.orbits))this.stickerings.set(n,new Array(r.numPieces).fill(t))}},B="regular",A="ignored",Pe="oriented",bt="invisible",Se="dim",Oa={facelets:[B,B,B,B,B]},Ua={facelets:[A,A,A,A,A]},Wa={facelets:[Pe,Pe,Pe,Pe,Pe]},ja={facelets:[bt,bt,bt,bt]},Fa={facelets:[B,A,A,A,A]},Va={facelets:[Se,B,B,B,B]},Ba={facelets:[Se,Se,Se,Se,Se]},qa={facelets:[Se,A,A,A,A]},Ga={facelets:[Pe,A,A,A,A]};function Qa(e){switch(e){case"Regular":return Oa;case"Dim":return Ba;case"Ignored":return Ua;case"OrientationStickers":return Wa;case"Invisible":return ja;case"IgnoreNonPrimary":return Fa;case"PermuteNonPrimary":return Va;case"Ignoriented":return qa;case"OrientationWithoutPermutation":return Ga}}var hi=class extends rt{constructor(e){super(e,"Regular")}set(e,t){for(const[n,r]of this.stickerings.entries())for(let i=0;i<r.length;i++)e.stickerings.get(n)[i]&&(r[i]=t);return this}toAppearance(){const e={orbits:{}};for(const[t,n]of this.stickerings.entries()){const r=[],i={pieces:r};e.orbits[t]=i;for(const s of n)r.push(Qa(s))}return e}},mi=class{constructor(e){this.kpuzzle=e}and(e){const t=new rt(this.kpuzzle,!1);for(const[n,r]of Object.entries(this.kpuzzle.definition.orbits)){e:for(let i=0;i<r.numPieces;i++){t.stickerings.get(n)[i]=!0;for(const s of e)if(!s.stickerings.get(n)[i]){t.stickerings.get(n)[i]=!1;continue e}}}return t}or(e){const t=new rt(this.kpuzzle,!1);for(const[n,r]of Object.entries(this.kpuzzle.definition.orbits)){e:for(let i=0;i<r.numPieces;i++){t.stickerings.get(n)[i]=!1;for(const s of e)if(s.stickerings.get(n)[i]){t.stickerings.get(n)[i]=!0;continue e}}}return t}not(e){const t=new rt(this.kpuzzle,!1);for(const[n,r]of Object.entries(this.kpuzzle.definition.orbits))for(let i=0;i<r.numPieces;i++)t.stickerings.get(n)[i]=!e.stickerings.get(n)[i];return t}all(){return this.and(this.moves([]))}move(e){const t=this.kpuzzle.moveToTransformation(e),n=new rt(this.kpuzzle,!1);for(const[r,i]of Object.entries(this.kpuzzle.definition.orbits))for(let s=0;s<i.numPieces;s++)(t.transformationData[r].permutation[s]!==s||t.transformationData[r].orientation[s]!==0)&&(n.stickerings.get(r)[s]=!0);return n}moves(e){return e.map(t=>this.move(t))}},pi=()=>{};function Ya(e){(async()=>{pi=e;const t=Array.from(document.body.querySelectorAll("twisty-player"));console.log(`Setting the custom stickering for ${t.length} players!`);const n=[];for(const r of t)n.push((async()=>{const i=await r.experimentalModel.twistySceneModel.stickering.get();r.experimentalStickering=i==="experimental-global-custom-1"?"experimental-global-custom-2":"experimental-global-custom-1"})());await Promise.all(n),console.log("Success!")})()}function Ha(e,t){pi(e,t)}globalThis.location&&new URL(location.href).searchParams.get("global-custom-stickerer")==="true"&&(window.setGlobalCustomStickerer=Ya,window.PieceStickering=di,console.log("Global custom stickerer enabled! (using: global-custom-stickerer=true)"),console.log("Look here for inspiration:","https://github.com/cubing/cubing.js/blob/81b5cab3e27d8defb39dd1e0a10bc9e8ba894d26/src/cubing/puzzles/stickerings/cube-stickerings.ts#L67"));async function Ye(e,t){const n=await e.kpuzzle(),r=new hi(n),i=new mi(n),s=()=>i.move("U"),o=()=>i.or(i.moves(["U","D"])),u=()=>i.not(o()),d=()=>i.or(i.moves(["L","R"])),h=()=>i.not(d()),f=()=>i.or(i.moves(["F","B"])),g=()=>i.not(f()),v=()=>i.not(s()),b=()=>i.and([s(),h(),g()]),O=()=>i.and([i.and(i.moves(["F","R"])),i.not(o())]),K=()=>i.and(i.moves(["D","R","F"])),ke=()=>i.or([K(),O()]),H=()=>i.or([i.and([h(),u()]),i.and([h(),g()]),i.and([u(),g()])]),ie=()=>i.or([i.and([h(),o(),f()]),i.and([u(),d(),f()]),i.and([g(),o(),d()])]),Q=()=>i.not(i.or([H(),ie()])),Tt=()=>i.or([h(),i.and([s(),ie()])]);function U(){r.set(v(),"Dim")}function hr(){r.set(s(),"PermuteNonPrimary"),r.set(b(),"Dim")}function It(){r.set(s(),"IgnoreNonPrimary"),r.set(b(),"Regular")}function ta(){r.set(s(),"Ignoriented"),r.set(b(),"Dim")}switch(t){case"full":break;case"PLL":U(),hr();break;case"CLS":U(),r.set(i.and(i.moves(["D","R","F"])),"Regular"),r.set(s(),"Ignoriented"),r.set(i.and([s(),h(),g()]),"Dim"),r.set(i.and([s(),Q()]),"IgnoreNonPrimary");break;case"OLL":U(),It();break;case"COLL":U(),hr(),r.set(i.and([s(),Q()]),"Regular");break;case"OCLL":U(),ta(),r.set(i.and([s(),Q()]),"IgnoreNonPrimary");break;case"CLL":U(),r.set(i.not(i.and([Q(),s()])),"Dim");break;case"ELL":U(),r.set(s(),"Dim"),r.set(i.and([s(),ie()]),"Regular");break;case"ELS":U(),It(),r.set(i.and([s(),Q()]),"Ignored"),r.set(O(),"Regular"),r.set(K(),"Ignored");break;case"LL":U();break;case"F2L":r.set(s(),"Ignored");break;case"ZBLL":U(),r.set(s(),"PermuteNonPrimary"),r.set(b(),"Dim"),r.set(i.and([s(),Q()]),"Regular");break;case"ZBLS":U(),r.set(ke(),"Regular"),It(),r.set(i.and([s(),Q()]),"Ignored");break;case"WVLS":case"VLS":U(),r.set(ke(),"Regular"),It();break;case"LS":U(),r.set(ke(),"Regular"),r.set(s(),"Ignored"),r.set(b(),"Dim");break;case"EO":r.set(Q(),"Ignored"),r.set(ie(),"OrientationWithoutPermutation");break;case"EOline":r.set(Q(),"Ignored"),r.set(ie(),"OrientationWithoutPermutation"),r.set(i.and(i.moves(["D","M"])),"Regular");break;case"EOcross":r.set(ie(),"OrientationWithoutPermutation"),r.set(i.move("D"),"Regular"),r.set(Q(),"Ignored");break;case"CMLL":r.set(v(),"Dim"),r.set(Tt(),"Ignored"),r.set(i.and([s(),Q()]),"Regular");break;case"L6E":r.set(i.not(Tt()),"Dim");break;case"L6EO":r.set(i.not(Tt()),"Dim"),r.set(Tt(),"OrientationWithoutPermutation"),r.set(i.and([H(),o()]),"OrientationStickers");break;case"Daisy":r.set(i.all(),"Ignored"),r.set(H(),"Dim"),r.set(i.and([i.move("D"),H()]),"Regular"),r.set(i.and([i.move("U"),ie()]),"IgnoreNonPrimary");break;case"Cross":r.set(i.all(),"Ignored"),r.set(H(),"Dim"),r.set(i.and([i.move("D"),H()]),"Regular"),r.set(i.and([i.move("D"),ie()]),"Regular");break;case"2x2x2":r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),H()]),"Dim");break;case"2x2x3":r.set(i.all(),"Dim"),r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),H()]),"Dim"),r.set(i.and([i.move("F"),i.not(i.or(i.moves(["U","R"])))]),"Regular");break;case"Void Cube":r.set(H(),"Invisible");break;case"picture":case"invisible":r.set(i.all(),"Invisible");break;case"centers-only":r.set(i.not(H()),"Ignored");break;case"experimental-global-custom-1":case"experimental-global-custom-2":Ha(r,i);break;default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r.toAppearance()}async function sr(){return["full","PLL","CLS","OLL","COLL","OCLL","ELL","ELS","LL","F2L","ZBLL","ZBLS","WVLS","VLS","LS","EO","EOline","EOcross","CMLL","L6E","L6EO","Daisy","Cross","2x2x2","2x2x3","Void Cube","picture","invisible","centers-only"]}function _(e){let t=null;return()=>t??(t=e())}async function fn(e){return(await I(()=>import("./index.38d946f2.js"),[],import.meta.url)).getPuzzleGeometryByName(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function $a(e,t){const n=await e,r=n.getKPuzzleDefinition(!0);r.name=t;const i=await I(()=>import("./index.38d946f2.js"),[],import.meta.url),s=new i.ExperimentalPGNotation(n,n.getOrbitsDef(!0));return new pe(r,{experimentalPGNotation:s})}var Ct,Pt,Nt,Ie=class{constructor(e){c(this,Ct,void 0),c(this,Pt,void 0),c(this,Nt,void 0),this.pgId=e.pgID,this.id=e.id,this.fullName=e.fullName,this.inventedBy=e.inventedBy,this.inventionYear=e.inventionYear}pg(){return a(this,Ct)??m(this,Ct,fn(this.pgId??this.id))}kpuzzle(){return a(this,Pt)??m(this,Pt,$a(this.pg(),this.id))}svg(){return a(this,Nt)??m(this,Nt,(async()=>(await this.pg()).generatesvg())())}};Ct=new WeakMap;Pt=new WeakMap;Nt=new WeakMap;var Ke=class extends Ie{constructor(){super(...arguments),this.stickerings=sr}appearance(e){return Ye(this,e)}},fi={id:"2x2x2",fullName:"2×2×2 Cube",kpuzzle:_(async()=>new pe((await I(()=>import("./2x2x2.kpuzzle.json-BHTFIME6.4e3bdc4e.js"),[],import.meta.url)).cube2x2x2KPuzzleDefinition)),svg:async()=>(await I(()=>import("./2x2x2.kpuzzle.svg-CYX37VBY.c413c52d.js"),[],import.meta.url)).default,pg:_(async()=>fn("2x2x2")),appearance:e=>Ye(fi,e),stickerings:sr},or={id:"3x3x3",fullName:"3×3×3 Cube",inventedBy:["Ernő Rubik"],inventionYear:1974,kpuzzle:_(async()=>ui),svg:_(async()=>(await I(()=>import("./3x3x3.kpuzzle.svg-5U7LUACF.49bc8095.js"),[],import.meta.url)).default),llSVG:_(async()=>(await I(()=>import("./3x3x3-ll.kpuzzle.svg-KZNSV76X.4e603eeb.js"),[],import.meta.url)).default),pg:_(async()=>fn("3x3x3")),appearance:e=>Ye(or,e),stickerings:sr},Xa={id:"clock",fullName:"Clock",inventedBy:["Christopher C. Wiggs","Christopher J. Taylor"],inventionYear:1988,kpuzzle:_(async()=>new pe((await I(()=>import("./clock.kpuzzle.json-PYHONPBY.289d7e31.js"),[],import.meta.url)).clockKPuzzleDefinition)),svg:_(async()=>(await I(()=>import("./clock.kpuzzle.svg-JSRDCSQF.68844df7.js"),[],import.meta.url)).default)};async function Za(e,t){const n=await e.kpuzzle(),r=new hi(n),i=new mi(n),s=()=>i.and([i.move("U"),i.not(i.or(i.moves(["F","BL","BR"])))]),o=()=>i.and([i.move("U"),i.not(i.move("F"))]),u=()=>i.or([o(),i.and([i.move("F"),i.not(i.or(i.moves(["U","BL","BR"])))])]),d=()=>i.not(i.or([i.and([i.move("U"),i.move("F")]),i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])])),h=()=>i.not(i.or([i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])]));switch(t){case"full":break;case"experimental-fto-fc":r.set(i.not(s()),"Ignored");break;case"experimental-fto-f2t":r.set(i.not(o()),"Ignored"),r.set(s(),"Dim");break;case"experimental-fto-sc":r.set(i.not(u()),"Ignored"),r.set(o(),"Dim");break;case"experimental-fto-l2c":r.set(i.not(d()),"Ignored"),r.set(u(),"Dim");break;case"experimental-fto-lbt":r.set(i.not(h()),"Ignored"),r.set(d(),"Dim");break;case"experimental-fto-l3t":r.set(h(),"Dim");break;default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r.toAppearance()}async function Ka(){return["full","experimental-fto-fc","experimental-fto-f2t","experimental-fto-sc","experimental-fto-l2c","experimental-fto-lbt","experimental-fto-l3t"]}var Ja=class extends Ie{constructor(){super({pgID:"FTO",id:"fto",fullName:"Face-Turning Octahedron",inventedBy:["Karl Rohrbach","David Pitcher"],inventionYear:1983}),this.stickerings=Ka,this.svg=_(async()=>(await I(()=>import("./fto.kpuzzle.svg-H2RJX6UR.cbbdf211.js"),[],import.meta.url)).ftoSVG)}appearance(e){return Za(this,e)}},es=new Ja;async function ts(e,t){switch(t){case"full":case"F2L":case"LL":return Ye(e,t);default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`)}return Ye(e,"full")}async function ns(){return["full","F2L","LL"]}var rs=class extends Ie{constructor(){super({id:"megaminx",fullName:"Megaminx",inventionYear:1981}),this.stickerings=ns}appearance(e){return ts(this,e)}},is=new rs,as=class extends Ie{constructor(){super({id:"pyraminx",fullName:"Pyraminx",inventedBy:["Uwe Meffert"]}),this.svg=_(async()=>(await I(()=>import("./pyraminx.kpuzzle.svg-UHDZCBET.a39aaa53.js"),[],import.meta.url)).default)}},ss=new as,os={id:"square1",fullName:"Square-1",inventedBy:["Karel Hršel","Vojtech Kopský"],inventionYear:1990,kpuzzle:_(async()=>new pe((await I(()=>import("./sq1-hyperorbit.kpuzzle.json-AMXAFQCM.5dc076c2.js"),[],import.meta.url)).sq1HyperOrbitKPuzzleDefinition)),svg:_(async()=>(await I(()=>import("./sq1-hyperorbit.kpuzzle.svg-MNHJTJ6V.dd33941a.js"),[],import.meta.url)).default)},ls={id:"kilominx",fullName:"Kilominx",kpuzzle:_(async()=>{const e=await fn("megaminx + chopasaurus"),t=JSON.parse(JSON.stringify(e.getKPuzzleDefinition(!0)));delete t.orbits.CENTERS,delete t.orbits.CENTERS2,delete t.startStateData.CENTERS,delete t.startStateData.CENTERS2;for(const o of Object.values(t.moves))delete o.CENTERS,delete o.CENTERS2;t.name="kilominx",delete t.experimentalPuzzleDescription;const n=await I(()=>import("./index.38d946f2.js"),[],import.meta.url),r=new n.ExperimentalPGNotation(e,e.getOrbitsDef(!0)),i=new pe(t,{experimentalPGNotation:{lookupMove:o=>o.toString()==="x2"||o.toString()==="x2'"?s.transformationData:r.lookupMove(o)}}),s=i.algToTransformation("Rv2 Fv Uv'");return t.moves.x2=s,i}),svg:_(async()=>(await I(()=>import("./kilominx.kpuzzle.svg-ZLRTRUTM.d7e1050d.js"),[],import.meta.url)).kilominxSVG)},us={id:"redi_cube",fullName:"Redi Cube",inventedBy:["Oskar van Deventer"],inventionYear:2009,kpuzzle:_(async()=>new pe((await I(()=>import("./redi_cube.kpuzzle.json-43CP47Z6.4e3ca445.js"),[],import.meta.url)).rediCubeKPuzzleDefinition)),svg:async()=>(await I(()=>import("./redi_cube.kpuzzle.svg-3DWDYE3O.35c60da3.js"),[],import.meta.url)).rediCubeSVG},gi={"3x3x3":or,"2x2x2":fi,"4x4x4":new Ke({id:"4x4x4",fullName:"4×4×4 Cube"}),"5x5x5":new Ke({id:"5x5x5",fullName:"5×5×5 Cube"}),"6x6x6":new Ke({id:"6x6x6",fullName:"6×6×6 Cube"}),"7x7x7":new Ke({id:"7x7x7",fullName:"7×7×7 Cube"}),"40x40x40":new Ke({id:"40x40x40",fullName:"40×40×40 Cube"}),clock:Xa,megaminx:is,pyraminx:ss,skewb:new Ie({id:"skewb",fullName:"Skewb",inventedBy:["Tony Durham"]}),square1:os,fto:es,gigaminx:new Ie({id:"gigaminx",fullName:"Gigaminx",inventedBy:["Tyler Fox"],inventionYear:2006}),master_tetraminx:new Ie({pgID:"master tetraminx",id:"master_tetraminx",fullName:"Master Tetraminx",inventedBy:["Katsuhiko Okamoto"],inventionYear:2002}),kilominx:ls,redi_cube:us},Rt=class extends Promise{constructor(e){super(t=>{t()}),this._executor=e}static from(e){return new Rt(t=>{t(e())})}static resolve(e){return new Rt(t=>{t(e)})}static reject(e){return new Rt((t,n)=>{n(e)})}then(e,t){return this._promise=this._promise||new Promise(this._executor),this._promise.then(e,t)}catch(e){return this._promise=this._promise||new Promise(this._executor),this._promise.catch(e)}};function wi(e){return new Rt(t=>{t(e())})}var An,_t,gn=class{constructor(){c(this,An,0),c(this,_t,0)}queue(e){return new Promise(async(t,n)=>{try{const r=++xn(this,An)._,i=await e;r>a(this,_t)&&(m(this,_t,r),t(i))}catch(r){n(r)}})}};An=new WeakMap;_t=new WeakMap;var vi=0,Ne,ft,Cn,yi,He,lr,xi,it,Mi=class{constructor(){c(this,Cn),c(this,lr),c(this,Ne,new Set),this.lastSourceGeneration=0,c(this,ft,new Set),c(this,He,!1),c(this,it,new Map)}canReuse(e,t){return e===t||this.canReuseValue(e,t)}canReuseValue(e,t){return!1}debugGetChildren(){return Array.from(a(this,Ne).values())}addChild(e){a(this,Ne).add(e)}removeChild(e){a(this,Ne).delete(e)}markStale(e){if(e.detail.generation!==vi)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==e.detail.generation){this.lastSourceGeneration=e.detail.generation;for(const t of a(this,Ne))t.markStale(e);M(this,Cn,yi).call(this)}}addRawListener(e,t){a(this,ft).add(e),t!=null&&t.initial&&e()}removeRawListener(e){a(this,ft).delete(e)}addFreshListener(e){const t=new gn;let n=null;const r=async()=>{const i=await t.queue(this.get());n!==null&&this.canReuse(n,i)||(n=i,e(i))};a(this,it).set(e,r),this.addRawListener(r,{initial:!0})}removeFreshListener(e){this.removeRawListener(a(this,it).get(e)),a(this,it).delete(e)}};Ne=new WeakMap;ft=new WeakMap;Cn=new WeakSet;yi=function(){a(this,He)||(m(this,He,!0),setTimeout(()=>M(this,lr,xi).call(this),0))};He=new WeakMap;lr=new WeakSet;xi=function(){if(!a(this,He))throw new Error("Invalid dispatch state!");for(const e of a(this,ft))e();m(this,He,!1)};it=new WeakMap;var J,be=class extends Mi{constructor(e){super(),c(this,J,void 0),m(this,J,wi(()=>this.getDefaultValue())),e&&m(this,J,this.deriveFromPromiseOrValue(e,a(this,J)))}set(e){m(this,J,this.deriveFromPromiseOrValue(e,a(this,J)));const t={sourceProp:this,value:a(this,J),generation:++vi};this.markStale(new CustomEvent("stale",{detail:t}))}async get(){return a(this,J)}async deriveFromPromiseOrValue(e,t){return this.derive(await e,t)}};J=new WeakMap;var L=class extends be{derive(e){return e}},wt=Symbol("no value"),Le,sn,at,Pn,zi,Nn,Si,x=class extends Mi{constructor(e,t){super(),this.userVisibleErrorTracker=t,c(this,Pn),c(this,Nn),c(this,Le,void 0),c(this,sn,null),c(this,at,null),m(this,Le,e);for(const n of Object.values(e))n.addChild(this)}async get(){var n,r;const e=this.lastSourceGeneration;if(((n=a(this,at))==null?void 0:n.generation)===e)return a(this,at).output;const t={generation:e,output:M(this,Nn,Si).call(this,M(this,Pn,zi).call(this),e,a(this,sn))};return m(this,at,t),(r=this.userVisibleErrorTracker)==null||r.reset(),t.output}};Le=new WeakMap;sn=new WeakMap;at=new WeakMap;Pn=new WeakSet;zi=async function(){const e={};for(const[n,r]of Object.entries(a(this,Le)))e[n]=r.get();const t={};for(const n in a(this,Le))t[n]=await e[n];return t};Nn=new WeakSet;Si=async function(e,t,n=null){const r=await e,i=o=>(m(this,sn,{inputs:r,output:Promise.resolve(o),generation:t}),o);if(!n)return i(await this.derive(r));const s=n.inputs;for(const o in a(this,Le))if(!a(this,Le)[o].canReuse(r[o],s[o]))return i(await this.derive(r));return n.output};var st,Mt=class{constructor(){c(this,st,[])}addListener(e,t){let n=!1;const r=i=>{n||t(i)};e.addFreshListener(r),a(this,st).push(()=>{e.removeFreshListener(r),n=!0})}addMultiListener(e,t){let n=!1,r=e.length-1;const i=async s=>{if(r>0){r--;return}if(n)return;const o=e.map(d=>d.get()),u=await Promise.all(o);t(u)};for(const s of e)s.addFreshListener(i);a(this,st).push(()=>{for(const s of e)s.removeFreshListener(i);n=!0})}disconnect(){for(const e of a(this,st))e()}};st=new WeakMap;var Al={full:!0,"centers-only":!0,PLL:!0,CLS:!0,OLL:!0,COLL:!0,OCLL:!0,CLL:!0,ELL:!0,ELS:!0,LL:!0,F2L:!0,ZBLL:!0,ZBLS:!0,WVLS:!0,VLS:!0,LS:!0,EO:!0,EOline:!0,EOcross:!0,CMLL:!0,L6E:!0,L6EO:!0,Daisy:!0,Cross:!0,"2x2x2":!0,"2x2x3":!0,"Void Cube":!0,invisible:!0,picture:!0,"experimental-centers-U":!0,"experimental-centers-U-D":!0,"experimental-centers-U-L-D":!0,"experimental-centers-U-L-B-D":!0,"experimental-centers":!0,"experimental-fto-fc":!0,"experimental-fto-f2t":!0,"experimental-fto-sc":!0,"experimental-fto-l2c":!0,"experimental-fto-lbt":!0,"experimental-fto-l3t":!0,"experimental-global-custom-1":!0,"experimental-global-custom-2":!0},cs=class extends L{getDefaultValue(){return"full"}},Cl={floating:!0,none:!0},ds=class extends L{getDefaultValue(){return"auto"}},hs=Math.PI*2,vt=360/hs,zr=null;async function Ti(){return zr??(zr=I(()=>import("./3d-dynamic-BOMV4HRU.e39a8f1b.js"),[],import.meta.url))}var q=wi(async()=>(await Ti()).T3I),Ii=class extends Ze{constructor(e){super(),this.metric=e}traverseAlg(e){let t=0;for(const n of e.units())t+=this.traverseUnit(n);return t}traverseGrouping(e){const t=e.alg;return this.traverseAlg(t)*Math.abs(e.amount)}traverseMove(e){return this.metric(e)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 0}traverseNewline(e){return 0}traverseLineComment(e){return 0}};function Li(e){return"A"<=e&&e<="Z"}function ms(e){const t=e.family;return Li(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:1}function ps(e){const t=e.family;return Li(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:Math.abs(e.amount)}var Sr=new Ii(ms),bi=Sr.traverseAlg.bind(Sr),Tr=new Ii(ps);Tr.traverseAlg.bind(Tr);var fs=class extends Ze{traverseAlg(e){let t=0;for(const n of e.units())t+=this.traverseUnit(n);return t}traverseGrouping(e){return this.traverseAlg(e.alg)*Math.abs(e.amount)}traverseMove(e){return 1}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 1}traverseNewline(e){return 0}traverseLineComment(e){return 0}},Ir=new fs,gs=Ir.traverseAlg.bind(Ir);var zt=class{constructor(e){this.callback=e,this.animFrameID=null,this.animFrame=this.animFrameWrapper.bind(this)}requestAnimFrame(){this.animFrameID||(this.animFrameID=requestAnimationFrame(this.animFrame))}cancelAnimFrame(){this.animFrameID&&(cancelAnimationFrame(this.animFrameID),this.animFrameID=0)}animFrameWrapper(e){this.animFrameID=0,this.callback(e)}};function Rn(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Lr(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function ki(e,t,n=0){return(e%t+t+n)%t-n}function br(e,t,n){return ki(e-t,n-t)+t}var ws=class{constructor(e){this.model=e,this.catchingUp=!1,this.pendingFrame=!1,this.scheduler=new zt(this.animFrame.bind(this)),this.catchUpMs=500,this.lastTimestamp=0}start(){this.catchingUp||(this.lastTimestamp=performance.now()),this.catchingUp=!0,this.pendingFrame=!0,this.scheduler.requestAnimFrame()}stop(){this.catchingUp=!1,this.scheduler.cancelAnimFrame()}animFrame(e){this.scheduler.requestAnimFrame();const t=(e-this.lastTimestamp)/this.catchUpMs;this.lastTimestamp=e,this.model.catchUpMove.set((async()=>{const n=await this.model.catchUpMove.get();if(n.move===null)return n;const r=n.amount+t;return r>=1?(this.pendingFrame=!0,this.stop(),this.model.timestampRequest.set("end"),{move:null,amount:0}):(this.pendingFrame=!1,{move:n.move,amount:r})})())}},Ot,_n,On,vs=class{constructor(e,t){this.delegate=t,c(this,Ot),this.playing=!1,this.direction=1,this.lastDatestamp=0,this.scheduler=new zt(this.animFrame.bind(this)),c(this,On,new gn),this.model=e,this.lastTimestampPromise=M(this,Ot,_n).call(this),this.model.playingInfo.addFreshListener(this.onPlayingProp.bind(this)),this.catchUpHelper=new ws(this.model),this.model.catchUpMove.addFreshListener(this.onCatchUpMoveProp.bind(this))}async onPlayingProp(e){e.playing!==this.playing&&(e.playing?this.play(e):this.pause())}async onCatchUpMoveProp(e){const t=e.move!==null;t!==this.catchUpHelper.catchingUp&&(t?this.catchUpHelper.start():this.catchUpHelper.stop()),this.scheduler.requestAnimFrame()}jumpToStart(e){this.model.timestampRequest.set("start"),this.pause(),e!=null&&e.flash&&this.delegate.flash()}jumpToEnd(e){this.model.timestampRequest.set("end"),this.pause(),e!=null&&e.flash&&this.delegate.flash()}playPause(){this.playing?this.pause():this.play()}async play(e){const t=(e==null?void 0:e.direction)??1,n=await this.model.coarseTimelineInfo.get();((e==null?void 0:e.autoSkipToOtherEndIfStartingAtBoundary)??!0)&&(t===1&&n.atEnd&&(this.model.timestampRequest.set("start"),this.delegate.flash()),t===-1&&n.atStart&&(this.model.timestampRequest.set("end"),this.delegate.flash())),this.model.playingInfo.set({playing:!0,direction:t,untilBoundary:(e==null?void 0:e.untilBoundary)??"entire-timeline",loop:(e==null?void 0:e.loop)??!1}),this.playing=!0,this.lastDatestamp=performance.now(),this.lastTimestampPromise=M(this,Ot,_n).call(this),this.scheduler.requestAnimFrame()}pause(){this.playing=!1,this.scheduler.cancelAnimFrame(),this.model.playingInfo.set({playing:!1,untilBoundary:"entire-timeline"})}async animFrame(e){this.playing&&this.scheduler.requestAnimFrame();const t=this.lastDatestamp,n=await a(this,On).queue(Promise.all([this.model.playingInfo.get(),this.lastTimestampPromise,this.model.timeRange.get(),this.model.tempoScale.get(),this.model.currentMoveInfo.get()])),[r,i,s,o,u]=n;if(!r.playing){this.playing=!1;return}let d=u.earliestEnd;(u.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(d=s.end);let h=u.latestStart;(u.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(h=s.start);let f=(e-t)*this.direction*o;f=Math.max(f,1),f*=r.direction;let g=i+f,v=null;g>=d?r.loop?g=br(g,s.start,s.end):(g===s.end?v="end":g=d,this.playing=!1,this.model.playingInfo.set({playing:!1})):g<=h&&(r.loop?g=br(g,s.start,s.end):(g===s.start?v="start":g=h,this.playing=!1,this.model.playingInfo.set({playing:!1}))),this.lastDatestamp=e,this.lastTimestampPromise=Promise.resolve(g),this.model.timestampRequest.set(v??g)}};Ot=new WeakSet;_n=async function(){return(await this.model.detailedTimelineInfo.get()).timestamp};On=new WeakMap;var ys=class{constructor(e,t){this.model=e,this.animationController=new vs(e,t)}jumpToStart(e){this.animationController.jumpToStart(e)}jumpToEnd(e){this.animationController.jumpToEnd(e)}togglePlay(e){typeof e>"u"&&this.animationController.playPause(),e?this.animationController.play():this.animationController.pause()}async visitTwizzleLink(){const e=document.createElement("a");e.href=await this.model.twizzleLink(),e.target="_blank",e.click()}},xs={"bottom-row":!0,none:!0},Ms=class extends L{getDefaultValue(){return"auto"}},zs=class{},yt;globalThis.HTMLElement?yt=HTMLElement:yt=zs;var Ss=class{define(){}},N;globalThis.customElements?N=customElements:N=new Ss;var Z=class{constructor(e){this.sourceText=e}getAsString(){return this.sourceText}},Re,G=class extends yt{constructor(e){super(),c(this,Re,new Map),this.shadow=this.attachShadow({mode:(e==null?void 0:e.mode)??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}addCSS(e){const t=a(this,Re).get(e);if(t)return t;const n=document.createElement("style");return n.textContent=e.getAsString(),a(this,Re).set(e,n),this.shadow.appendChild(n),n}removeCSS(e){const t=a(this,Re).get(e);t&&(this.shadow.removeChild(t),a(this,Re).delete(e))}addElement(e){return this.contentWrapper.appendChild(e)}prependElement(e){this.contentWrapper.prepend(e)}removeElement(e){return this.contentWrapper.removeChild(e)}};Re=new WeakMap;N.define("twisty-managed-custom-element",G);var Ei=new Z(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.wrapper > * {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.wrapper.back-view-side-by-side {
  grid-template-columns: 1fr 1fr;
}

.wrapper.back-view-top-right {
  grid-template-columns: 3fr 1fr;
  grid-template-rows: 1fr 3fr;
}

.wrapper.back-view-top-right > :nth-child(1) {
  grid-row: 1 / 3;
  grid-column: 1 / 3;
}

.wrapper.back-view-top-right > :nth-child(2) {
  grid-row: 1 / 2;
  grid-column: 2 / 3;
}
`),Ts=new Z(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.svg-wrapper,
twisty-2d-svg,
svg {
  width: 100%;
  height: 100%;
  display: grid;
  min-height: 0;
}

svg {
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}
`),kt="http://www.w3.org/2000/svg",kr=0;function Is(){return kr+=1,"svg"+kr.toString()}var Ls={dim:{white:"#dddddd",orange:"#884400",limegreen:"#008800",red:"#660000","rgb(34, 102, 255)":"#000088",yellow:"#888800"},oriented:{white:"#44ddcc",orange:"#44ddcc",limegreen:"#44ddcc",red:"#44ddcc","rgb(34, 102, 255)":"#44ddcc",yellow:"#44ddcc"},ignored:{white:"#444444",orange:"#444444",limegreen:"#444444",red:"#444444","rgb(34, 102, 255)":"#444444",yellow:"#444444"},invisible:{white:"#00000000",orange:"#00000000",limegreen:"#00000000",red:"#00000000","rgb(34, 102, 255)":"#00000000",yellow:"#00000000"}},bs=class{constructor(e,t,n){if(this.kpuzzle=e,this.originalColors={},this.gradients={},!t)throw new Error(`No SVG definition for puzzle type: ${e.name()}`);this.svgID=Is(),this.element=document.createElement("div"),this.element.classList.add("svg-wrapper"),this.element.innerHTML=t;const r=this.element.querySelector("svg");if(!r)throw new Error("Could not get SVG element");if(kt!==r.namespaceURI)throw new Error("Unexpected XML namespace");r.style.maxWidth="100%",r.style.maxHeight="100%",this.gradientDefs=document.createElementNS(kt,"defs"),r.insertBefore(this.gradientDefs,r.firstChild);for(const i in e.definition.orbits){const s=e.definition.orbits[i];for(let o=0;o<s.numPieces;o++)for(let u=0;u<s.numOrientations;u++){const d=this.elementID(i,o,u),h=this.elementByID(d);let f=h.style.fill;n?(()=>{const g=n.orbits;if(!g)return;const v=g[i];if(!v)return;const b=v.pieces[o];if(!b)return;const O=b.facelets[u];if(!O)return;const K=typeof O=="string"?O:O==null?void 0:O.appearance,ke=Ls[K];ke&&(f=ke[f])})():f=h.style.fill,this.originalColors[d]=f,this.gradients[d]=this.newGradient(d,f),this.gradientDefs.appendChild(this.gradients[d]),h.setAttribute("style",`fill: url(#grad-${this.svgID}-${d})`)}}}drawState(e,t,n){this.draw(e,t,n)}draw(e,t,n){const r=e.experimentalToTransformation(),i=t==null?void 0:t.experimentalToTransformation();if(!r)throw new Error("Distinguishable pieces are not handled for SVG yet!");for(const s in r.kpuzzle.definition.orbits){const o=r.kpuzzle.definition.orbits[s],u=r.transformationData[s],d=i?i.transformationData[s]:null;for(let h=0;h<o.numPieces;h++)for(let f=0;f<o.numOrientations;f++){const g=this.elementID(s,h,f),v=this.elementID(s,u.permutation[h],(o.numOrientations-u.orientation[h]+f)%o.numOrientations);let b=!1;if(d){const O=this.elementID(s,d.permutation[h],(o.numOrientations-d.orientation[h]+f)%o.numOrientations);v===O&&(b=!0),n=n||0;const K=100*(1-n*n*(2-n*n));this.gradients[g].children[0].setAttribute("stop-color",this.originalColors[v]),this.gradients[g].children[1].setAttribute("stop-color",this.originalColors[v]),this.gradients[g].children[1].setAttribute("offset",`${Math.max(K-5,0)}%`),this.gradients[g].children[2].setAttribute("offset",`${Math.max(K-5,0)}%`),this.gradients[g].children[3].setAttribute("offset",`${K}%`),this.gradients[g].children[4].setAttribute("offset",`${K}%`),this.gradients[g].children[4].setAttribute("stop-color",this.originalColors[O]),this.gradients[g].children[5].setAttribute("stop-color",this.originalColors[O])}else b=!0;b&&(this.gradients[g].children[0].setAttribute("stop-color",this.originalColors[v]),this.gradients[g].children[1].setAttribute("stop-color",this.originalColors[v]),this.gradients[g].children[1].setAttribute("offset","100%"),this.gradients[g].children[2].setAttribute("offset","100%"),this.gradients[g].children[3].setAttribute("offset","100%"),this.gradients[g].children[4].setAttribute("offset","100%"))}}}newGradient(e,t){const n=document.createElementNS(kt,"radialGradient");n.setAttribute("id",`grad-${this.svgID}-${e}`),n.setAttribute("r","70.7107%");const r=[{offset:0,color:t},{offset:0,color:t},{offset:0,color:"black"},{offset:0,color:"black"},{offset:0,color:t},{offset:100,color:t}];for(const i of r){const s=document.createElementNS(kt,"stop");s.setAttribute("offset",`${i.offset}%`),s.setAttribute("stop-color",i.color),s.setAttribute("stop-opacity","1"),n.appendChild(s)}return n}elementID(e,t,n){return e+"-l"+t+"-o"+n}elementByID(e){return this.element.querySelector("#"+e)}},ot,lt,Di=class extends G{constructor(e,t,n,r,i){var s;super(),this.model=e,this.kpuzzle=t,this.svgSource=n,this.options=r,this.puzzleLoader=i,this.scheduler=new zt(this.render.bind(this)),c(this,ot,null),c(this,lt,new Mt),this.addCSS(Ts),this.resetSVG(),a(this,lt).addListener(this.model.puzzleID,o=>{(i==null?void 0:i.id)!==o&&this.disconnect()}),a(this,lt).addListener(this.model.legacyPosition,this.onPositionChange.bind(this)),(s=this.options)!=null&&s.experimentalStickering&&this.experimentalSetStickering(this.options.experimentalStickering)}disconnect(){a(this,lt).disconnect()}onPositionChange(e){var t;try{if(e.movesInProgress.length>0){const n=e.movesInProgress[0].move;let r=n;e.movesInProgress[0].direction===-1&&(r=n.invert());const i=e.state.applyMove(r);this.svg.draw(e.state,i,e.movesInProgress[0].fraction)}else this.svg.draw(e.state),m(this,ot,e)}catch(n){console.warn("Bad position (this doesn't necessarily mean something is wrong). Pre-emptively disconnecting:",(t=this.puzzleLoader)==null?void 0:t.id,n),this.disconnect()}}scheduleRender(){this.scheduler.requestAnimFrame()}experimentalSetStickering(e){(async()=>{var n;if(!((n=this.puzzleLoader)!=null&&n.appearance))return;const t=await this.puzzleLoader.appearance(e);this.resetSVG(t)})()}resetSVG(e){this.svg&&this.removeElement(this.svg.element),this.kpuzzle&&(this.svg=new bs(this.kpuzzle,this.svgSource,e),this.addElement(this.svg.element),a(this,ot)&&this.onPositionChange(a(this,ot)))}render(){}};ot=new WeakMap;lt=new WeakMap;N.define("twisty-2d-puzzle",Di);var Ut,Wt,ks=class{constructor(e,t,n,r){this.model=e,this.schedulable=t,this.puzzleLoader=n,this.effectiveVisualization=r,c(this,Ut,new Mt),c(this,Wt,null),this.twisty2DPuzzle(),a(this,Ut).addListener(this.model.twistySceneModel.stickering,async i=>{(await this.twisty2DPuzzle()).experimentalSetStickering(i)})}disconnect(){a(this,Ut).disconnect()}scheduleRender(){}async twisty2DPuzzle(){return a(this,Wt)??m(this,Wt,(async()=>{const e=this.effectiveVisualization==="experimental-2D-LL"?this.puzzleLoader.llSVG():this.puzzleLoader.svg();return new Di(this.model,await this.puzzleLoader.kpuzzle(),await e,{},this.puzzleLoader)})())}};Ut=new WeakMap;Wt=new WeakMap;var jt,Ft,ye,Ai=class extends G{constructor(e,t){super(),this.model=e,this.effectiveVisualization=t,c(this,jt,new Mt),c(this,Ft,void 0),c(this,ye,null)}disconnect(){a(this,jt).disconnect()}async connectedCallback(){this.addCSS(Ei),this.model&&a(this,jt).addListener(this.model.twistyPlayerModel.puzzleLoader,this.onPuzzleLoader.bind(this))}async scene(){return a(this,Ft)??m(this,Ft,(async()=>new(await q).Scene)())}scheduleRender(){var e;(e=a(this,ye))==null||e.scheduleRender()}currentTwisty2DPuzzleWrapper(){return a(this,ye)}async setCurrentTwisty2DPuzzleWrapper(e){const t=a(this,ye);m(this,ye,e),t==null||t.disconnect();const n=e.twisty2DPuzzle();this.contentWrapper.textContent="",this.addElement(await n)}async onPuzzleLoader(e){var n;(n=a(this,ye))==null||n.disconnect();const t=new ks(this.model.twistyPlayerModel,this,e,this.effectiveVisualization);this.setCurrentTwisty2DPuzzleWrapper(t)}};jt=new WeakMap;Ft=new WeakMap;ye=new WeakMap;N.define("twisty-2d-scene-wrapper",Ai);var xe,wn=class{constructor(e,t,n){this.elem=e,this.prefix=t,this.validSuffixes=n,c(this,xe,null)}clearValue(){a(this,xe)&&this.elem.contentWrapper.classList.remove(a(this,xe)),m(this,xe,null)}setValue(e){if(!this.validSuffixes.includes(e))throw new Error(`Invalid suffix: ${e}`);const t=`${this.prefix}${e}`,n=a(this,xe)!==t;return n&&(this.clearValue(),this.elem.contentWrapper.classList.add(t),m(this,xe,t)),n}};xe=new WeakMap;var ee,Vt,Ci=class{constructor(e,t,n,r){this.model=e,this.schedulable=t,this.puzzleLoader=n,this.visualizationStrategy=r,c(this,ee,new Mt),c(this,Vt,null),this.twisty3DPuzzle(),a(this,ee).addListener(this.model.puzzleLoader,i=>{this.puzzleLoader.id!==i.id&&this.disconnect()}),a(this,ee).addListener(this.model.legacyPosition,async i=>{try{(await this.twisty3DPuzzle()).onPositionChange(i),this.scheduleRender()}catch{this.disconnect()}}),a(this,ee).addListener(this.model.twistySceneModel.hintFacelet,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({hintFacelets:i==="auto"?"floating":i}),this.scheduleRender()}),a(this,ee).addListener(this.model.twistySceneModel.foundationDisplay,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({showFoundation:i!=="none"}),this.scheduleRender()}),a(this,ee).addListener(this.model.twistySceneModel.stickering,async i=>{if("setStickering"in await this.twisty3DPuzzle())(await this.twisty3DPuzzle()).setStickering(i),this.scheduleRender();else{if(["experimental-global-custom-1","experimental-global-custom-2"].includes(i)){const[s]=await Promise.all([this.twisty3DPuzzle()]);s.experimentalSetAppearance(await Ye(this.puzzleLoader,i)),this.scheduleRender();return}if("appearance"in this.puzzleLoader){const[s,o]=await Promise.all([this.twisty3DPuzzle(),this.puzzleLoader.appearance(i??"full")]);s.experimentalSetAppearance(o),this.scheduleRender()}}}),a(this,ee).addMultiListener([this.model.twistySceneModel.foundationStickerSprite,this.model.twistySceneModel.hintStickerSprite],async i=>{"experimentalUpdateTexture"in await this.twisty3DPuzzle()&&((await this.twisty3DPuzzle()).experimentalUpdateTexture(!0,...i),this.scheduleRender())})}disconnect(){a(this,ee).disconnect()}scheduleRender(){this.schedulable.scheduleRender()}async twisty3DPuzzle(){return a(this,Vt)??m(this,Vt,(async()=>{const e=Ti();if(this.puzzleLoader.id==="3x3x3"&&this.visualizationStrategy==="Cube3D"){const[t,n,r]=await Promise.all([this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get(),this.model.twistySceneModel.stickering.get()]);return(await e).cube3DShim({foundationSprite:t,hintSprite:n,experimentalStickering:r})}else{const[t,n,r]=await Promise.all([this.model.twistySceneModel.hintFacelet.get(),this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get()]),i=(await e).pg3dShim(this.puzzleLoader,t==="auto"?"floating":t);return i.then(s=>s.experimentalUpdateTexture(!0,n??void 0,r??void 0)),i}})())}async raycastMove(e,t){const n=await this.twisty3DPuzzle();if(!("experimentalGetControlTargets"in n)){console.info("not PG3D! skipping raycast");return}const r=n.experimentalGetControlTargets(),[i]=await Promise.all([e]),s=i.intersectObjects(r);if(s.length>0){const o=n.getClosestMoveToAxis(s[0].point,t);o?this.model.experimentalAddMove(o.move,{coalesce:!0,mod:o.order}):console.info("Skipping move!")}}};ee=new WeakMap;Vt=new WeakMap;function Un(){return devicePixelRatio||1}var Es=new Z(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  place-content: center;
  contain: strict;
}

.loading {
  width: 4em;
  height: 4em;
  border-radius: 2.5em;
  border: 0.5em solid rgba(0, 0, 0, 0);
  border-top: 0.5em solid rgba(0, 0, 0, 0.7);
  border-right: 0.5em solid rgba(0, 0, 0, 0.7);
  animation: fade-in-delayed 4s, rotate 1s linear infinite;
}

@keyframes fade-in-delayed {
  0% { opacity: 0; }
  25% {opacity: 0; }
  100% { opacity: 1; }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* TODO: This is due to stats hack. Replace with \`canvas\`. */
.wrapper > canvas {
  max-width: 100%;
  max-height: 100%;
  cursor: grab;
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.wrapper > canvas:active {
  cursor: grabbing;
}

.wrapper.invisible {
  opacity: 0;
}
`),Er=.1,Ge,on,Wn,Pi,jn,Ni,Bt,Fn,Ds=class extends EventTarget{constructor(e){super(),this.target=e,c(this,Wn),c(this,jn),c(this,Bt),c(this,Ge,new Map),c(this,on,!1),e.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.target.addEventListener("contextmenu",t=>{t.preventDefault()}),this.target.addEventListener("touchmove",t=>t.preventDefault()),this.target.addEventListener("dblclick",t=>t.preventDefault())}onPointerDown(e){M(this,Wn,Pi).call(this);const t={attachedInfo:{},hasMoved:!1,lastClientX:e.clientX,lastClientY:e.clientY,lastTimeStamp:e.timeStamp};a(this,Ge).set(e.pointerId,t),this.target.setPointerCapture(e.pointerId)}onPointerMove(e){const t=M(this,Bt,Fn).call(this,e).movementInfo;t&&(e.preventDefault(),this.dispatchEvent(new CustomEvent("move",{detail:t})))}onPointerUp(e){const t=M(this,Bt,Fn).call(this,e),n=a(this,Ge).get(e.pointerId);M(this,jn,Ni).call(this,e),this.target.releasePointerCapture(e.pointerId);let r;if(t.hasMoved)r=new CustomEvent("up",{detail:{attachedInfo:n.attachedInfo}});else{const{altKey:i,ctrlKey:s,metaKey:o,shiftKey:u}=e;r=new CustomEvent("press",{detail:{normalizedX:e.offsetX/this.target.offsetWidth*2-1,normalizedY:1-e.offsetY/this.target.offsetHeight*2,rightClick:!!(e.button&2),keys:{altKey:i,ctrlOrMetaKey:s||o,shiftKey:u}}})}this.dispatchEvent(r)}};Ge=new WeakMap;on=new WeakMap;Wn=new WeakSet;Pi=function(){a(this,on)||(this.target.addEventListener("pointermove",this.onPointerMove.bind(this)),this.target.addEventListener("pointerup",this.onPointerUp.bind(this)),m(this,on,!0))};jn=new WeakSet;Ni=function(e){a(this,Ge).delete(e.pointerId)};Bt=new WeakSet;Fn=function(e){const t=a(this,Ge).get(e.pointerId);if(!t)return{movementInfo:null,hasMoved:!1};let n;return(e.movementX??0)!==0||(e.movementY??0)!==0?n={attachedInfo:t.attachedInfo,movementX:e.movementX,movementY:e.movementY,elapsedMs:e.timeStamp-t.lastTimeStamp}:n={attachedInfo:t.attachedInfo,movementX:e.clientX-t.lastClientX,movementY:e.clientY-t.lastClientY,elapsedMs:e.timeStamp-t.lastTimeStamp},t.lastClientX=e.clientX,t.lastClientY=e.clientY,t.lastTimeStamp=e.timeStamp,Math.abs(n.movementX)<Er&&Math.abs(n.movementY)<Er?{movementInfo:null,hasMoved:t.hasMoved}:(t.hasMoved=!0,{movementInfo:n,hasMoved:t.hasMoved})};var vn=[];async function As(e,t,n,r,i){if(e===0||t===0)return;vn.length===0&&vn.push(Ri());const s=await vn[0];s.setSize(e,t),s.render(r,i);const o=n.getContext("2d");o.clearRect(0,0,n.width,n.height),o.drawImage(s.domElement,0,0)}async function Ri(){const e=(await q).WebGLRenderer,t=new e({antialias:!0,alpha:!0});return t.setPixelRatio(Un()),t}var Cs=!0,yn=500,Ps=50,Ns=.75;function Dr(e){return(Math.exp(1-e)-(1-e))/(1-Math.E)+1}var Rs=class{constructor(e,t,n,r){this.startTimestamp=e,this.momentumX=t,this.momentumY=n,this.callback=r,this.scheduler=new zt(this.render.bind(this)),this.scheduler.requestAnimFrame(),this.lastTimestamp=e}render(e){const t=(this.lastTimestamp-this.startTimestamp)/yn,n=Math.min(1,(e-this.startTimestamp)/yn);if(t===0&&n>Ps/yn)return;const r=Dr(n)-Dr(t);this.callback(this.momentumX*r*1e3,this.momentumY*r*1e3),n<1&&this.scheduler.requestAnimFrame(),this.lastTimestamp=e}},_s=class{constructor(e,t,n,r){this.model=e,this.mirror=t,this.canvas=n,this.dragTracker=r,this.experimentalInertia=Cs,this.onMovementBound=this.onMovement.bind(this),this.experimentalHasBeenMoved=!1,this.dragTracker.addEventListener("move",this.onMove.bind(this)),this.dragTracker.addEventListener("up",this.onUp.bind(this))}temperMovement(e){return Math.sign(e)*Math.log(Math.abs(e*10)+1)/6}onMove(e){var t;(t=e.detail).attachedInfo??(t.attachedInfo={});const{temperedX:n,temperedY:r}=this.onMovement(e.detail.movementX,e.detail.movementY),i=e.detail.attachedInfo;i.lastTemperedX=n*10,i.lastTemperedY=r*10,i.timestamp=e.timeStamp}onMovement(e,t){const n=this.mirror?-1:1,r=Math.min(this.canvas.offsetWidth,this.canvas.offsetHeight),i=this.temperMovement(e/r),s=this.temperMovement(t/r*Ns);return this.model.twistySceneModel.orbitCoordinatesRequest.set((async()=>{const o=await this.model.twistySceneModel.orbitCoordinates.get();return{latitude:o.latitude+2*s*vt*n,longitude:o.longitude-2*i*vt}})()),{temperedX:i,temperedY:s}}onUp(e){e.preventDefault(),"lastTemperedX"in e.detail.attachedInfo&&"lastTemperedY"in e.detail.attachedInfo&&"timestamp"in e.detail.attachedInfo&&e.timeStamp-e.detail.attachedInfo.timestamp<60&&new Rs(e.timeStamp,e.detail.attachedInfo.lastTemperedX,e.detail.attachedInfo.lastTemperedY,this.onMovementBound)}};async function _i(e,t,n=!1){const r=new(await q).Spherical(t.distance,(90-(n?-1:1)*t.latitude)/vt,((n?180:0)+t.longitude)/vt);r.makeSafe(),e.position.setFromSpherical(r),e.lookAt(0,0,0)}var Ar=0,Os=2;function Us(){return Ar<Os?(Ar++,!1):!0}var Vn,Oi,ur,ln,un,qt,Bn,Gt,Qt,cn,dn,cr,Yt,Ht,ut,qn,Gn=class extends G{constructor(e,t,n){super(),this.model=e,this.options=n,c(this,Vn),c(this,qt),c(this,dn),this.scene=null,this.stats=null,this.rendererIsShared=Us(),this.loadingElement=null,c(this,ur,new gn),c(this,ln,0),c(this,un,0),c(this,Gt,null),c(this,Qt,null),c(this,cn,null),c(this,Yt,null),c(this,Ht,null),c(this,ut,[]),c(this,qn,new zt(this.render.bind(this))),this.scene=t??null,this.loadingElement=this.addElement(document.createElement("div")),this.loadingElement.classList.add("loading")}async connectedCallback(){this.addCSS(Es),this.addElement((await this.canvasInfo()).canvas),M(this,qt,Bn).call(this),new ResizeObserver(M(this,qt,Bn).bind(this)).observe(this.contentWrapper),this.orbitControls(),M(this,Vn,Oi).call(this),this.scheduleRender()}async clearCanvas(){if(this.rendererIsShared){const e=await this.canvasInfo();e.context.clearRect(0,0,e.canvas.width,e.canvas.height)}else{const t=(await this.renderer()).getContext();t.clear(t.COLOR_BUFFER_BIT)}}async renderer(){if(this.rendererIsShared)throw new Error("renderer expected to be shared.");return a(this,Gt)??m(this,Gt,Ri())}async canvasInfo(){return a(this,Qt)??m(this,Qt,(async()=>{var n;let e;if(this.rendererIsShared)e=this.addElement(document.createElement("canvas"));else{const r=await this.renderer();e=this.addElement(r.domElement)}(n=this.loadingElement)==null||n.remove();const t=e.getContext("2d");return{canvas:e,context:t}})())}async camera(){return a(this,Yt)??m(this,Yt,(async()=>{var t;const e=new(await q).PerspectiveCamera(20,1,.1,20);return e.position.copy(new(await q).Vector3(2,4,4).multiplyScalar((t=this.options)!=null&&t.backView?-1:1)),e.lookAt(0,0,0),e})())}async orbitControls(){return a(this,Ht)??m(this,Ht,(async()=>{var t;const e=new _s(this.model,!!((t=this.options)!=null&&t.backView),(await this.canvasInfo()).canvas,await M(this,dn,cr).call(this));return this.model&&this.addListener(this.model.twistySceneModel.orbitCoordinates,async n=>{var i;const r=await this.camera();_i(r,n,(i=this.options)==null?void 0:i.backView),this.scheduleRender()}),e})())}addListener(e,t){e.addFreshListener(t),a(this,ut).push(()=>{e.removeFreshListener(t)})}disconnect(){for(const e of a(this,ut))e();m(this,ut,[])}async render(){var r,i;if(!this.scene)throw new Error("Attempted to render without a scene");(r=this.stats)==null||r.begin();const[e,t,n]=await Promise.all([this.scene.scene(),this.camera(),this.canvasInfo()]);this.rendererIsShared?As(a(this,ln),a(this,un),n.canvas,e,t):(await this.renderer()).render(e,t),(i=this.stats)==null||i.end()}scheduleRender(){a(this,qn).requestAnimFrame()}};Vn=new WeakSet;Oi=async function(){(await M(this,dn,cr).call(this)).addEventListener("press",async t=>{await this.model.twistySceneModel.movePressInput.get()==="basic"&&this.dispatchEvent(new CustomEvent("press",{detail:{pressInfo:t.detail,cameraPromise:this.camera()}}))})};ur=new WeakMap;ln=new WeakMap;un=new WeakMap;qt=new WeakSet;Bn=async function(){const e=await a(this,ur).queue(this.camera()),t=this.contentWrapper.clientWidth,n=this.contentWrapper.clientHeight;m(this,ln,t),m(this,un,n);const r=0;let i=0,s=0;if(n>t&&(s=n-t,i=-Math.floor(.5*s)),e.aspect=t/n,e.setViewOffset(t,n-s,r,i,t,n),e.updateProjectionMatrix(),this.clearCanvas(),this.rendererIsShared){const o=await this.canvasInfo();o.canvas.width=t*Un(),o.canvas.height=n*Un(),o.canvas.style.width=t.toString(),o.canvas.style.height=n.toString()}else(await this.renderer()).setSize(t,n,!0);this.scheduleRender()};Gt=new WeakMap;Qt=new WeakMap;cn=new WeakMap;dn=new WeakSet;cr=async function(){return a(this,cn)??m(this,cn,(async()=>new Ds((await this.canvasInfo()).canvas))())};Yt=new WeakMap;Ht=new WeakMap;ut=new WeakMap;qn=new WeakMap;N.define("twisty-3d-vantage",Gn);var Qn,ct,se,$t,_e,Me,Yn,dr=class extends G{constructor(e){super(),this.model=e,c(this,Qn,new wn(this,"back-view-",["auto","none","side-by-side","top-right"])),c(this,ct,new Mt),c(this,se,null),c(this,$t,void 0),c(this,_e,new Set),c(this,Me,null),c(this,Yn,new gn)}disconnect(){a(this,ct).disconnect()}async connectedCallback(){this.addCSS(Ei);const e=new Gn(this.model,this);this.addVantage(e),this.model&&(a(this,ct).addMultiListener([this.model.puzzleLoader,this.model.visualizationStrategy],this.onPuzzle.bind(this)),a(this,ct).addListener(this.model.backView,this.onBackView.bind(this))),this.scheduleRender()}setBackView(e){const t=["side-by-side","top-right"].includes(e),n=a(this,se)!==null;a(this,Qn).setValue(e),t?n||(m(this,se,new Gn(this.model,this,{backView:!0})),this.addVantage(a(this,se)),this.scheduleRender()):a(this,se)&&(this.removeVantage(a(this,se)),m(this,se,null))}onBackView(e){this.setBackView(e)}async onPress(e){const t=a(this,Me);if(!t){console.info("no wrapper; skipping scene wrapper press!");return}const n=(async()=>{const[r,i]=await Promise.all([e.detail.cameraPromise,q]),s=new i.Raycaster,o=new(await q).Vector2(e.detail.pressInfo.normalizedX,e.detail.pressInfo.normalizedY);return s.setFromCamera(o,r),s})();t.raycastMove(n,{invert:!e.detail.pressInfo.rightClick,depth:e.detail.pressInfo.keys.ctrlOrMetaKey?"rotation":e.detail.pressInfo.keys.shiftKey?"secondSlice":"none"})}async scene(){return a(this,$t)??m(this,$t,(async()=>new(await q).Scene)())}addVantage(e){e.addEventListener("press",this.onPress.bind(this)),a(this,_e).add(e),this.contentWrapper.appendChild(e)}removeVantage(e){var t;a(this,_e).delete(e),e.remove(),e.disconnect(),(t=a(this,Me))==null||t.disconnect()}experimentalVantages(){return a(this,_e).values()}scheduleRender(){for(const e of a(this,_e))e.scheduleRender()}async setCurrentTwisty3DPuzzleWrapper(e,t){const n=a(this,Me);try{m(this,Me,t),n==null||n.disconnect(),e.add(await t.twisty3DPuzzle())}finally{n&&e.remove(await n.twisty3DPuzzle())}}async onPuzzle(e){var r;if(e[1]==="2D")return;(r=a(this,Me))==null||r.disconnect();const[t,n]=await a(this,Yn).queue(Promise.all([this.scene(),new Ci(this.model,this,e[0],e[1])]));this.setCurrentTwisty3DPuzzleWrapper(t,n)}};Qn=new WeakMap;ct=new WeakMap;se=new WeakMap;$t=new WeakMap;_e=new WeakMap;Me=new WeakMap;Yn=new WeakMap;N.define("twisty-3d-scene-wrapper",dr);var Ws=new Z(`
:host {
  width: 384px;
  height: 24px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.wrapper {
  grid-auto-flow: column;
}

.viewer-link-none .twizzle-link-button {
  display: none;
}

.wrapper twisty-button,
.wrapper twisty-control-button {
  width: inherit;
  height: inherit;
}
`),js=new Z(`
:host:not([hidden]) {
  display: grid;
}

:host {
  width: 48px;
  height: 24px;
}

.wrapper {
  width: 100%;
  height: 100%;
}

button {
  width: 100%;
  height: 100%;
  border: none;
  
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;

  background-color: rgba(196, 196, 196, 0.75);
}

button:enabled {
  background-color: rgba(196, 196, 196, 0.75)
}

button:disabled {
  background-color: rgba(0, 0, 0, 0.4);
  opacity: 0.25;
  pointer-events: none;
}

button:enabled:hover {
  background-color: rgba(255, 255, 255, 0.75);
  box-shadow: 0 0 1em rgba(0, 0, 0, 0.25);
  cursor: pointer;
}

/* TODO: fullscreen icons have too much padding?? */
.svg-skip-to-start button,
button.svg-skip-to-start {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjQzIDEwMzdxMTktMTkgMzItMTN0MTMgMzJ2MTQ3MnEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djcxMHEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djY3OHEwIDI2LTE5IDQ1dC00NSAxOUg5NjBxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWgxMjhxMjYgMCA0NSAxOXQxOSA0NXY2NzhxNC0xMSAxMy0xOWw3MTAtNzEwcTE5LTE5IDMyLTEzdDEzIDMydjcxMHE0LTExIDEzLTE5eiIvPjwvc3ZnPg==");
}

.svg-skip-to-end button,
button.svg-skip-to-end {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik05NDEgMjU0N3EtMTkgMTktMzIgMTN0LTEzLTMyVjEwNTZxMC0yNiAxMy0zMnQzMiAxM2w3MTAgNzEwcTggOCAxMyAxOXYtNzEwcTAtMjYgMTMtMzJ0MzIgMTNsNzEwIDcxMHE4IDggMTMgMTl2LTY3OHEwLTI2IDE5LTQ1dDQ1LTE5aDEyOHEyNiAwIDQ1IDE5dDE5IDQ1djE0MDhxMCAyNi0xOSA0NXQtNDUgMTloLTEyOHEtMjYgMC00NS0xOXQtMTktNDV2LTY3OHEtNSAxMC0xMyAxOWwtNzEwIDcxMHEtMTkgMTktMzIgMTN0LTEzLTMydi03MTBxLTUgMTAtMTMgMTl6Ii8+PC9zdmc+");
}

.svg-step-forward button,
button.svg-step-forward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDE1NjhxMCAyNi0xOSA0NWwtNTEyIDUxMnEtMTkgMTktNDUgMTl0LTQ1LTE5cS0xOS0xOS0xOS00NXYtMjU2aC0yMjRxLTk4IDAtMTc1LjUgNnQtMTU0IDIxLjVxLTc2LjUgMTUuNS0xMzMgNDIuNXQtMTA1LjUgNjkuNXEtNDkgNDIuNS04MCAxMDF0LTQ4LjUgMTM4LjVxLTE3LjUgODAtMTcuNSAxODEgMCA1NSA1IDEyMyAwIDYgMi41IDIzLjV0Mi41IDI2LjVxMCAxNS04LjUgMjV0LTIzLjUgMTBxLTE2IDAtMjgtMTctNy05LTEzLTIydC0xMy41LTMwcS03LjUtMTctMTAuNS0yNC0xMjctMjg1LTEyNy00NTEgMC0xOTkgNTMtMzMzIDE2Mi00MDMgODc1LTQwM2gyMjR2LTI1NnEwLTI2IDE5LTQ1dDQ1LTE5cTI2IDAgNDUgMTlsNTEyIDUxMnExOSAxOSAxOSA0NXoiLz48L3N2Zz4=");
}

.svg-step-backward button,
button.svg-step-backward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDIwNDhxMCAxNjYtMTI3IDQ1MS0zIDctMTAuNSAyNHQtMTMuNSAzMHEtNiAxMy0xMyAyMi0xMiAxNy0yOCAxNy0xNSAwLTIzLjUtMTB0LTguNS0yNXEwLTkgMi41LTI2LjV0Mi41LTIzLjVxNS02OCA1LTEyMyAwLTEwMS0xNy41LTE4MXQtNDguNS0xMzguNXEtMzEtNTguNS04MC0xMDF0LTEwNS41LTY5LjVxLTU2LjUtMjctMTMzLTQyLjV0LTE1NC0yMS41cS03Ny41LTYtMTc1LjUtNmgtMjI0djI1NnEwIDI2LTE5IDQ1dC00NSAxOXEtMjYgMC00NS0xOWwtNTEyLTUxMnEtMTktMTktMTktNDV0MTktNDVsNTEyLTUxMnExOS0xOSA0NS0xOXQ0NSAxOXExOSAxOSAxOSA0NXYyNTZoMjI0cTcxMyAwIDg3NSA0MDMgNTMgMTM0IDUzIDMzM3oiLz48L3N2Zz4=");
}

.svg-pause button,
button.svg-pause {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNTYwIDEwODh2MTQwOHEwIDI2LTE5IDQ1dC00NSAxOWgtNTEycS0yNiAwLTQ1LTE5dC0xOS00NVYxMDg4cTAtMjYgMTktNDV0NDUtMTloNTEycTI2IDAgNDUgMTl0MTkgNDV6bS04OTYgMHYxNDA4cTAgMjYtMTkgNDV0LTQ1IDE5aC01MTJxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWg1MTJxMjYgMCA0NSAxOXQxOSA0NXoiLz48L3N2Zz4=");
}

.svg-play button,
button.svg-play {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNDcyLjUgMTgyM2wtMTMyOCA3MzhxLTIzIDEzLTM5LjUgM3QtMTYuNS0zNlYxMDU2cTAtMjYgMTYuNS0zNnQzOS41IDNsMTMyOCA3MzhxMjMgMTMgMjMgMzF0LTIzIDMxeiIvPjwvc3ZnPg==");
}

.svg-enter-fullscreen button,
button.svg-enter-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTkgMTZIN3Y1aDV2LTJIOXYtM3ptLTItNGgyVjloM1Y3SDd2NXptMTIgN2gtM3YyaDV2LTVoLTJ2M3pNMTYgN3YyaDN2M2gyVjdoLTV6Ii8+PC9zdmc+");
}

.svg-exit-fullscreen button,
button.svg-exit-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTcgMThoM3YzaDJ2LTVIN3Yyem0zLThIN3YyaDVWN2gtMnYzem02IDExaDJ2LTNoM3YtMmgtNXY1em0yLTExVjdoLTJ2NWg1di0yaC0zeiIvPjwvc3ZnPg==");
}

.svg-twizzle-tw button,
button.svg-twizzle-tw {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODY0IiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzk3LjU4MSAxNTEuMTh2NTcuMDg0aC04OS43MDN2MjQwLjM1MmgtNjYuOTU1VjIwOC4yNjRIMTUxLjIydi01Ny4wODNoMjQ2LjM2MXptNTQuMzEgNzEuNjc3bDcuNTEyIDMzLjY5MmMyLjcxOCAxMi4xNiA1LjU4IDI0LjY4IDguNTg0IDM3LjU1NWEyMTgwLjc3NSAyMTgwLjc3NSAwIDAwOS40NDIgMzguODQzIDEyNjYuMyAxMjY2LjMgMCAwMDEwLjA4NiAzNy41NTVjMy43Mi0xMi41OSA3LjM2OC0yNS40NjYgMTAuOTQ1LTM4LjYyOCAzLjU3Ni0xMy4xNjIgNy4wMS0yNi4xMSAxMC4zLTM4Ljg0M2w1Ljc2OS0yMi40NTZjMS4yNDgtNC44ODcgMi40NzItOS43MDUgMy42NzQtMTQuNDU1IDMuMDA0LTExLjg3NSA1LjY1MS0yMi45NjIgNy45NC0zMy4yNjNoNDYuMzU0bDIuMzg0IDEwLjU2M2EyMDAwLjc3IDIwMDAuNzcgMCAwMDMuOTM1IDE2LjgyOGw2LjcxMSAyNy43MWMxLjIxMyA0Ljk1NiAyLjQ1IDkuOTggMy43MDkgMTUuMDczYTMxMTkuNzc3IDMxMTkuNzc3IDAgMDA5Ljg3MSAzOC44NDMgMTI0OS4yMjcgMTI0OS4yMjcgMCAwMDEwLjczIDM4LjYyOCAxOTA3LjYwNSAxOTA3LjYwNSAwIDAwMTAuMzAxLTM3LjU1NSAxMzk3Ljk0IDEzOTcuOTQgMCAwMDkuNjU3LTM4Ljg0M2w0LjQtMTkuMDQ2Yy43MTUtMy4xMyAxLjQyMS02LjIzNiAyLjExOC05LjMyMWw5LjU3Ny00Mi44OGg2Ni41MjZhMjk4OC43MTggMjk4OC43MTggMCAwMS0xOS41MjkgNjYuMzExbC01LjcyOCAxOC40ODJhMzIzNy40NiAzMjM3LjQ2IDAgMDEtMTQuMDE1IDQzLjc1MmMtNi40MzggMTkuNi0xMi43MzMgMzcuNjk4LTE4Ljg4NSA1NC4yOTRsLTMuMzA2IDguODI1Yy00Ljg4NCAxMi44OTgtOS40MzMgMjQuMjYzLTEzLjY0NyAzNC4wOTVoLTQ5Ljc4N2E4NDE3LjI4OSA4NDE3LjI4OSAwIDAxLTIxLjAzMS02NC44MDkgMTI4OC42ODYgMTI4OC42ODYgMCAwMS0xOC44ODUtNjQuODEgMTk3Mi40NDQgMTk3Mi40NDQgMCAwMS0xOC4yNCA2NC44MSAyNTc5LjQxMiAyNTc5LjQxMiAwIDAxLTIwLjM4OCA2NC44MWgtNDkuNzg3Yy00LjY4Mi0xMC45MjYtOS43Mi0yMy43NDMtMTUuMTEtMzguNDUxbC0xLjYyOS00LjQ3Yy01LjI1OC0xNC41MjEtMTAuNjgtMzAuMTkyLTE2LjI2Ni00Ny4wMTRsLTIuNDA0LTcuMjhjLTYuNDM4LTE5LjYtMTMuMDItNDAuMzQ0LTE5Ljc0My02Mi4yMzRhMjk4OC43MDcgMjk4OC43MDcgMCAwMS0xOS41MjktNjYuMzExaDY3LjM4NXoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvc3ZnPg==");
}
`),S=typeof document>"u"?null:document,Fs=(S==null?void 0:S.fullscreenEnabled)||!!(S!=null&&S.webkitFullscreenEnabled);function Vs(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen()}function Cr(){return document.fullscreenElement?document.fullscreenElement:document.webkitFullscreenElement??null}function Bs(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()}var qs=["skip-to-start","skip-to-end","step-forward","step-backward","pause","play","enter-fullscreen","exit-fullscreen","twizzle-tw"],Gs=class extends x{derive(e){return{fullscreen:{enabled:Fs,icon:document.fullscreenElement===null?"enter-fullscreen":"exit-fullscreen",title:"Enter fullscreen"},"jump-to-start":{enabled:!e.coarseTimelineInfo.atStart,icon:"skip-to-start",title:"Restart"},"play-step-backwards":{enabled:!e.coarseTimelineInfo.atStart,icon:"step-backward",title:"Step backward"},"play-pause":{enabled:!(e.coarseTimelineInfo.atStart&&e.coarseTimelineInfo.atEnd),icon:e.coarseTimelineInfo.playing?"pause":"play",title:e.coarseTimelineInfo.playing?"Pause":"Play"},"play-step":{enabled:!e.coarseTimelineInfo.atEnd,icon:"step-forward",title:"Step forward"},"jump-to-end":{enabled:!e.coarseTimelineInfo.atEnd,icon:"skip-to-end",title:"Skip to End"},"twizzle-link":{enabled:!0,icon:"twizzle-tw",title:"View at Twizzle",hidden:e.viewerLink==="none"}}}},Pr={fullscreen:!0,"jump-to-start":!0,"play-step-backwards":!0,"play-pause":!0,"play-step":!0,"jump-to-end":!0,"twizzle-link":!0},Hn,Ui,Wi=class extends G{constructor(e,t,n){super(),this.model=e,this.controller=t,this.fullscreenElement=n,c(this,Hn),this.buttons=null}connectedCallback(){var t;this.addCSS(Ws);const e={};for(const n in Pr){const r=new ji;e[n]=r,r.addEventListener("click",()=>M(this,Hn,Ui).call(this,n)),this.addElement(r)}this.buttons=e,(t=this.model)==null||t.buttonAppearance.addFreshListener(this.update.bind(this))}async onFullscreenButton(){var e;if(!this.fullscreenElement)throw new Error("Attempted to go fullscreen without an element.");if(Cr()===this.fullscreenElement)Vs();else{(e=this.buttons)==null||e.fullscreen.setIcon("exit-fullscreen"),Bs(this.fullscreenElement);const t=()=>{var n;Cr()!==this.fullscreenElement&&((n=this.buttons)==null||n.fullscreen.setIcon("enter-fullscreen"),window.removeEventListener("fullscreenchange",t))};window.addEventListener("fullscreenchange",t)}}async update(e){for(const t in Pr){const n=this.buttons[t],r=e[t];n.button.disabled=!r.enabled,n.button.title=r.title,n.setIcon(r.icon),n.hidden=!!r.hidden}}};Hn=new WeakSet;Ui=function(e){var t,n,r,i,s,o;switch(e){case"fullscreen":this.onFullscreenButton();break;case"jump-to-start":(t=this.controller)==null||t.jumpToStart({flash:!0});break;case"play-step-backwards":(n=this.controller)==null||n.animationController.play({direction:-1,untilBoundary:"move"});break;case"play-pause":(r=this.controller)==null||r.togglePlay();break;case"play-step":(i=this.controller)==null||i.animationController.play({direction:1,untilBoundary:"move"});break;case"jump-to-end":(s=this.controller)==null||s.jumpToEnd({flash:!0});break;case"twizzle-link":(o=this.controller)==null||o.visitTwizzleLink();break;default:throw new Error("Missing command")}};N.define("twisty-buttons",Wi);var $n,ji=class extends G{constructor(){super(...arguments),this.button=document.createElement("button"),c(this,$n,new wn(this,"svg-",qs))}connectedCallback(){this.addCSS(js),this.addElement(this.button)}setIcon(e){a(this,$n).setValue(e)}};$n=new WeakMap;N.define("twisty-button",ji);var Qs=new Z(`
:host {
  width: 384px;
  height: 16px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  background: rgba(196, 196, 196, 0.75)
}

input:not(:disabled) {
  cursor: ew-resize;
}
`);S==null||S.addEventListener("mousedown",function(e){e.which},!0);S==null||S.addEventListener("mouseup",function(e){e.which},!0);S==null||S.addEventListener("mousedown",()=>{},!1);S==null||S.addEventListener("mousemove",Fi,!1);S==null||S.addEventListener("mouseenter",Fi,!1);function Fi(e){e.pageY}var Xt,Vi=class extends G{constructor(e){super(),this.model=e,c(this,Xt,null)}async onDetailedTimelineInfo(e){const t=await this.inputElem();t.min=e.timeRange.start.toString(),t.max=e.timeRange.end.toString(),t.disabled=t.min===t.max,t.value=e.timestamp.toString()}async connectedCallback(){this.addCSS(Qs),this.addElement(await this.inputElem())}async inputElem(){return a(this,Xt)??m(this,Xt,(async()=>{var t;const e=document.createElement("input");return e.type="range",e.disabled=!0,(t=this.model)==null||t.detailedTimelineInfo.addFreshListener(this.onDetailedTimelineInfo.bind(this)),e.addEventListener("input",this.onInput.bind(this)),e})())}async onInput(e){var r,i;const t=await this.inputElem();await this.slowDown(e,t);const n=parseInt(t.value);(r=this.model)==null||r.playingInfo.set({playing:!1}),(i=this.model)==null||i.timestampRequest.set(n)}async slowDown(e,t){}};Xt=new WeakMap;N.define("twisty-scrubber",Vi);var Nr=null;async function Rr(e,t){const n=(t==null?void 0:t.width)??2048,r=(t==null?void 0:t.height)??2048,i=n/r,s=Nr??(Nr=await(async()=>new(await q).PerspectiveCamera(20,i,.1,20))()),o=new(await q).Scene,u=new Ci(e,{scheduleRender:()=>{}},await e.puzzleLoader.get(),await e.visualizationStrategy.get());await e.twistySceneModel.stickering.get(),await new Promise(v=>setTimeout(v,1e3)),await e.legacyPosition.get(),o.add(await u.twisty3DPuzzle());const d=await e.twistySceneModel.orbitCoordinates.get();await _i(s,d);const h=new(await q).WebGLRenderer({antialias:!0,alpha:!0});h.setSize(n,r),h.render(o,s);const f=h.domElement.toDataURL(),g=await Bi(e);return{dataURL:f,download:async v=>{qi(f,v??g)}}}async function Bi(e){const[t,n]=await Promise.all([e.puzzleID.get(),e.alg.get()]);return`[${t}]${n.alg.experimentalNumUnits()===0?"":" "+n.alg.toString()}`}function qi(e,t,n="png"){const r=document.createElement("a");r.href=e,r.download=`${t}.${n}`,r.click()}var Ys=new Z(`
:host {
  width: 384px;
  height: 256px;
  display: grid;

  -webkit-user-select: none;
  user-select: none;
}

.wrapper {
  display: grid;
  overflow: hidden;
  grid-template-rows: 7fr minmax(1.5em, 0.5fr) minmax(2em, 1fr);
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

.wrapper.controls-none {
  grid-template-rows: 7fr;
}

.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-control-button-panel ,
.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-buttons {
  display: none;
}

twisty-scrubber {
  background: rgba(196, 196, 196, 0.5);
}

.wrapper.checkered {
  background-color: #EAEAEA;
  background-image: linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD),
    linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD);
  background-size: 32px 32px;
  background-position: 0 0, 16px 16px;
}

.visualization-wrapper > * {
  width: 100%;
  height: 100%;
}

.error-elem {
  width: 100%;
  height: 100%;
  display: none;
  place-content: center;
  font-family: sans-serif;
  box-shadow: inset 0 0 2em rgb(255, 0, 0);
  color: red;
  text-shadow: 0 0 0.2em white;
  background: rgba(255, 255, 255, 0.25);
}

.wrapper.error .visualization-wrapper {
  display: none;
}

.wrapper.error .error-elem {
  display: grid;
}
`),_r=class extends L{getDefaultValue(){return null}},Xn=class extends be{getDefaultValue(){return null}derive(e){return typeof e=="string"?new URL(e,location.href):e}},$e=class{constructor(e){this.warnings=Object.freeze((e==null?void 0:e.warnings)??[]),this.errors=Object.freeze((e==null?void 0:e.errors)??[]),Object.freeze(this)}add(e){return new $e({warnings:this.warnings.concat((e==null?void 0:e.warnings)??[]),errors:this.errors.concat((e==null?void 0:e.errors)??[])})}log(){this.errors.length>0?console.error(`🚨 ${this.errors[0]}`):this.warnings.length>0?console.warn(`⚠️ ${this.warnings[0]}`):console.info("😎 No issues!")}};function Gi(e){try{const t=p.fromString(e),n=[];return t.toString()!==e&&n.push("Alg is non-canonical!"),{alg:t,issues:new $e({warnings:n})}}catch(t){return{alg:new p,issues:new $e({errors:[`Malformed alg: ${t.toString()}`]})}}}function Hs(e,t){return e.alg.isIdentical(t.alg)&&Rn(e.issues.warnings,t.issues.warnings)&&Rn(e.issues.errors,t.issues.errors)}var Or=class extends be{getDefaultValue(){return{alg:new p,issues:new $e}}canReuseValue(e,t){return Hs(e,t)}async derive(e){return typeof e=="string"?Gi(e):{alg:e,issues:new $e}}},$s=class extends x{derive(e){return e.kpuzzle.algToTransformation(e.setupAlg.alg)}},Xs=class extends x{derive(e){if(e.setupTransformation)return e.setupTransformation;switch(e.setupAnchor){case"start":return e.setupAlgTransformation;case"end":{const n=e.indexer.transformationAtIndex(e.indexer.numAnimatedLeaves()).invert();return e.setupAlgTransformation.applyTransformation(n)}default:throw new Error("Unimplemented!")}}},Zs=class extends L{getDefaultValue(){return{move:null,amount:0}}canReuseValue(e,t){return e.move===t.move&&e.amount===t.amount}},Ks=class extends x{derive(e){return{stateIndex:e.currentMoveInfo.stateIndex,movesFinishing:e.currentMoveInfo.movesFinishing.map(t=>t.move),movesFinished:e.currentMoveInfo.movesFinished.map(t=>t.move)}}canReuse(e,t){return e.stateIndex===t.stateIndex&&Lr(e.movesFinishing,t.movesFinishing,(n,r)=>n.isIdentical(r))&&Lr(e.movesFinished,t.movesFinished,(n,r)=>n.isIdentical(r))}},Js=class extends x{derive(e){var n;function t(r){return e.detailedTimelineInfo.atEnd&&e.catchUpMove.move!==null&&r.currentMoves.push({move:e.catchUpMove.move,direction:-1,fraction:1-e.catchUpMove.amount,startTimestamp:-1,endTimestamp:-1}),r}if(e.indexer.currentMoveInfo)return t(e.indexer.currentMoveInfo(e.detailedTimelineInfo.timestamp));{const r=e.indexer.timestampToIndex(e.detailedTimelineInfo.timestamp),i={stateIndex:r,currentMoves:[],movesFinishing:[],movesFinished:[],movesStarting:[],latestStart:-1/0,earliestEnd:1/0};if(e.indexer.numAnimatedLeaves()>0){const s=(n=e.indexer.getAnimLeaf(r))==null?void 0:n.as(l);if(!s)return t(i);const o=e.indexer.indexToMoveStartTimestamp(r),u=e.indexer.moveDuration(r),d=(e.detailedTimelineInfo.timestamp-o)/u,h=o+u,f={move:s,direction:1,fraction:d,startTimestamp:o,endTimestamp:h};d===0?i.movesStarting.push(f):d===1?i.movesFinishing.push(f):(i.currentMoves.push(f),i.latestStart=Math.max(i.latestStart,o),i.earliestEnd=Math.min(i.earliestEnd,h))}return t(i)}}},eo=class extends x{derive(e){let t=e.indexer.transformationAtIndex(e.currentLeavesSimplified.stateIndex);t=e.anchoredStart.applyTransformation(t);for(const n of e.currentLeavesSimplified.movesFinishing)t=t.applyMove(n);for(const n of e.currentLeavesSimplified.movesFinished)t=t.applyMove(n);return t.toKState()}};function Te(e){switch(Math.abs(e)){case 0:return 0;case 1:return 1e3;case 2:return 1500;default:return 2e3}}var Qi=class extends Ze{constructor(e=Te){super(),this.durationForAmount=e}traverseAlg(e){let t=0;for(const n of e.units())t+=this.traverseUnit(n);return t}traverseGrouping(e){return e.amount*this.traverseAlg(e.alg)}traverseMove(e){return this.durationForAmount(e.amount)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return this.durationForAmount(1)}traverseNewline(e){return this.durationForAmount(1)}traverseLineComment(e){return this.durationForAmount(0)}},to=class{constructor(e,t){this.kpuzzle=e,this.durationFn=new Qi(Te),this.moves=new p(t.experimentalExpand())}getAnimLeaf(e){return Array.from(this.moves.units())[e]}indexToMoveStartTimestamp(e){const t=new p(Array.from(this.moves.units()).slice(0,e));return this.durationFn.traverseAlg(t)}timestampToIndex(e){let t=0,n;for(n=0;n<this.numAnimatedLeaves();n++)if(t+=this.durationFn.traverseMove(this.getAnimLeaf(n)),t>=e)return n;return n}stateAtIndex(e){return this.kpuzzle.startState().applyTransformation(this.transformationAtIndex(e))}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of Array.from(this.moves.units()).slice(0,e))t=t.applyMove(n);return t}algDuration(){return this.durationFn.traverseAlg(this.moves)}numAnimatedLeaves(){return gs(this.moves)}moveDuration(e){return this.durationFn.traverseMove(this.getAnimLeaf(e))}},Ur={u:"y",l:"x",f:"z",r:"x",b:"z",d:"y",m:"x",e:"y",s:"z",x:"x",y:"y",z:"z"};function no(e,t){return Ur[e.family[0].toLowerCase()]===Ur[t.family[0].toLowerCase()]}var ro=class extends Ze{traverseAlg(e){const t=[];for(const n of e.units())t.push(this.traverseUnit(n));return Array.prototype.concat(...t)}traverseGroupingOnce(e){if(e.experimentalIsEmpty())return[];for(const i of e.units())if(!i.is(l))return this.traverseAlg(e);const t=Array.from(e.units());let n=Te(t[0].amount);for(let i=0;i<t.length-1;i++){for(let s=1;s<t.length;s++)if(!no(t[i],t[s]))return this.traverseAlg(e);n=Math.max(n,Te(t[i].amount))}const r=t.map(i=>({animLeafUnit:i,msUntilNext:0,duration:n}));return r[r.length-1].msUntilNext=n,r}traverseGrouping(e){const t=[],n=e.amount>0?e.alg:e.alg.invert();for(let r=0;r<Math.abs(e.amount);r++)t.push(this.traverseGroupingOnce(n));return Array.prototype.concat(...t)}traverseMove(e){const t=Te(e.amount);return[{animLeafUnit:e,msUntilNext:t,duration:t}]}traverseCommutator(e){const t=[],n=[e.A,e.B,e.A.invert(),e.B.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traverseConjugate(e){const t=[],n=[e.A,e.B,e.A.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traversePause(e){const t=Te(1);return[{animLeafUnit:e,msUntilNext:t,duration:t}]}traverseNewline(e){return[]}traverseLineComment(e){return[]}},Wr=new ro,io=Wr.traverseAlg.bind(Wr);function ao(e){let t=0;return io(e).map(r=>{const i={animLeaf:r.animLeafUnit,start:t,end:t+r.duration};return t+=r.msUntilNext,i})}var so={"y' y' U' E D R2 r2 F2 B2 U E D' R2 L2' z2 S2 U U D D S2 F2' B2":[{animLeaf:new l("y",-1),start:0,end:1e3},{animLeaf:new l("y",-1),start:1e3,end:2e3},{animLeaf:new l("U",-1),start:1e3,end:1600},{animLeaf:new l("E",1),start:1200,end:1800},{animLeaf:new l("D"),start:1400,end:2e3},{animLeaf:new l("R",2),start:2e3,end:3500},{animLeaf:new l("r",2),start:2e3,end:3500},{animLeaf:new l("F",2),start:3500,end:4200},{animLeaf:new l("B",2),start:3800,end:4500},{animLeaf:new l("U",1),start:4500,end:5500},{animLeaf:new l("E",1),start:4500,end:5500},{animLeaf:new l("D",-1),start:4500,end:5500},{animLeaf:new l("R",2),start:5500,end:6500},{animLeaf:new l("L",-2),start:5500,end:6500},{animLeaf:new l("z",2),start:5500,end:6500},{animLeaf:new l("S",2),start:6500,end:7500},{animLeaf:new l("U"),start:7500,end:8e3},{animLeaf:new l("D"),start:7750,end:8250},{animLeaf:new l("U"),start:8e3,end:8500},{animLeaf:new l("D"),start:8250,end:8750},{animLeaf:new l("S",2),start:8750,end:9250},{animLeaf:new l("F",-2),start:8750,end:1e4},{animLeaf:new l("B",2),start:8750,end:1e4}],"M' R' U' D' M R":[{animLeaf:new l("M",-1),start:0,end:1e3},{animLeaf:new l("R",-1),start:0,end:1e3},{animLeaf:new l("U",-1),start:1e3,end:2e3},{animLeaf:new l("D",-1),start:1e3,end:2e3},{animLeaf:new l("M"),start:2e3,end:3e3},{animLeaf:new l("R"),start:2e3,end:3e3}],"U' E' r E r2' E r U E":[{animLeaf:new l("U",-1),start:0,end:1e3},{animLeaf:new l("E",-1),start:0,end:1e3},{animLeaf:new l("r"),start:1e3,end:2500},{animLeaf:new l("E"),start:2500,end:3500},{animLeaf:new l("r",-2),start:3500,end:5e3},{animLeaf:new l("E"),start:5e3,end:6e3},{animLeaf:new l("r"),start:6e3,end:7e3},{animLeaf:new l("U"),start:7e3,end:8e3},{animLeaf:new l("E"),start:7e3,end:8e3}]},jr=class{constructor(e,t){this.kpuzzle=e,this.animLeaves=so[t.toString()]??ao(t)}getAnimLeaf(e){var t;return((t=this.animLeaves[Math.min(e,this.animLeaves.length-1)])==null?void 0:t.animLeaf)??null}getAnimLeafWithRange(e){return this.animLeaves[Math.min(e,this.animLeaves.length-1)]}indexToMoveStartTimestamp(e){let t=0;return this.animLeaves.length>0&&(t=this.animLeaves[Math.min(e,this.animLeaves.length-1)].start),t}timestampToIndex(e){let t=0;for(t=0;t<this.animLeaves.length;t++)if(this.animLeaves[t].start>=e)return Math.max(0,t-1);return Math.max(0,t-1)}timestampToPosition(e,t){const n=this.currentMoveInfo(e);let r=t??this.kpuzzle.identityTransformation().toKState();for(const i of this.animLeaves.slice(0,n.stateIndex)){const s=i.animLeaf.as(l);s!==null&&(r=r.applyMove(s))}return{state:r,movesInProgress:n.currentMoves}}currentMoveInfo(e){let t=1/0;for(const h of this.animLeaves)if(h.start<=e&&h.end>=e)t=Math.min(t,h.start);else if(h.start>e)break;const n=[],r=[],i=[],s=[];let o=-1/0,u=1/0,d=0;for(const h of this.animLeaves)if(h.end<=t)d++;else{if(h.start>e)break;{const f=h.animLeaf.as(l);if(f!==null){let g=(e-h.start)/(h.end-h.start),v=!1;g>1&&(g=1,v=!0);const b={move:f,direction:1,fraction:g,startTimestamp:h.start,endTimestamp:h.end};switch(g){case 0:r.push(b);break;case 1:v?s.push(b):i.push(b);break;default:n.push(b),o=Math.max(o,h.start),u=Math.min(u,h.end)}}}}return{stateIndex:d,currentMoves:n,latestStart:o,earliestEnd:u,movesStarting:r,movesFinishing:i,movesFinished:s}}stateAtIndex(e,t){let n=t??this.kpuzzle.startState();for(let r=0;r<this.animLeaves.length&&r<e;r++){const s=this.animLeaves[r].animLeaf.as(l);s!==null&&(n=n.applyMove(s))}return n}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of this.animLeaves.slice(0,e)){const r=n.animLeaf.as(l);r!==null&&(t=t.applyMove(r))}return t}algDuration(){let e=0;for(const t of this.animLeaves)e=Math.max(e,t.end);return e}numAnimatedLeaves(){return this.animLeaves.length}moveDuration(e){const t=this.getAnimLeafWithRange(e);return t.end-t.start}},fe=class{constructor(e,t,n,r,i=[]){this.moveCount=e,this.duration=t,this.forward=n,this.backward=r,this.children=i}},oo=class extends Ze{constructor(e){super(),this.kpuzzle=e,this.durationFn=new Qi(Te),this.cache={},this.identity=e.identityTransformation(),this.dummyLeaf=new fe(0,0,this.identity,this.identity,[])}traverseAlg(e){let t=0,n=0,r=this.identity;const i=[];for(const s of e.units()){const o=this.traverseUnit(s);t+=o.moveCount,n+=o.duration,r===this.identity?r=o.forward:r=r.applyTransformation(o.forward),i.push(o)}return new fe(t,n,r,r.invert(),i)}traverseGrouping(e){const t=this.traverseAlg(e.alg);return this.mult(t,e.amount,[t])}traverseMove(e){const t=e.toString();let n=this.cache[t];if(n)return n;const r=this.kpuzzle.moveToTransformation(e);return n=new fe(1,this.durationFn.traverseUnit(e),r,r.invert()),this.cache[t]=n,n}traverseCommutator(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),r=t.forward.applyTransformation(n.forward),i=t.backward.applyTransformation(n.backward),s=r.applyTransformation(i),o=new fe(2*(t.moveCount+n.moveCount),2*(t.duration+n.duration),s,s.invert(),[t,n]);return this.mult(o,1,[o,t,n])}traverseConjugate(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),i=t.forward.applyTransformation(n.forward).applyTransformation(t.backward),s=new fe(2*t.moveCount+n.moveCount,2*t.duration+n.duration,i,i.invert(),[t,n]);return this.mult(s,1,[s,t,n])}traversePause(e){return new fe(1,this.durationFn.traverseUnit(e),this.identity,this.identity)}traverseNewline(e){return this.dummyLeaf}traverseLineComment(e){return this.dummyLeaf}mult(e,t,n){const r=Math.abs(t),i=e.forward.selfMultiply(t);return new fe(e.moveCount*r,e.duration*r,i,i.invert(),n)}},k=class{constructor(e,t){this.apd=e,this.back=t}},lo=class extends Xe{constructor(e,t,n){super(),this.kpuzzle=e,this.algOrUnit=t,this.apd=n,this.i=-1,this.dur=-1,this.goali=-1,this.goaldur=-1,this.move=void 0,this.back=!1,this.moveDuration=0,this.st=this.kpuzzle.identityTransformation(),this.root=new k(this.apd,!1)}moveByIndex(e){return this.i>=0&&this.i===e?this.move!==void 0:this.dosearch(e,1/0)}moveByDuration(e){return this.dur>=0&&this.dur<e&&this.dur+this.moveDuration>=e?this.move!==void 0:this.dosearch(1/0,e)}dosearch(e,t){return this.goali=e,this.goaldur=t,this.i=0,this.dur=0,this.move=void 0,this.moveDuration=0,this.back=!1,this.st=this.kpuzzle.identityTransformation(),this.algOrUnit.is(p)?this.traverseAlg(this.algOrUnit,this.root):this.traverseUnit(this.algOrUnit,this.root)}traverseAlg(e,t){if(!this.firstcheck(t))return!1;let n=t.back?e.experimentalNumUnits()-1:0;for(const r of ia(e.units(),t.back?-1:1)){if(this.traverseUnit(r,new k(t.apd.children[n],t.back)))return!0;n+=t.back?-1:1}return!1}traverseGrouping(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,e.amount);return this.traverseAlg(e.alg,new k(t.apd.children[0],n))}traverseMove(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseCommutator(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.B,new k(t.apd.children[2],!n))||this.traverseAlg(e.A,new k(t.apd.children[1],!n))||this.traverseAlg(e.B,new k(t.apd.children[2],n))||this.traverseAlg(e.A,new k(t.apd.children[1],n)):this.traverseAlg(e.A,new k(t.apd.children[1],n))||this.traverseAlg(e.B,new k(t.apd.children[2],n))||this.traverseAlg(e.A,new k(t.apd.children[1],!n))||this.traverseAlg(e.B,new k(t.apd.children[2],!n))}traverseConjugate(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.A,new k(t.apd.children[1],!n))||this.traverseAlg(e.B,new k(t.apd.children[2],n))||this.traverseAlg(e.A,new k(t.apd.children[1],n)):this.traverseAlg(e.A,new k(t.apd.children[1],n))||this.traverseAlg(e.B,new k(t.apd.children[2],n))||this.traverseAlg(e.A,new k(t.apd.children[1],!n))}traversePause(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseNewline(e,t){return!1}traverseLineComment(e,t){return!1}firstcheck(e){return e.apd.moveCount+this.i<=this.goali&&e.apd.duration+this.dur<this.goaldur?this.keepgoing(e):!0}domult(e,t){let n=e.back;if(t===0)return n;t<0&&(n=!n,t=-t);const r=e.apd.children[0],i=Math.min(Math.floor((this.goali-this.i)/r.moveCount),Math.ceil((this.goaldur-this.dur)/r.duration-1));return i>0&&this.keepgoing(new k(r,n),i),n}keepgoing(e,t=1){return this.i+=t*e.apd.moveCount,this.dur+=t*e.apd.duration,t!==1?e.back?this.st=this.st.applyTransformation(e.apd.backward.selfMultiply(t)):this.st=this.st.applyTransformation(e.apd.forward.selfMultiply(t)):e.back?this.st=this.st.applyTransformation(e.apd.backward):this.st=this.st.applyTransformation(e.apd.forward),!1}},uo=16;function co(e,t){const n=new zn,r=new zn;for(const i of e.units())r.push(i),r.experimentalNumUnits()>=t&&(n.push(new X(r.toAlg())),r.reset());return n.push(new X(r.toAlg())),n.toAlg()}var ho=class extends Ze{traverseAlg(e){const t=e.experimentalNumUnits();return t<uo?e:co(e,Math.ceil(Math.sqrt(t)))}traverseGrouping(e){return new X(this.traverseAlg(e.alg),e.amount)}traverseMove(e){return e}traverseCommutator(e){return new V(this.traverseAlg(e.A),this.traverseAlg(e.B))}traverseConjugate(e){return new V(this.traverseAlg(e.A),this.traverseAlg(e.B))}traversePause(e){return e}traverseNewline(e){return e}traverseLineComment(e){return e}},Fr=new ho,mo=Fr.traverseAlg.bind(Fr),Vr=class{constructor(e,t){this.kpuzzle=e;const n=new oo(this.kpuzzle),r=mo(t);this.decoration=n.traverseAlg(r),this.walker=new lo(this.kpuzzle,r,this.decoration)}getAnimLeaf(e){if(this.walker.moveByIndex(e)){if(!this.walker.move)throw new Error("`this.walker.mv` missing");const t=this.walker.move;return this.walker.back?t.invert():t}return null}indexToMoveStartTimestamp(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}indexToMovesInProgress(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}stateAtIndex(e,t){return this.walker.moveByIndex(e),(t??this.kpuzzle.startState()).applyTransformation(this.walker.st)}transformationAtIndex(e){return this.walker.moveByIndex(e),this.walker.st}numAnimatedLeaves(){return this.decoration.moveCount}timestampToIndex(e){return this.walker.moveByDuration(e),this.walker.i}algDuration(){return this.decoration.duration}moveDuration(e){return this.walker.moveByIndex(e),this.walker.moveDuration}},po=class extends x{derive(e){switch(e.indexerConstructorRequest){case"auto":return bi(e.alg.alg)<100&&e.puzzle==="3x3x3"&&e.visualizationStrategy==="Cube3D"?jr:Vr;case"tree":return Vr;case"simple":return to;case"simultaneous":return jr;default:throw new Error("Invalid indexer request!")}}},fo=class extends L{getDefaultValue(){return"auto"}},go=class extends x{derive(e){return new e.indexerConstructor(e.kpuzzle,e.algWithIssues.alg)}},wo=class extends x{derive(e){return{state:e.state,movesInProgress:e.currentMoveInfo.currentMoves}}},vo=class extends x{derive(e){return e.alg.issues.errors.length>0?null:bi(e.alg.alg)}},yo=!0,Br=class extends x{async derive(e){try{return yo&&e.kpuzzle.algToTransformation(e.algWithIssues.alg),e.algWithIssues}catch(t){return{alg:new p,issues:new $e({errors:[`Invalid alg for puzzle: ${t.toString()}`]})}}}},xo=class extends L{getDefaultValue(){return"start"}},Mo=class extends L{getDefaultValue(){return null}},zo=class extends x{async derive(e){return e.puzzleLoader.kpuzzle()}},So=class extends L{getDefaultValue(){return wt}},To=class extends x{async derive(e){return e.puzzleLoader.id}},Io=class extends L{getDefaultValue(){return wt}},Lo=class extends x{derive(e){if(e.puzzleIDRequest&&e.puzzleIDRequest!==wt){const t=gi[e.puzzleIDRequest];return t||this.userVisibleErrorTracker.set({errors:[`Invalid puzzle ID: ${e.puzzleIDRequest}`]}),t}return e.puzzleDescriptionRequest&&e.puzzleDescriptionRequest!==wt?Pa(e.puzzleDescriptionRequest):or}},bo=class extends x{derive(e){return{playing:e.playingInfo.playing,atStart:e.detailedTimelineInfo.atStart,atEnd:e.detailedTimelineInfo.atEnd}}canReuseValue(e,t){return e.playing===t.playing&&e.atStart===t.atStart&&e.atEnd===t.atEnd}},Zn,Yi,ko=class extends x{constructor(){super(...arguments),c(this,Zn)}derive(e){let t=M(this,Zn,Yi).call(this,e),n=!1,r=!1;return t>=e.timeRange.end&&(r=!0,t=Math.min(e.timeRange.end,t)),t<=e.timeRange.start&&(n=!0,t=Math.max(e.timeRange.start,t)),{timestamp:t,timeRange:e.timeRange,atStart:n,atEnd:r}}canReuse(e,t){return e.timestamp===t.timestamp&&e.timeRange.start===t.timeRange.start&&e.timeRange.end===t.timeRange.end&&e.atStart===t.atStart&&e.atEnd===t.atEnd}};Zn=new WeakSet;Yi=function(e){switch(e.timestampRequest){case"start":return e.timeRange.start;case"end":return e.timeRange.end;case"anchor":return e.setupAnchor==="start"?e.timeRange.start:e.timeRange.end;case"opposite-anchor":return e.setupAnchor==="start"?e.timeRange.end:e.timeRange.start;default:return e.timestampRequest}};var Eo=class extends be{async getDefaultValue(){return{direction:1,playing:!1,untilBoundary:"entire-timeline",loop:!1}}async derive(e,t){const n=await t,r=Object.assign({},n);return Object.assign(r,e),r}canReuseValue(e,t){return e.direction===t.direction&&e.playing===t.playing&&e.untilBoundary===t.untilBoundary&&e.loop===t.loop}},Do=class extends be{getDefaultValue(){return 1}derive(e){return e<0?1:e}},Ao={start:!0,end:!0,anchor:!0,"opposite-anchor":!0},Co=class extends L{getDefaultValue(){return"opposite-anchor"}set(e){this.validInput(e)&&super.set(e)}validInput(e){return!!(typeof e=="number"||Ao[e])}},Po=class extends L{getDefaultValue(){return"auto"}},No=class extends x{derive(e){return{start:0,end:e.indexer.algDuration()}}},Ro=class extends L{getDefaultValue(){return"auto"}},_o=class extends L{getDefaultValue(){return"auto"}},Oo=class extends x{derive(e){switch(e.puzzleID){case"clock":case"square1":case"kilominx":case"redi_cube":return"2D";case"3x3x3":switch(e.visualizationRequest){case"auto":case"3D":return"Cube3D";default:return e.visualizationRequest}default:switch(e.visualizationRequest){case"auto":case"3D":return"PG3D";case"experimental-2D-LL":return"2D";default:return e.visualizationRequest}}}},Uo=class extends L{getDefaultValue(){return"auto"}},qr=null;async function Wo(){return qr??(qr=new(await q).TextureLoader)}var Gr=class extends x{async derive(e){const{spriteURL:t}=e;return t===null?null:new Promise(async(n,r)=>{const i=()=>{console.warn("Could not load sprite:",t.toString()),n(null)};try{(await Wo()).load(t.toString(),n,i,i)}catch{i()}})}},jo=class extends L{getDefaultValue(){return"auto"}},Fo=class extends L{getDefaultValue(){return"auto"}},Vo=35,Bo=class extends L{getDefaultValue(){return Vo}};function Hi(e,t){return e.latitude===t.latitude&&e.longitude===t.longitude&&e.distance===t.distance}var qo=class extends be{getDefaultValue(){return"auto"}canReuseValue(e,t){return e===t||Hi(e,t)}async derive(e,t){if(e==="auto")return"auto";let n=await t;n==="auto"&&(n={});const r=Object.assign({},n);return Object.assign(r,e),typeof r.latitude<"u"&&(r.latitude=Math.min(Math.max(r.latitude,-90),90)),typeof r.longitude<"u"&&(r.longitude=ki(r.longitude,360,180)),r}},Go=class extends x{canReuseValue(e,t){return Hi(e,t)}async derive(e){if(e.orbitCoordinatesRequest==="auto")return Yr(e.puzzleID,e.strategy);const t=Object.assign(Object.assign({},Yr(e.puzzleID,e.strategy),e.orbitCoordinatesRequest));if(Math.abs(t.latitude)<=e.latitudeLimit)return t;{const{latitude:n,longitude:r,distance:i}=t;return{latitude:e.latitudeLimit*Math.sign(n),longitude:r,distance:i}}}},Qo={latitude:31.717474411461005,longitude:0,distance:5.877852522924731},Yo={latitude:35,longitude:30,distance:6},Qr={latitude:35,longitude:30,distance:6.25},Ho={latitude:Math.atan(1/2)*vt,longitude:0,distance:6.7},$o={latitude:26.56505117707799,longitude:0,distance:6};function Yr(e,t){if(e[1]==="x")return t==="Cube3D"?Yo:Qr;switch(e){case"megaminx":case"gigaminx":return Ho;case"pyraminx":case"master_tetraminx":return $o;case"skewb":return Qr;default:return Qo}}var Xo=class{constructor(e){this.twistyPlayerModel=e,this.background=new Fo,this.foundationDisplay=new Uo,this.foundationStickerSpriteURL=new Xn,this.hintFacelet=new ds,this.hintStickerSpriteURL=new Xn,this.latitudeLimit=new Bo,this.movePressInput=new jo,this.orbitCoordinatesRequest=new qo,this.stickering=new cs,this.foundationStickerSprite=new Gr({spriteURL:this.foundationStickerSpriteURL}),this.hintStickerSprite=new Gr({spriteURL:this.hintStickerSpriteURL}),this.orbitCoordinates=new Go({orbitCoordinatesRequest:this.orbitCoordinatesRequest,latitudeLimit:this.latitudeLimit,puzzleID:e.puzzleID,strategy:e.visualizationStrategy})}},Zo={errors:[]},Ko=class extends L{getDefaultValue(){return Zo}reset(){this.set(this.getDefaultValue())}canReuseValue(e,t){return Rn(e.errors,t.errors)}},Jo=class{constructor(){this.userVisibleErrorTracker=new Ko,this.alg=new Or,this.backView=new Po,this.controlPanel=new Ms,this.catchUpMove=new Zs,this.indexerConstructorRequest=new fo,this.playingInfo=new Eo,this.puzzleDescriptionRequest=new So,this.puzzleIDRequest=new Io,this.setupAnchor=new xo,this.setupAlg=new Or,this.setupTransformation=new Mo,this.tempoScale=new Do,this.timestampRequest=new Co,this.viewerLink=new Ro,this.visualizationFormat=new _o,this.title=new _r,this.videoURL=new Xn,this.competitionID=new _r,this.puzzleLoader=new Lo({puzzleIDRequest:this.puzzleIDRequest,puzzleDescriptionRequest:this.puzzleDescriptionRequest},this.userVisibleErrorTracker),this.kpuzzle=new zo({puzzleLoader:this.puzzleLoader}),this.puzzleID=new To({puzzleLoader:this.puzzleLoader}),this.puzzleAlg=new Br({algWithIssues:this.alg,kpuzzle:this.kpuzzle}),this.puzzleSetupAlg=new Br({algWithIssues:this.setupAlg,kpuzzle:this.kpuzzle}),this.visualizationStrategy=new Oo({visualizationRequest:this.visualizationFormat,puzzleID:this.puzzleID}),this.indexerConstructor=new po({alg:this.alg,puzzle:this.puzzleID,visualizationStrategy:this.visualizationStrategy,indexerConstructorRequest:this.indexerConstructorRequest}),this.moveCount=new vo({alg:this.puzzleAlg}),this.setupAlgTransformation=new $s({setupAlg:this.puzzleSetupAlg,kpuzzle:this.kpuzzle}),this.indexer=new go({indexerConstructor:this.indexerConstructor,algWithIssues:this.puzzleAlg,kpuzzle:this.kpuzzle}),this.anchorTransformation=new Xs({setupTransformation:this.setupTransformation,setupAnchor:this.setupAnchor,setupAlgTransformation:this.setupAlgTransformation,indexer:this.indexer}),this.timeRange=new No({indexer:this.indexer}),this.detailedTimelineInfo=new ko({timestampRequest:this.timestampRequest,timeRange:this.timeRange,setupAnchor:this.setupAnchor}),this.coarseTimelineInfo=new bo({detailedTimelineInfo:this.detailedTimelineInfo,playingInfo:this.playingInfo}),this.currentMoveInfo=new Js({indexer:this.indexer,detailedTimelineInfo:this.detailedTimelineInfo,catchUpMove:this.catchUpMove}),this.buttonAppearance=new Gs({coarseTimelineInfo:this.coarseTimelineInfo,viewerLink:this.viewerLink}),this.currentLeavesSimplified=new Ks({currentMoveInfo:this.currentMoveInfo}),this.currentState=new eo({anchoredStart:this.anchorTransformation,currentLeavesSimplified:this.currentLeavesSimplified,indexer:this.indexer}),this.legacyPosition=new wo({currentMoveInfo:this.currentMoveInfo,state:this.currentState}),this.twistySceneModel=new Xo(this)}async twizzleLink(){const[e,t,n,r,i,s,o]=await Promise.all([this.viewerLink.get(),this.puzzleID.get(),this.puzzleDescriptionRequest.get(),this.alg.get(),this.setupAlg.get(),this.setupAnchor.get(),this.twistySceneModel.stickering.get()]),u=e==="experimental-twizzle-explorer";console.log({isExplorer:u,viewerLink:e});const d=new URL(`https://alpha.twizzle.net/${u?"explore":"edit"}/`);return r.alg.experimentalIsEmpty()||d.searchParams.set("alg",r.alg.toString()),i.alg.experimentalIsEmpty()||d.searchParams.set("setup-alg",i.alg.toString()),s!=="start"&&d.searchParams.set("setup-anchor",s),o!=="full"&&d.searchParams.set("experimental-stickering",o),u&&n!==wt?d.searchParams.set("puzzle-description",n):t!=="3x3x3"&&d.searchParams.set("puzzle",t),d.toString()}experimentalAddMove(e,t={}){const n=typeof e=="string"?new l(e):e;(async()=>{const r=(await this.alg.get()).alg,i=ya(r,n,{coalesce:t==null?void 0:t.coalesce,mod:t==null?void 0:t.mod});this.alg.set(i),this.timestampRequest.set("end"),this.catchUpMove.set({move:n,amount:0})})()}get playingInfoProp(){return console.warn("Using deprecated prop: `playingInfoProp`. Please switch to: `playingInfo`"),this.playingInfo}};function y(e){return new Error(`Cannot get \`.${e}\` directly from a \`TwistyPlayer\`.`)}var el=class extends G{constructor(){super(...arguments),this.experimentalModel=new Jo,this.experimentalGet=new tl(this.experimentalModel)}set alg(e){this.experimentalModel.alg.set(e)}get alg(){throw y("alg")}set experimentalSetupAlg(e){this.experimentalModel.setupAlg.set(e)}get experimentalSetupAlg(){throw y("setup")}set experimentalSetupAnchor(e){this.experimentalModel.setupAnchor.set(e)}get experimentalSetupAnchor(){throw y("anchor")}set puzzle(e){this.experimentalModel.puzzleIDRequest.set(e)}get puzzle(){throw y("puzzle")}set experimentalPuzzleDescription(e){this.experimentalModel.puzzleDescriptionRequest.set(e)}get experimentalPuzzleDescription(){throw y("experimentalPuzzleDescription")}set timestamp(e){this.experimentalModel.timestampRequest.set(e)}get timestamp(){throw y("timestamp")}set hintFacelets(e){this.experimentalModel.twistySceneModel.hintFacelet.set(e)}get hintFacelets(){throw y("hintFacelets")}set experimentalStickering(e){this.experimentalModel.twistySceneModel.stickering.set(e)}get experimentalStickering(){throw y("stickering")}set backView(e){this.experimentalModel.backView.set(e)}get backView(){throw y("backView")}set background(e){this.experimentalModel.twistySceneModel.background.set(e)}get background(){throw y("background")}set controlPanel(e){this.experimentalModel.controlPanel.set(e)}get controlPanel(){throw y("controlPanel")}set visualization(e){this.experimentalModel.visualizationFormat.set(e)}get visualization(){throw y("visualization")}set experimentalTitle(e){this.experimentalModel.title.set(e)}get experimentalTitle(){throw y("experimentalTitle")}set experimentalVideoURL(e){this.experimentalModel.videoURL.set(e)}get experimentalVideoURL(){throw y("experimentalVideoURL")}set experimentalCompetitionID(e){this.experimentalModel.competitionID.set(e)}get experimentalCompetitionID(){throw y("experimentalCompetitionID")}set viewerLink(e){this.experimentalModel.viewerLink.set(e)}get viewerLink(){throw y("viewerLink")}set experimentalMovePressInput(e){this.experimentalModel.twistySceneModel.movePressInput.set(e)}get experimentalMovePressInput(){throw y("experimentalMovePressInput")}set cameraLatitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({latitude:e})}get cameraLatitude(){throw y("cameraLatitude")}set cameraLongitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({longitude:e})}get cameraLongitude(){throw y("cameraLongitude")}set cameraDistance(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({distance:e})}get cameraDistance(){throw y("cameraDistance")}set cameraLatitudeLimit(e){this.experimentalModel.twistySceneModel.latitudeLimit.set(e)}get cameraLatitudeLimit(){throw y("cameraLatitudeLimit")}set indexer(e){this.experimentalModel.indexerConstructorRequest.set(e)}get indexer(){throw y("indexer")}set tempoScale(e){this.experimentalModel.tempoScale.set(e)}get tempoScale(){throw y("tempoScale")}set experimentalSprite(e){this.experimentalModel.twistySceneModel.foundationStickerSpriteURL.set(e)}get experimentalSprite(){throw y("experimentalSprite")}set experimentalHintSprite(e){this.experimentalModel.twistySceneModel.hintStickerSpriteURL.set(e)}get experimentalHintSprite(){throw y("experimentalHintSprite")}},tl=class{constructor(e){this.model=e}async alg(){return(await this.model.alg.get()).alg}async setupAlg(){return(await this.model.setupAlg.get()).alg}puzzleID(){return this.model.puzzleID.get()}async timestamp(){return(await this.model.detailedTimelineInfo.get()).timestamp}},nl="data-",hn={alg:"alg","experimental-setup-alg":"experimentalSetupAlg","experimental-setup-anchor":"experimentalSetupAnchor",puzzle:"puzzle","experimental-puzzle-description":"experimentalPuzzleDescription",visualization:"visualization","hint-facelets":"hintFacelets","experimental-stickering":"experimentalStickering",background:"background","control-panel":"controlPanel","back-view":"backView","viewer-link":"viewerLink","experimental-move-press-input":"experimentalMovePressInput","experimental-title":"experimentalTitle","experimental-video-url":"experimentalVideoURL","experimental-competition-id":"experimentalCompetitionID","camera-latitude":"cameraLatitude","camera-longitude":"cameraLongitude","camera-distance":"cameraDistance","camera-latitude-limit":"cameraLatitudeLimit","tempo-scale":"tempoScale","experimental-sprite":"experimentalSprite","experimental-hint-sprite":"experimentalHintSprite"},rl=Object.fromEntries(Object.values(hn).map(e=>[e,!0])),Kn,mn,dt,Zt,re,pn,Jn,$i,St=class extends el{constructor(e={}){super(),c(this,Jn),this.controller=new ys(this.experimentalModel,this),this.experimentalCanvasClickCallback=()=>{},c(this,Kn,new wn(this,"controls-",["auto"].concat(Object.keys(xs)))),c(this,mn,document.createElement("div")),c(this,dt,document.createElement("div")),c(this,Zt,!1),c(this,re,null),c(this,pn,null);for(const[t,n]of Object.entries(e)){if(!rl[t]){console.warn(`Invalid config passed to TwistyPlayer: ${t}`);break}this[t]=n}}async connectedCallback(){if(a(this,Zt))return;m(this,Zt,!0),this.addCSS(Ys),this.addElement(a(this,mn)).classList.add("visualization-wrapper"),this.addElement(a(this,dt)).classList.add("error-elem"),a(this,dt).textContent="Error",this.experimentalModel.userVisibleErrorTracker.addFreshListener(t=>{const n=t.errors[0]??null;this.contentWrapper.classList.toggle("error",!!n),n&&(a(this,dt).textContent=n)});const e=new Vi(this.experimentalModel);this.contentWrapper.appendChild(e),this.buttons=new Wi(this.experimentalModel,this.controller,this),this.contentWrapper.appendChild(this.buttons),this.experimentalModel.twistySceneModel.background.addFreshListener(t=>{this.contentWrapper.classList.toggle("checkered",t!=="none")}),this.experimentalModel.controlPanel.addFreshListener(t=>{a(this,Kn).setValue(t)}),this.experimentalModel.visualizationStrategy.addFreshListener(M(this,Jn,$i).bind(this)),this.experimentalModel.puzzleID.addFreshListener(this.flash.bind(this))}flash(){var e;(e=a(this,re))==null||e.animate([{opacity:.25},{opacity:1}],{duration:250})}async experimentalCurrentCanvases(){this.connectedCallback();const e=a(this,re),t=[];if(e instanceof dr){const n=e.experimentalVantages();for(const r of n)t.push((await r.canvasInfo()).canvas)}return t}async experimentalPG3D(){return this.connectedCallback(),a(this,re),null}jumpToStart(e){this.controller.jumpToStart(e)}jumpToEnd(e){this.controller.jumpToEnd(e)}play(){this.controller.togglePlay(!0)}pause(){this.controller.togglePlay(!1)}togglePlay(e){this.controller.togglePlay(e)}experimentalAddMove(e,t={}){this.experimentalModel.experimentalAddMove(e,t)}static get observedAttributes(){const e=[];for(const t of Object.keys(hn))e.push(t,nl+t);return e}attributeChangedCallback(e,t,n){e.startsWith("data-")&&(e=e.slice(5));const r=hn[e];r&&(this[r]=n)}async experimentalScreenshot(e){return(await Rr(this.experimentalModel,e)).dataURL}async experimentalDownloadScreenshot(e){if(["2D","experimental-2D-LL"].includes(await this.experimentalModel.visualizationStrategy.get())){const n=await a(this,re).currentTwisty2DPuzzleWrapper().twisty2DPuzzle(),r=new XMLSerializer().serializeToString(n.svg.element),i=URL.createObjectURL(new Blob([r]));qi(i,e??await Bi(this.experimentalModel),"svg")}else await(await Rr(this.experimentalModel)).download(e)}};Kn=new WeakMap;mn=new WeakMap;dt=new WeakMap;Zt=new WeakMap;re=new WeakMap;pn=new WeakMap;Jn=new WeakSet;$i=function(e){var t,n;if(e!==a(this,pn)){(t=a(this,re))==null||t.remove(),(n=a(this,re))==null||n.disconnect();let r;switch(e){case"2D":case"experimental-2D-LL":r=new Ai(this.experimentalModel.twistySceneModel,e);break;case"Cube3D":case"PG3D":r=new dr(this.experimentalModel);break;default:throw new Error("Invalid visualization")}a(this,mn).appendChild(r),m(this,re,r),m(this,pn,e)}};N.define("twisty-player",St);var il=new Z(`
:host {
  display: inline-grid;
}

a:not(:hover) {
  color: inherit;
  text-decoration: none;
}

twisty-alg-leaf-elem.twisty-alg-comment {
  color: rgba(0, 0, 0, 0.4);
}

.wrapper.current-move {
  background: rgba(66, 133, 244, 0.3);
  margin-left: -0.1em;
  margin-right: -0.1em;
  padding-left: 0.1em;
  padding-right: 0.1em;
  border-radius: 0.1em;
}
`),al=250,Oe=class extends G{constructor(e,t,n,r,i,s){if(super({mode:"open"}),this.algOrUnit=r,this.classList.add(e),this.addCSS(il),s){const o=this.contentWrapper.appendChild(document.createElement("a"));o.href="#",o.textContent=t,o.addEventListener("click",u=>{u.preventDefault(),n.twistyAlgViewer.jumpToIndex(n.earliestMoveIndex,i)})}else this.contentWrapper.appendChild(document.createElement("span")).textContent=t}pathToIndex(e){return[]}setCurrentMove(e){this.contentWrapper.classList.toggle("current-move",e)}};N.define("twisty-alg-leaf-elem",Oe);var Ue=class extends yt{constructor(e,t){super(),this.algOrUnit=t,this.queue=[],this.classList.add(e)}addString(e){this.queue.push(document.createTextNode(e))}addElem(e){return this.queue.push(e.element),e.moveCount}flushQueue(e=1){for(const t of Xi(this.queue,e))this.append(t);this.queue=[]}pathToIndex(e){return[]}};N.define("twisty-alg-wrapper-elem",Ue);function sl(e){return e===1?-1:1}function ol(e,t){return t<0?sl(e):e}function Xi(e,t){if(t===1)return e;const n=Array.from(e);return n.reverse(),n}var ll=class extends Xe{traverseAlg(e,t){let n=0;const r=new Ue("twisty-alg-alg",e);let i=!0;for(const s of Jr(e.units(),t.direction))i||r.addString(" "),i=!1,n+=r.addElem(this.traverseUnit(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}));return r.flushQueue(t.direction),{moveCount:n,element:r}}traverseGrouping(e,t){const n=e.experimentalAsSquare1Tuple(),r=ol(t.direction,e.amount);let i=0;const s=new Ue("twisty-alg-grouping",e);return s.addString("("),n?(i+=s.addElem({moveCount:1,element:new Oe("twisty-alg-move",n[0].amount.toString(),t,n[0],!0,!0)}),s.addString(", "),i+=s.addElem({moveCount:1,element:new Oe("twisty-alg-move",n[1].amount.toString(),t,n[1],!0,!0)})):i+=s.addElem(this.traverseAlg(e.alg,{earliestMoveIndex:t.earliestMoveIndex+i,twistyAlgViewer:t.twistyAlgViewer,direction:r})),s.addString(")"+e.experimentalRepetitionSuffix),s.flushQueue(),{moveCount:i*Math.abs(e.amount),element:s}}traverseMove(e,t){const n=new Oe("twisty-alg-move",e.toString(),t,e,!0,!0);return t.twistyAlgViewer.highlighter.addMove(e.startCharIndex,n),{moveCount:1,element:n}}traverseCommutator(e,t){let n=0;const r=new Ue("twisty-alg-commutator",e);r.addString("["),r.flushQueue();const[i,s]=Xi([e.A,e.B],t.direction);return n+=r.addElem(this.traverseAlg(i,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString(", "),n+=r.addElem(this.traverseAlg(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.flushQueue(t.direction),r.addString("]"),r.flushQueue(),{moveCount:n*2,element:r}}traverseConjugate(e,t){let n=0;const r=new Ue("twisty-alg-conjugate",e);r.addString("[");const i=r.addElem(this.traverseAlg(e.A,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}));return n+=i,r.addString(": "),n+=r.addElem(this.traverseAlg(e.B,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString("]"),r.flushQueue(),{moveCount:n+i,element:r}}traversePause(e,t){return{moveCount:1,element:new Oe("twisty-alg-pause",".",t,e,!0,!0)}}traverseNewline(e,t){const n=new Ue("twisty-alg-newline",e);return n.append(document.createElement("br")),{moveCount:0,element:n}}traverseLineComment(e,t){return{moveCount:0,element:new Oe("twisty-alg-line-comment",`//${e.text}`,t,e,!1,!1)}}},Hr=new ll,ul=Hr.traverseAlg.bind(Hr),cl=class{constructor(){this.moveCharIndexMap=new Map,this.currentElem=null}addMove(e,t){this.moveCharIndexMap.set(e,t)}set(e){var n,r;const t=e?this.moveCharIndexMap.get(e.startCharIndex)??null:null;this.currentElem!==t&&((n=this.currentElem)==null||n.classList.remove("twisty-alg-current-move"),(r=this.currentElem)==null||r.setCurrentMove(!1),t==null||t.classList.add("twisty-alg-current-move"),t==null||t.setCurrentMove(!0),this.currentElem=t)}},Kt,ce,er,Zi,Ki=class extends yt{constructor(e){super(),c(this,er),this.highlighter=new cl,c(this,Kt,void 0),c(this,ce,null),this.lastClickTimestamp=null,e!=null&&e.twistyPlayer&&(this.twistyPlayer=e==null?void 0:e.twistyPlayer)}connectedCallback(){}setAlg(e){m(this,Kt,ul(e,{earliestMoveIndex:0,twistyAlgViewer:this,direction:1}).element),this.textContent="",this.appendChild(a(this,Kt))}get twistyPlayer(){return a(this,ce)}set twistyPlayer(e){M(this,er,Zi).call(this,e)}async jumpToIndex(e,t){const n=a(this,ce);if(n){n.pause();const r=(async()=>{const i=await n.experimentalModel.indexer.get(),s=t?al:0;return(i.indexToMoveStartTimestamp(e)??-s)+s})();n.experimentalModel.timestampRequest.set(await r),this.lastClickTimestamp===await r?(n.play(),this.lastClickTimestamp=null):this.lastClickTimestamp=await r}}async attributeChangedCallback(e,t,n){if(e==="for"){const r=document.getElementById(n);if(!r){console.warn("for= elem does not exist");return}if(await customElements.whenDefined("twisty-player"),!(r instanceof St)){console.warn("for= elem is not a twisty-player");return}this.twistyPlayer=r}}static get observedAttributes(){return["for"]}};Kt=new WeakMap;ce=new WeakMap;er=new WeakSet;Zi=async function(e){if(a(this,ce)){console.warn("twisty-player reassignment is not supported");return}if(e===null)throw new Error("clearing twistyPlayer is not supported");m(this,ce,e),a(this,ce).experimentalModel.alg.addFreshListener(r=>{console.log("setting alg from ",r),this.setAlg(r.alg)});const t=(await a(this,ce).experimentalModel.alg.get()).alg,n="startCharIndex"in t?t:p.fromString(t.toString());this.setAlg(n),e.experimentalModel.currentMoveInfo.addFreshListener(r=>{let i=r.currentMoves[0];if(i??(i=r.movesStarting[0]),i??(i=r.movesFinishing[0]),!i)this.highlighter.set(null);else{const s=i.move;this.highlighter.set(s)}}),e.experimentalModel.detailedTimelineInfo.addFreshListener(r=>{r.timestamp!==this.lastClickTimestamp&&(this.lastClickTimestamp=null)})};N.define("twisty-alg-viewer",Ki);var dl=class extends Xe{traverseAlg(e,t){const n=[];let r=0;for(const i of e.units()){const s=this.traverseUnit(i,{numMovesSofar:t.numMovesSofar+r});n.push(s.tokens),r+=s.numLeavesInside}return{tokens:Array.prototype.concat(...n),numLeavesInside:r}}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return{tokens:n.tokens,numLeavesInside:n.numLeavesInside*e.amount}}traverseMove(e,t){return{tokens:[{leaf:e,idx:t.numMovesSofar}],numLeavesInside:1}}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSofar:t.numMovesSofar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside}}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSofar:t.numMovesSofar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside*2}}traversePause(e,t){return{tokens:[{leaf:e,idx:t.numMovesSofar}],numLeavesInside:1}}traverseNewline(e,t){return{tokens:[],numLeavesInside:0}}traverseLineComment(e,t){return{tokens:[],numLeavesInside:0}}},$r=new dl,hl=$r.traverseAlg.bind($r),ml=class extends L{getDefaultValue(){return""}},pl=class extends x{derive(e){return Gi(e.value)}},fl=class extends be{getDefaultValue(){return{selectionStart:0,selectionEnd:0,endChangedMostRecently:!1}}async derive(e,t){const{selectionStart:n,selectionEnd:r}=e,i=await t,s=e.selectionStart===i.selectionStart&&e.selectionEnd!==(await t).selectionEnd;return{selectionStart:n,selectionEnd:r,endChangedMostRecently:s}}},gl=class extends x{derive(e){return e.selectionInfo.endChangedMostRecently?e.selectionInfo.selectionEnd:e.selectionInfo.selectionStart}},wl=class extends x{derive(e){return hl(e.algWithIssues.alg,{numMovesSofar:0}).tokens}},vl=class extends x{derive(e){function t(r){if(r===null)return null;let i;return e.targetChar<r.leaf.startCharIndex?i="before":e.targetChar===r.leaf.startCharIndex?i="start":e.targetChar<r.leaf.endCharIndex?i="inside":e.targetChar===r.leaf.endCharIndex?i="end":i="after",{leafInfo:r,where:i}}let n=null;for(const r of e.leafTokens){if(e.targetChar<r.leaf.startCharIndex&&n!==null)return t(n);if(e.targetChar<=r.leaf.endCharIndex)return t(r);n=r}return t(n)}},yl=class{constructor(){this.valueProp=new ml,this.selectionProp=new fl,this.targetCharProp=new gl({selectionInfo:this.selectionProp}),this.algEditorAlgWithIssues=new pl({value:this.valueProp}),this.leafTokensProp=new wl({algWithIssues:this.algEditorAlgWithIssues}),this.leafToHighlight=new vl({leafTokens:this.leafTokensProp,targetChar:this.targetCharProp})}},xl=new Z(`
:host {
  width: 384px;
  display: grid;
}

.wrapper {
  /*overflow: hidden;
  resize: horizontal;*/

  background: var(--background, none);
  display: grid;
}

textarea, .carbon-copy {
  grid-area: 1 / 1 / 2 / 2;

  width: 100%;
  font-family: sans-serif;
  line-height: 1.2em;

  font-size: var(--font-size, inherit);
  font-family: var(--font-family, sans-serif);

  box-sizing: border-box;

  padding: var(--padding, 0.5em);
  /* Prevent horizontal growth. */
  overflow-x: hidden;
}

textarea {
  resize: none;
  background: none;
  z-index: 2;
  overflow: hidden;
  border: 1px solid var(--border-color, rgba(0, 0, 0, 0.25));
}

.carbon-copy {
  white-space: pre-wrap;
  word-wrap: break-word;
  color: transparent;
  user-select: none;
  pointer-events: none;

  z-index: 1;
}

.carbon-copy .highlight {
  background: var(--highlight-color, rgba(255, 128, 0, 0.5));
  padding: 0.1em 0.2em;
  margin: -0.1em -0.2em;
  border-radius: 0.2em;
}

.wrapper.issue-warning textarea,
.wrapper.valid-for-puzzle-warning textarea {
  outline: none;
  border: 1px solid rgba(200, 200, 0, 0.5);
  background: rgba(255, 255, 0, 0.1);
}

.wrapper.issue-error textarea,
.wrapper.valid-for-puzzle-error textarea {
  outline: none;
  border: 1px solid red;
  background: rgba(255, 0, 0, 0.1);
}
`),Et="for-twisty-player",Xr="placeholder",Zr="twisty-player-prop",E,ze,We,oe,je,tr,ne,ue,ht,Jt,en,tn,nr,nn,Ml=class extends G{constructor(e){super(),c(this,ht),c(this,tn),this.model=new yl,c(this,E,document.createElement("textarea")),c(this,ze,document.createElement("div")),c(this,We,document.createElement("span")),c(this,oe,document.createElement("span")),c(this,je,document.createElement("span")),c(this,tr,new wn(this,"valid-for-puzzle-",["none","warning","error"])),c(this,ne,null),c(this,ue,void 0),this.debugNeverRequestTimestamp=!1,c(this,en,!1),c(this,nn,null),a(this,ze).classList.add("carbon-copy"),this.addElement(a(this,ze)),a(this,E).rows=1,this.addElement(a(this,E)),a(this,We).classList.add("prefix"),a(this,ze).appendChild(a(this,We)),a(this,oe).classList.add("highlight"),a(this,ze).appendChild(a(this,oe)),a(this,je).classList.add("suffix"),a(this,ze).appendChild(a(this,je)),a(this,E).placeholder="Alg",a(this,E).setAttribute("spellcheck","false"),this.addCSS(xl),a(this,E).addEventListener("input",()=>{m(this,en,!0),this.onInput()}),a(this,E).addEventListener("blur",()=>this.onBlur()),document.addEventListener("selectionchange",()=>this.onSelectionChange()),e!=null&&e.twistyPlayer&&(this.twistyPlayer=e.twistyPlayer),m(this,ue,(e==null?void 0:e.twistyPlayerProp)??"alg"),(e==null?void 0:e.twistyPlayerProp)==="alg"&&this.model.leafToHighlight.addFreshListener(t=>{t&&this.highlightLeaf(t.leafInfo.leaf)})}set algString(e){a(this,E).value=e,this.onInput()}get algString(){return a(this,E).value}set placeholder(e){a(this,E).placeholder=e}onInput(){var t;a(this,oe).hidden=!0,this.highlightLeaf(null);const e=a(this,E).value.trimEnd();this.model.valueProp.set(e),(t=a(this,ht,Jt))==null||t.set(e)}async onSelectionChange(){if(document.activeElement!==this||this.shadow.activeElement!==a(this,E)||a(this,ue)!=="alg")return;const{selectionStart:e,selectionEnd:t}=a(this,E);this.model.selectionProp.set({selectionStart:e,selectionEnd:t})}async onBlur(){}setAlgIssueClassForPuzzle(e){a(this,tr).setValue(e)}highlightLeaf(e){if(a(this,ue)==="alg"){if(e===null){a(this,We).textContent="",a(this,oe).textContent="",a(this,je).textContent=M(this,tn,nr).call(this,a(this,E).value);return}e!==a(this,nn)&&(m(this,nn,e),a(this,We).textContent=a(this,E).value.slice(0,e.startCharIndex),a(this,oe).textContent=a(this,E).value.slice(e.startCharIndex,e.endCharIndex),a(this,je).textContent=M(this,tn,nr).call(this,a(this,E).value.slice(e.endCharIndex)),a(this,oe).hidden=!1)}}get twistyPlayer(){return a(this,ne)}set twistyPlayer(e){var t;if(a(this,ne)){console.warn("twisty-player reassignment/clearing is not supported");return}m(this,ne,e),e&&((async()=>this.algString=a(this,ht,Jt)?(await a(this,ht,Jt).get()).alg.toString():"")(),a(this,ue)==="alg"&&((t=a(this,ne))==null||t.experimentalModel.puzzleAlg.addFreshListener(n=>{if(n.issues.errors.length===0){this.setAlgIssueClassForPuzzle(n.issues.warnings.length===0?"none":"warning");const r=n.alg,i=p.fromString(this.algString);r.isIdentical(i)||(this.algString=r.toString(),this.onInput())}else this.setAlgIssueClassForPuzzle("error")}),this.model.leafToHighlight.addFreshListener(async n=>{if(n===null)return;const[r,i]=await Promise.all([await e.experimentalModel.indexer.get(),await e.experimentalModel.timestampRequest.get()]);if(i==="opposite-anchor"&&!a(this,en))return;const s=r.indexToMoveStartTimestamp(n.leafInfo.idx),o=r.moveDuration(n.leafInfo.idx);let u;switch(n.where){case"before":u=s;break;case"start":case"inside":u=s+o/4;break;case"end":case"after":u=s+o;break;default:throw console.log("invalid where"),new Error("Invalid where!")}this.debugNeverRequestTimestamp||e.experimentalModel.timestampRequest.set(u)}),e.experimentalModel.currentLeavesSimplified.addFreshListener(async n=>{const i=(await e.experimentalModel.indexer.get()).getAnimLeaf(n.stateIndex);this.highlightLeaf(i)})))}attributeChangedCallback(e,t,n){switch(e){case Et:{const r=document.getElementById(n);if(!r){console.warn(`${Et}= elem does not exist`);return}if(!(r instanceof St)){console.warn(`${Et}=is not a twisty-player`);return}this.twistyPlayer=r;return}case Xr:this.placeholder=n;return;case Zr:if(a(this,ne))throw console.log("cannot set prop"),new Error("cannot set prop after twisty player");m(this,ue,n);return}}static get observedAttributes(){return[Et,Xr,Zr]}};E=new WeakMap;ze=new WeakMap;We=new WeakMap;oe=new WeakMap;je=new WeakMap;tr=new WeakMap;ne=new WeakMap;ue=new WeakMap;ht=new WeakSet;Jt=function(){return a(this,ne)===null?null:a(this,ne).experimentalModel[a(this,ue)]};en=new WeakMap;tn=new WeakSet;nr=function(e){return e.endsWith(`
`)?e+" ":e};nn=new WeakMap;N.define("twisty-alg-editor",Ml);var zl=new Z(`
.wrapper {
  background: rgb(255, 245, 235);
  display: grid;
  grid-template-columns: 1fr;
  border: 1px solid rgba(0, 0, 0, 0.25);
}

.setup-alg, twisty-alg-viewer {
  padding: 0.5em 1em;
}

.heading {
  background: rgba(255, 230, 210, 1);
  font-weight: bold;
  padding: 0.25em 0.5em;
}

.heading.title {
  background: rgb(255, 245, 235);
  font-size: 150%;
  white-space: pre;
}

twisty-player {
  width: 100%;
  resize: vertical;
  overflow-y: hidden;
}

twisty-player + .heading {
  padding-top: 0.5em;
}
`);function Sl(e="",t=location.href){const n={alg:"alg","setup-alg":"experimental-setup-alg","setup-anchor":"experimental-setup-anchor",puzzle:"puzzle",stickering:"experimental-stickering","puzzle-description":"experimental-puzzle-description",title:"experimental-title","video-url":"experimental-video-url",competition:"experimental-competition-id"},r=new URL(t).searchParams,i={};for(const[s,o]of Object.entries(n)){const u=r.get(e+s);if(u!==null){const d=hn[o];i[d]=u}}return i}var mt,Tl=class extends G{constructor(){super({mode:"open"}),this.twistyPlayer=null,this.a=null,c(this,mt,void 0)}fallback(){if(this.contentWrapper.textContent="",this.a){const e=this.contentWrapper.appendChild(document.createElement("span"));e.textContent="❗️",e.title="Could not show a player for link",this.addElement(this.a)}a(this,mt)&&a(this,mt).remove()}async connectedCallback(){var i;if(m(this,mt,this.addCSS(zl)),this.a=this.querySelector("a"),!this.a)return;const e=Sl("",this.a.href),t=(i=this.a)==null?void 0:i.href,{hostname:n,pathname:r}=new URL(t);if(n!=="alpha.twizzle.net"){this.fallback();return}if(["/edit/","/explore/"].includes(r)){const s=r==="/explore/";if(e.puzzle&&!(e.puzzle in gi)){const u=(await I(()=>import("./index.38d946f2.js"),[],import.meta.url)).getPuzzleDescriptionString(e.puzzle);delete e.puzzle,e.experimentalPuzzleDescription=u}if(this.twistyPlayer=this.addElement(new St({...e,viewerLink:s?"experimental-twizzle-explorer":"auto"})),e.experimentalTitle&&this.addHeading(e.experimentalTitle).classList.add("title"),e.experimentalSetupAlg){this.addHeading("Setup");const u=this.addElement(document.createElement("div"));u.classList.add("setup-alg"),u.textContent=new p(e.experimentalSetupAlg).toString()}this.addHeading("Moves"),this.addElement(new Ki({twistyPlayer:this.twistyPlayer})).part.add("twisty-alg-viewer")}else this.fallback()}addHeading(e){const t=this.addElement(document.createElement("div"));return t.classList.add("heading"),t.textContent=e,t}};mt=new WeakMap;N.define("twizzle-link",Tl);var Ji=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},T=(e,t,n)=>(Ji(e,t,"read from private field"),n?n.call(e):t.get(e)),Dt=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},Il=(e,t,n,r)=>(Ji(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Ll=`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  place-content: center;
  overflow: hidden;
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

twisty-player {
  width: 100%;
  height: 100%;
}
`,bl="333",kl=bl,pt,Fe,$,le,ea=class extends HTMLElement{constructor(){super(),Dt(this,pt,void 0),Dt(this,Fe,document.createElement("div")),Dt(this,$,{eventID:null,scramble:new p,visualization:null,checkered:!1}),Dt(this,le,new St({controlPanel:"none",hintFacelets:"none",visualization:"2D",background:"none"})),Il(this,pt,this.attachShadow({mode:"closed"})),T(this,Fe).classList.add("wrapper"),T(this,pt).appendChild(T(this,Fe));const e=document.createElement("style");e.textContent=Ll,T(this,pt).appendChild(e)}get player(){return T(this,le)}connectedCallback(){T(this,Fe).appendChild(T(this,le))}set event(e){var t;const n=_a(e??kl);T(this,le).puzzle=(t=n==null?void 0:n.puzzleID)!=null?t:"3x3x3",T(this,$).eventID=e}get event(){return T(this,$).eventID}set scramble(e){const t=new p(e??"");T(this,le).alg=t,T(this,$).scramble=t,T(this,Fe).setAttribute("title",t.toString())}get scramble(){return T(this,$).scramble}set visualization(e){T(this,le).visualization=e??"2D",T(this,$).visualization=e}get visualization(){return T(this,$).visualization}set checkered(e){const t=!!e;T(this,le).background=t?"checkered":"none",T(this,$).checkered=t}get checkered(){return T(this,$).checkered}attributeChangedCallback(e,t,n){switch(e){case"event":{this.event=n;break}case"scramble":{this.scramble=n;break}case"visualization":{this.visualization=n;break}case"checkered":{this.checkered=n!==null;break}}}static get observedAttributes(){return["event","scramble","visualization","checkered"]}};pt=new WeakMap;Fe=new WeakMap;$=new WeakMap;le=new WeakMap;customElements.define("scramble-display",ea);const Pl=Object.freeze(Object.defineProperty({__proto__:null,ScrambleDisplay:ea},Symbol.toStringTag,{value:"Module"}));export{l as M,Be as Q,hs as T,c as _,M as a,m as b,a as c,q as d,Al as e,or as f,Dl as g,Cl as h,Pl as i,gi as p};
