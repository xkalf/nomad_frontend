import{i as Ee,a as xe,b as Ie}from"./navigation.6df6eabc.js";import{p as te}from"./stores.1a771838.js";import{d as z,w as U}from"./index.440ffa8a.js";import{a8 as _,V as _e,t as Se}from"./scheduler.4afb9c7b.js";import{U as Fe,N as Ce,P as Re,a as Le,b as Ae,H as $e,p as ke}from"./parse.7d180a0f.js";import{k as Ue}from"./singletons.e5aac8c6.js";import{b as Te}from"./environment.60829b93.js";class le extends Error{constructor(t,i){super(t),this.name="DevalueError",this.path=i.join("")}}function ve(e){return Object(e)!==e}const De=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ve(e){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null||Object.getOwnPropertyNames(t).sort().join("\0")===De}function He(e){return Object.prototype.toString.call(e).slice(8,-1)}function Ze(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function X(e){let t="",i=0;const o=e.length;for(let s=0;s<o;s+=1){const a=e[s],r=Ze(a);r&&(t+=e.slice(i,s)+r,i=s+1)}return`"${i===0?e:t+e.slice(i)}"`}function Ne(e,t){const i=[],o=new Map,s=[];for(const l in t)s.push({key:l,fn:t[l]});const a=[];let r=0;function u(l){if(typeof l=="function")throw new le("Cannot stringify a function",a);if(o.has(l))return o.get(l);if(l===void 0)return Fe;if(Number.isNaN(l))return Ce;if(l===1/0)return Re;if(l===-1/0)return Le;if(l===0&&1/l<0)return Ae;const T=r++;o.set(l,T);for(const{key:f,fn:v}of s){const E=v(l);if(E)return i[T]=`["${f}",${u(E)}]`,T}let d="";if(ve(l))d=de(l);else switch(He(l)){case"Number":case"String":case"Boolean":d=`["Object",${de(l)}]`;break;case"BigInt":d=`["BigInt",${l}]`;break;case"Date":d=`["Date","${l.toISOString()}"]`;break;case"RegExp":const{source:v,flags:E}=l;d=E?`["RegExp",${X(v)},"${E}"]`:`["RegExp",${X(v)}]`;break;case"Array":d="[";for(let h=0;h<l.length;h+=1)h>0&&(d+=","),h in l?(a.push(`[${h}]`),d+=u(l[h]),a.pop()):d+=$e;d+="]";break;case"Set":d='["Set"';for(const h of l)d+=`,${u(h)}`;d+="]";break;case"Map":d='["Map"';for(const[h,k]of l)a.push(`.get(${ve(h)?de(h):"..."})`),d+=`,${u(h)},${u(k)}`;d+="]";break;default:if(!Ve(l))throw new le("Cannot stringify arbitrary non-POJOs",a);if(Object.getOwnPropertySymbols(l).length>0)throw new le("Cannot stringify POJOs with symbolic keys",a);if(Object.getPrototypeOf(l)===null){d='["null"';for(const h in l)a.push(`.${h}`),d+=`,${X(h)},${u(l[h])}`,a.pop();d+="]"}else{d="{";let h=!1;for(const k in l)h&&(d+=","),h=!0,a.push(`.${k}`),d+=`${X(k)}:${u(l[k])}`,a.pop();d+="}"}}return i[T]=d,T}const m=u(e);return m<0?`${m}`:`[${i.join(",")}]`}function de(e){const t=typeof e;return t==="string"?X(e):e instanceof String?X(e.toString()):e===void 0?Fe.toString():e===0&&1/e<0?Ae.toString():t==="bigint"?`["BigInt","${e}"]`:String(e)}const mt=""+new URL("../assets/horizontal-logo.d04e909d.webp",import.meta.url).href;function Pe(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function Be(e){return e.reduce((t,i)=>(typeof i=="number"||!isNaN(parseInt(String(i),10))?t+=`[${String(i)}]`:t?t+=`.${String(i)}`:t+=String(i),t),"")}class x extends Error{constructor(t){super(t),Object.setPrototypeOf(this,x.prototype)}}function oe(e,t,i){return e[t]=i,"skip"}function be(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function qe(e,t,i={}){i.modifier||(i.modifier=s=>be(t,s)?void 0:s.value);const o=C(e,t,i.modifier);if(o)return i.value===void 0||i.value(o.value)?o:void 0}function C(e,t,i){if(!t.length)return;const o=[t[0]];let s=e;for(;o.length<t.length;){const r=o[o.length-1],u=i?i({parent:s,key:String(r),value:s[r],path:o.map(m=>String(m)),isLeaf:!1,set:m=>oe(s,r,m)}):s[r];if(u===void 0)return;s=u,o.push(t[o.length])}const a=t[t.length-1];return{parent:s,key:String(a),value:s[a],path:t.map(r=>String(r)),isLeaf:!0,set:r=>oe(s,a,r)}}function H(e,t,i=[]){for(const o in e){const s=e[o],a=s===null||typeof s!="object",r={parent:e,key:o,value:s,path:i.map(String).concat([o]),isLeaf:a,set:m=>oe(e,o,m)},u=t(r);if(u==="abort")return u;if(u==="skip")continue;if(!a){const m=H(s,t,r.path);if(m==="abort")return m}}}async function Je(e,t,i=[]){for(const o in e){const s=e[o],a=s===null||typeof s!="object",r={parent:e,key:o,value:s,path:i.map(String).concat([o]),isLeaf:a,set:m=>oe(e,o,m)},u=await t(r);if(u==="abort")return u;if(u==="skip")break;if(!a){const m=H(s,t,r.path);if(m==="abort")return m}}}function We(e,t){const i=new Map;function o(s,a){if(s.isLeaf){const r=C(a,s.path);r?(s.value instanceof Date&&r.value instanceof Date&&s.value.getTime()!=r.value.getTime()||s.value!==r.value)&&i.set(s.path.join(" "),s.path):i.set(s.path.join(" "),s.path)}}return H(e,s=>o(s,t)),H(t,s=>o(s,e)),Array.from(i.values())}function G(e,t,i){for(const o of t){const s=C(e,o,({parent:a,key:r,value:u})=>((u===void 0||typeof u!="object")&&(a[r]={}),a[r]));s&&(s.parent[s.key]=i)}}function me(e,t){const i=Pe(t),o=z(e,s=>{const a=C(s,i);return a==null?void 0:a.value});return{subscribe(...s){const a=o.subscribe(...s);return()=>{a()}},update(s){e.update(a=>{const r=C(a,i);return r&&(r.parent[r.key]=s(r.value)),a})},set(s){e.update(a=>{const r=C(a,i);return r&&(r.parent[r.key]=s),a})}}}function W(e){return"structuredClone"in globalThis?structuredClone(e):ke(Ne(e))}function Ye(e){const t=e;let i=!0,o=!1,s=!1,a=!1,r,u;for(;i;)e._def.typeName=="ZodNullable"?(o=!0,e=e.unwrap()):e._def.typeName=="ZodDefault"?(a=!0,u=e._def.defaultValue(),e=e._def.innerType):e._def.typeName=="ZodOptional"?(s=!0,e=e.unwrap()):e._def.typeName=="ZodEffects"?(r||(r=e),e=e._def.schema):e._def.typeName=="ZodPipeline"?e=e._def.out:i=!1;return{zodType:e,originalType:t,isNullable:o,isOptional:s,hasDefault:a,defaultValue:u,effects:r}}const ye=new WeakMap;function he(e){return ye.has(e)||ye.set(e,ee(e)),ye.get(e)}function ee(e){const t=Ye(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([i,o])=>[i,ee(o)]).filter(i=>i[1]!==void 0));if(t._def.typeName=="ZodArray")return ee(t._def.type)??{};if(t._def.typeName=="ZodRecord")return ee(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((o,s)=>{const a=ee(s);return a&&(o={...o??{},...a}),o},void 0)}function ue(e,t,i=!0){const o={},s=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!i)return e._errors;o._errors=e._errors}for(const[a,r]of s.filter(([u])=>u!=="_errors")){const u=!isNaN(parseInt(a,10));o[a]=ue(r,t?u?t:t[a]:void 0,!!(t!=null&&t[a]))}return o}function Ge(e){return Me(e,[])}function Me(e,t){return Object.entries(e).filter(([,o])=>o!==void 0).flatMap(([o,s])=>{if(Array.isArray(s)&&s.length>0){const a=t.concat([o]);return{path:Be(a),messages:s}}else return Me(e[o],t.concat([o]))})}function Oe(e,t){e.update(i=>(H(i,o=>{if(!(o.path.length==1&&o.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(o.value))return o.set(void 0)}),t.undefinePath&&G(i,[t.undefinePath],void 0),i))}async function je(e,t,i,o,s){return Ke(e.validators,t,i,o,s)}async function Ke(e,t,i,o,s){if(e){let a,r={};if("safeParseAsync"in e){const u=e,m=await u.safeParseAsync(t);a=m.success,m.success||(r=ue(m.error.format(),he(u)))}else{a=!0;const u=e,m=[];await Je(t,async({value:l,path:T})=>{const d=T.filter(v=>isNaN(parseInt(v))),f=C(u,d);if(typeof(f==null?void 0:f.value)=="function"){const v=f.value;if(Array.isArray(l))for(const E in l){const h=await v(l[E]);h&&(a=!1,m.push({path:T.concat([E]),errors:typeof h=="string"?[h]:h??void 0}))}else{const E=await v(l);E&&(a=!1,m.push({path:T,errors:typeof E=="string"?[E]:E??void 0}))}}});for(const{path:l,errors:T}of m){const d=C(r,l,({parent:f,key:v,value:E})=>(E===void 0&&(f[v]={}),f[v]));if(d){const{parent:f,key:v}=d;f[v]=T}}}if(!a)return{valid:!1,posted:s,errors:r,data:t,constraints:o,message:void 0,id:i}}return{valid:!0,posted:s,errors:{},data:t,constraints:o,message:void 0,id:i}}async function Xe(e,t,i){if(typeof e.validators!="object"||!("safeParseAsync"in e.validators))return;const o=e.validators,s=await o.safeParseAsync(t);if(s.success)i.update(a=>(H(a,r=>{if(r.key=="_errors")return r.set(void 0)}),a));else{const a=ue(s.error.format(),he(o));i.update(r=>(H(r,u=>{if(u.key=="_errors")return u.set(void 0)}),H(a,u=>{if(u.key=="_errors")return G(r,[u.path],u.value)}),r))}}async function pe(e,t,i,o,s,a={}){function r(){Oe(o,{undefinePath:e,clearFormLevelErrors:!0})}function u(l){return typeof l=="string"&&(l=[l]),(a.update===!0||a.update=="errors")&&o.update(T=>{const d=C(T,e,f=>{if(be(e,f))throw new x("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+f.path.slice(0,-1));return f.value===void 0?(f.parent[f.key]={},f.parent[f.key]):f.value});if(!d)throw new x("Error path could not be created: "+e);return d.parent[d.key]=l??void 0,T}),l??void 0}const m=await Qe(e,t.validators,i,o,s,a);if(m.validated)if(m.validated==="all"&&!m.errors)r();else return u(m.errors);else if(m.validated===!1&&t.defaultValidator=="clear")return u(void 0);return m.errors}async function Qe(e,t,i,o,s,a={}){a.update===void 0&&(a.update=!0),a.taint===void 0&&(a.taint=!1),typeof a.errors=="string"&&(a.errors=[a.errors]);const r={value:a.value,shouldUpdate:!0,currentData:void 0,validationPath:e.filter(f=>isNaN(parseInt(f)))};async function u(){return{validated:!1,errors:void 0}}function m(f,v){if(v===void 0)return!1;const E=C(v,f);return E?E.value===!0:!1}function l(f){o.update(f)}function T(){o.update(f=>(f._errors=void 0,f))}function d(f,v){return ue(f.format(),he(v))}if("value"in a)a.update===!0||a.update==="value"?i.update(f=>(G(f,[e],r.value),r.currentData=f),{taint:a.taint}):r.shouldUpdate=!1;else{r.currentData=_(i);const f=C(r.currentData,e);r.value=f==null?void 0:f.value}if(typeof t!="object")return u();if("safeParseAsync"in t){r.shouldUpdate||(r.currentData=W(r.currentData??_(i)),G(r.currentData,[e],r.value));const f=await t.safeParseAsync(r.currentData);if(f.success)return T(),{validated:!0,errors:void 0};{const v=d(f.error,t);if(a.update===!0||a.update=="errors"){const h=_(s);l(k=>(H(k,M=>{if(M.key=="_errors")return M.set(void 0)}),H(v,M=>{if(M.key=="_errors")return G(k,[M.path],M.value);if(Array.isArray(M.value))return m(M.path,h)&&G(k,[M.path],M.value),"skip"}),k))}const E=C(v,e);return{validated:!0,errors:a.errors??(E==null?void 0:E.value)}}}else{const f=C(t,r.validationPath);if(f){if(f.value===void 0)return u();{const v=await f.value(r.value);return{validated:!0,errors:v&&(a.errors??v)}}}else throw new x("No Superforms validator found: "+e)}}function ie(e){return Ue.apply_action(e)}function ze(e){const t=JSON.parse(e);return t.data&&(t.data=ke(t.data)),t}function et(e){return HTMLElement.prototype.cloneNode.call(e)}function tt(e,t=()=>{}){const i=async({action:s,result:a,reset:r})=>{a.type==="success"&&(r!==!1&&HTMLFormElement.prototype.reset.call(e),await Ee()),(location.origin+location.pathname===s.origin+s.pathname||a.type==="redirect"||a.type==="error")&&ie(a)};async function o(s){var v,E,h;s.preventDefault();const a=new URL((v=s.submitter)!=null&&v.hasAttribute("formaction")?s.submitter.formAction:et(e).action),r=new FormData(e),u=(E=s.submitter)==null?void 0:E.getAttribute("name");u&&r.append(u,((h=s.submitter)==null?void 0:h.getAttribute("value"))??"");const m=new AbortController;let l=!1;const d=await t({action:a,cancel:()=>l=!0,controller:m,get data(){return r},formData:r,get form(){return e},formElement:e,submitter:s.submitter})??i;if(l)return;let f;try{const k=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:r,signal:m.signal});f=ze(await k.text()),f.type==="error"&&(f.status=k.status)}catch(k){if((k==null?void 0:k.name)==="AbortError")return;f={type:"error",error:k}}d({action:a,get data(){return r},formData:r,get form(){return e},formElement:e,update:k=>i({action:a,result:f,reset:k==null?void 0:k.reset}),result:f})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",o),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",o)}}}const rt=(e,t=0)=>{const i=e.getBoundingClientRect();return i.top>=t&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)},nt=(e,t=1.125,i="smooth")=>{const a=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:a,behavior:i})};var j;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(j||(j={}));function ge(e){!e.flashMessage||!Te||we(e)&&(document.cookie=`flash=; Max-Age=0; Path=${e.flashMessage.cookiePath??"/"};`)}function we(e){return!e.flashMessage||!Te?!1:e.syncFlashMessage}function at(e,t,i,o,s,a,r,u,m,l,T,d,f,v,E,h,k){l();const M=s;async function R(p){await pe(p,r,u,M,v)}function re(p){return p&&(p instanceof HTMLSelectElement||p instanceof HTMLInputElement&&p.type=="radio")}async function Q(p){if(!(r.validationMethod=="oninput"||r.validationMethod=="submit-only")){re(p.target)&&await new Promise(O=>setTimeout(O,0));for(const O of _(E))R(O);E.set([])}}e.addEventListener("focusout",Q);const Z=new Set;function ne(p){const O=p.target;r.selectErrorText&&O.select()}function ae(p){p.querySelectorAll("input").forEach(O=>{O.addEventListener("invalid",ne)})}function B(p){p.querySelectorAll("input").forEach(O=>O.removeEventListener("invalid",ne))}xe(p=>{p.type=="goto"&&L.completed(!0)}),_e(()=>{Z.forEach(p=>B(p)),Z.clear(),e.removeEventListener("focusout",Q),L.completed(!0)});function Y(p){function O(){if(r.selectErrorText){const F=q();F&&p!==F&&(B(F),Z.delete(F)),Z.has(p)||(ae(p),Z.add(p))}D=p}let D;function q(){return D}function K(F){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(F)}const J=async()=>{if(r.scrollToError=="off")return;const F=r.errorSelector;if(!F)return;await Se();let S;if(S=D.querySelector(F),!S)return;S=S.querySelector(F)??S;const y=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;if(rt(S,(y==null?void 0:y.offsetHeight)??0)||nt(S,void 0,r.scrollToError),!K(navigator.userAgent))return;let g;if(g=S,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(g.tagName)||(g=g.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),g)try{g.focus({preventScroll:!0}),r.selectErrorText&&g.tagName=="INPUT"&&g.select()}catch{}};O();{let F=j.Idle,S,y;const g=P=>{F=P,t.set(F>=j.Submitting),i.set(F>=j.Delayed),o.set(F>=j.Timeout)};return{submitting:()=>{O(),g(F!=j.Delayed?j.Submitting:j.Delayed),S&&clearTimeout(S),y&&clearTimeout(y),S=window.setTimeout(()=>{F==j.Submitting&&g(j.Delayed)},r.delayMs),y=window.setTimeout(()=>{F==j.Delayed&&g(j.Timeout)},r.timeoutMs)},completed:P=>{S&&clearTimeout(S),y&&clearTimeout(y),S=y=0,g(j.Idle),P||setTimeout(J)},scrollToFirstError:()=>setTimeout(J),isSubmitting:()=>F===j.Submitting||F===j.Delayed}}}const L=Y(e);let I;return tt(e,async p=>{var F;const O=p.cancel;let D=!1;function q(){return D=!0,O()}if(p.cancel=q,L.isSubmitting()&&r.multipleSubmits=="prevent")q();else{L.isSubmitting()&&r.multipleSubmits=="abort"&&I&&I.abort(),I=p.controller;for(const S of T.onSubmit)await S(p)}if(D)r.flashMessage&&ge(r);else{const S=await je(r,_(u),_(d),_(f),_(k));if(!S.valid){q();const y={type:"failure",status:(typeof r.SPA=="boolean"||(F=r.SPA)==null?void 0:F.failStatus)??400,data:{form:S}};setTimeout(()=>J({result:y}),0)}if(!D){switch(r.clearOnSubmit){case"errors-and-message":M.clear(),m.set(void 0);break;case"errors":M.clear();break;case"message":m.set(void 0);break}r.flashMessage&&(r.clearOnSubmit=="errors-and-message"||r.clearOnSubmit=="message")&&we(r)&&r.flashMessage.module.getFlash(te).set(void 0),L.submitting();const y=p.formData??p.data;if(r.SPA){q();const P={type:"success",status:200,data:{form:{valid:!0,posted:!0,errors:{},data:_(u),constraints:_(f),message:void 0,id:_(d)}}};setTimeout(()=>J({result:P}),0)}else if(r.dataType==="json"){const g=_(u),P=K(Ne(g),r.jsonChunkSize??5e5);for(const A of P)y.append("__superform_json",A);Object.keys(g).forEach(A=>{typeof y.get(A)=="string"&&y.delete(A)})}if(!r.SPA&&!y.has("__superform_id")){const g=_(d);g!==void 0&&y.set("__superform_id",g)}}}function K(S,y){const g=Math.ceil(S.length/y),P=new Array(g);for(let A=0,$=0;A<g;++A,$+=y)P[A]=S.substring($,$+y);return P}async function J(S){const y=S.result;I=null;let g=!1;const P={result:y,formEl:e,cancel:()=>g=!0};for(const A of T.onResult)await A(P);if(!g){if((y.type==="success"||y.type=="failure")&&y.data){const A=h(y.data);if(!A.length)throw new x("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const $ of A){if($.id!==_(d))continue;const fe={form:$,formEl:e,cancel:()=>g=!0};for(const se of T.onUpdate)await se(fe)}}if(!g){if(y.type!=="error")y.type==="success"&&r.invalidateAll&&await Ee(),r.applyAction?await ie(y):await a(y);else{if(r.applyAction)if(r.onError=="apply")await ie(y);else{const A={type:"failure",status:Math.floor(y.status||500),data:y};await ie(A)}if(r.onError!=="apply"){const A={result:y,message:m};for(const $ of T.onError)$!=="apply"&&await $(A)}}r.flashMessage&&y.type=="error"&&r.flashMessage.onError&&await r.flashMessage.onError({result:y,message:r.flashMessage.module.getFlash(te)})}}g&&r.flashMessage&&ge(r),(g||y.type!="redirect")&&L.completed(g)}return J})}new TextEncoder;const st={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:e=>{console.warn("Unhandled Superform error, use onError event to handle it:",e.result.error)},dataType:"form",validators:void 0,defaultValidator:"keep",clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0,SPA:void 0,validateMethod:"auto"};function yt(e,t={}){var se;t={...st,...t},t.SPA&&t.validators===void 0&&console.warn("No validators set for Superform in SPA mode. Add them to the validators option, or set it to false to disable this warning.");let i=t.id;!e||f(e)===!1?(((se=t.warnings)==null?void 0:se.noValidationAndConstraints)!==!1&&console.warn((e?"Form data sent directly to superForm instead of through superValidate. No initial data validation is made. ":"No form data sent to superForm, schema type safety cannot be guaranteed. ")+"Also, no constraints will exist for the form. Set the warnings.noValidationAndConstraints option to false to disable this warning."),e={valid:!1,posted:!1,errors:{},data:e??{},constraints:{}}):i===void 0&&(i=e.id);const o=_(te).form;if(o&&typeof o=="object"){for(const n of d(o).reverse())if(n.id===i){const c=e;e=n,e.valid&&t.resetForm&&(t.resetForm===!0||t.resetForm())&&(e=W(c),e.message=n.message);break}}const s=e,a=W(s);if(typeof a.valid!="boolean")throw new x("A non-validation object was passed to superForm. Check what's passed to its first parameter.");const r=U(s.errors),u=U(i),m={taintedMessage:t.taintedMessage,taintedFormState:W(a.data)};function l(n=8){return Math.random().toString(36).substring(2,n+2)}function T(n){m.taintedFormState=W(n)}function d(n){var b;const c=Object.values(n).filter(w=>f(w)!==!1);if(c.length>1&&((b=t.warnings)==null?void 0:b.duplicateId)!==!1){const w=new Set;for(const N of c)if(w.has(N.id)){console.warn(`Duplicate form id found: "${N.id}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set warnings.duplicateId option to false to disable this message.`);break}else w.add(N.id)}return c}function f(n){return!n||typeof n!="object"||!("valid"in n&&"errors"in n&&typeof n.valid=="boolean")?!1:"id"in n&&typeof n.id=="string"?n.id:void 0}function v(){t.taintedMessage=m.taintedMessage,i===void 0&&u.set(l())}function E(n){const c=U(n);return{subscribe:c.subscribe,set:(b,w={})=>(K(b,m.taintedFormState,w.taint??!0),m.taintedFormState=W(b),c.set(b)),update:(b,w={})=>c.update(N=>{const V=b(N);return K(V,m.taintedFormState,w.taint??!0),m.taintedFormState=W(N),V})}}const h=[u.subscribe(n=>i=n)];function k(n){h.push(n)}function M(){h.forEach(n=>n())}const R=E(s.data);function re(n,c){if(!(!c||typeof c!="object")){if(Array.isArray(c))c.length>0&&re(n,c[0]);else if(!(c instanceof Date))throw new x(`Object found in form field "${n}". Set options.dataType = 'json' and use:enhance to use nested data structures.`)}}async function Q(n,c){n.valid&&t.resetForm&&(t.resetForm===!0||t.resetForm())?Z(n.message):P(n,c),A.onUpdated.length&&await Se();for(const b of A.onUpdated)b({form:n})}function Z(n,c,b){const w=W(a);w.data={...w.data,...c},b!==void 0&&(w.id=b),P(w,!0,n)}const ne=async(n,c)=>{if(n.type=="error")throw new x(`ActionResult of type "${n.type}" cannot be passed to update function.`);if(n.type=="redirect"){t.resetForm&&(t.resetForm===!0||t.resetForm())&&Z();return}if(typeof n.data!="object")throw new x("Non-object validation data returned from ActionResult.");const b=d(n.data);if(!b.length)throw new x("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const w of b)w.id===i&&await Q(w,c??(n.status>=200&&n.status<300))},ae=U([]),B=U(s.message),Y=U(s.constraints),L=U(!1),I={subscribe:r.subscribe,set:r.set,update:r.update,clear:()=>Oe(r,{undefinePath:null,clearFormLevelErrors:!0})},p=U();function O(){return _(p)}function D(n){if(n===null)throw new x("$tainted store contained null");if(typeof n=="object"){for(const c of Object.values(n))if(D(c))return!0}return n===!0}async function q(n,c){if(t.validationMethod=="onblur"||t.validationMethod=="submit-only")return!1;let b=t.validationMethod==="oninput";if(!b){const w=_(I),N=w?qe(w,n,{modifier:ce=>{if(be(n,ce))throw new x("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+ce.path.slice(0,-1));return ce.value}}):void 0;b=!!(N&&N.key in N.parent)}return b?(await pe(n,t,R,I,p,{taint:c}),!0):!1}async function K(n,c,b){if(b===!1)return;if(b==="untaint-all"){p.set(void 0);return}const w=We(n,c);if(b===!0&&ae.set(w),w.length){p.update(V=>(V||(V={}),G(V,w,b===!0?!0:void 0),V));let N=!1;for(const V of w)N=N||await q(V,b);N||await Xe(t,_(R),I)}}function J(n,c){p.set(n),T(c)}const F=U(!1),S=U(!1),y=U(!1),g=z(I,n=>n?Ge(n):[]);if(t.taintedMessage=void 0,_e(()=>{M();for(const n of Object.values(A))n.length=0}),t.dataType!=="json")for(const[n,c]of Object.entries(s.data))re(n,c);function P(n,c,b){if(c&&J(typeof c=="boolean"?void 0:c,n.data),b=b??n.message,R.set(n.data,{taint:!1}),B.set(b),I.set(n.errors),u.set(n.id),L.set(n.posted),t.flashMessage&&we(t)){const w=t.flashMessage.module.getFlash(te);b&&_(w)===void 0&&w.set(b)}}const A={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};Ie(n=>{if(t.taintedMessage&&!_(F)){const c=O();c&&D(c)&&!window.confirm(t.taintedMessage)&&n.cancel()}}),k(te.subscribe(async n=>{if(!t.applyAction)return;function c(w){throw new x(`No form data found in ${w}. Make sure you return { form } in form actions and load functions.`)}const b=n.status>=200&&n.status<300;if(n.form&&typeof n.form=="object"){if(n.form.type=="error")return;const w=d(n.form);w.length||c("$page.form (ActionData)");for(const N of w)N.id===i&&await Q(N,b)}else if(n.data&&typeof n.data=="object"){const w=d(n.data);for(const N of w)N.id===i&&P(N,b)}}));const $=Object.fromEntries(Object.keys(a.data).map(n=>[n,{name:n,value:me(R,n),errors:me(I,n),constraints:me(Y,n)}]));function fe(n,c){return n===void 0?je(t,_(R),i,_(Y),!1):pe(Pe(n),t,R,I,p,c)}return{form:R,formId:u,errors:I,message:B,constraints:Y,fields:$,tainted:p,submitting:z(F,n=>n),delayed:z(S,n=>n),timeout:z(y,n=>n),options:t,capture:function(){return{valid:a.valid,posted:_(L),errors:_(I),data:_(R),constraints:_(Y),message:_(B),id:i,tainted:_(p)}},restore:function(n){return P(n,n.tainted??!0)},validate:fe,enhance:(n,c)=>{if(c){if(c.onError){if(t.onError==="apply")throw new x('options.onError is set to "apply", cannot add any onError events.');if(c.onError==="apply")throw new x('Cannot add "apply" as onError event in use:enhance.');A.onError.push(c.onError)}c.onResult&&A.onResult.push(c.onResult),c.onSubmit&&A.onSubmit.push(c.onSubmit),c.onUpdate&&A.onUpdate.push(c.onUpdate),c.onUpdated&&A.onUpdated.push(c.onUpdated)}return at(n,F,S,y,I,ne,t,R,B,v,A,u,Y,p,ae,d,L)},allErrors:g,posted:L,reset:n=>Z(n!=null&&n.keepMessage?_(B):void 0,n==null?void 0:n.data,n==null?void 0:n.id)}}export{mt as h,yt as s};
